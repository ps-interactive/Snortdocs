<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2018 (Released Feb 1, 2018) -->
<HTML>

<!-- Mirrored from manual-snort-org.s3-website-us-east-1.amazonaws.com/node17.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Oct 2023 20:09:22 GMT -->
<HEAD>
<TITLE>2.2 Preprocessors</TITLE>
<META NAME="description" CONTENT="2.2 Preprocessors">
<META NAME="keywords" CONTENT="snort_manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2018">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="snort_manual.css">

<LINK REL="next" HREF="node18.html">
<LINK REL="previous" HREF="node16.html">
<LINK REL="up" HREF="node15.html">
<LINK REL="next" HREF="node18.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html697"
  HREF="node18.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html693"
  HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html687"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html695"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html698"
  HREF="node18.html">2.3 Decoder and Preprocessor</A>
<B> Up:</B> <A NAME="tex2html694"
  HREF="node15.html">2. Configuring Snort</A>
<B> Previous:</B> <A NAME="tex2html688"
  HREF="node16.html">2.1 Includes</A>
 &nbsp; <B>  <A NAME="tex2html696"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html699"
  HREF="node17.html#SECTION00321000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag3</A>
<UL>
<LI><A NAME="tex2html700"
  HREF="node17.html#SECTION00321100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag 3 Configuration</A>
<LI><A NAME="tex2html701"
  HREF="node17.html#SECTION00321200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A NAME="tex2html702"
  HREF="node17.html#SECTION00321300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Frag 3 Alert Output</A>
</UL>
<BR>
<LI><A NAME="tex2html703"
  HREF="node17.html#SECTION00322000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Session</A>
<UL>
<LI><A NAME="tex2html704"
  HREF="node17.html#SECTION00322100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Session API</A>
<LI><A NAME="tex2html705"
  HREF="node17.html#SECTION00322200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Session Global Configuration</A>
<LI><A NAME="tex2html706"
  HREF="node17.html#SECTION00322300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Session HA Configuration</A>
<LI><A NAME="tex2html707"
  HREF="node17.html#SECTION00322400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN> Example Configurations</A>
</UL>
<BR>
<LI><A NAME="tex2html708"
  HREF="node17.html#SECTION00323000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream</A>
<UL>
<LI><A NAME="tex2html709"
  HREF="node17.html#SECTION00323100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Transport Protocols</A>
<LI><A NAME="tex2html710"
  HREF="node17.html#SECTION00323200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target-Based</A>
<LI><A NAME="tex2html711"
  HREF="node17.html#SECTION00323300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream API</A>
<LI><A NAME="tex2html712"
  HREF="node17.html#SECTION00323400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">4</SPAN> Anomaly Detection</A>
<LI><A NAME="tex2html713"
  HREF="node17.html#SECTION00323500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">5</SPAN> Protocol Aware Flushing</A>
<LI><A NAME="tex2html714"
  HREF="node17.html#SECTION00323600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">6</SPAN> Stream TCP Configuration</A>
<LI><A NAME="tex2html715"
  HREF="node17.html#SECTION00323700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">7</SPAN> Stream UDP Configuration</A>
<LI><A NAME="tex2html716"
  HREF="node17.html#SECTION00323800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">8</SPAN> Stream ICMP Configuration</A>
<LI><A NAME="tex2html717"
  HREF="node17.html#SECTION00323900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">9</SPAN> Stream IP Configuration</A>
<LI><A NAME="tex2html718"
  HREF="node17.html#SECTION003231000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">10</SPAN> Example Configurations</A>
</UL>
<BR>
<LI><A NAME="tex2html719"
  HREF="node17.html#SECTION00324000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN> sfPortscan</A>
<UL>
<LI><A NAME="tex2html720"
  HREF="node17.html#SECTION00324100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> sfPortscan Configuration</A>
<LI><A NAME="tex2html721"
  HREF="node17.html#SECTION00324200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A NAME="tex2html722"
  HREF="node17.html#SECTION00324300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example</A>
<LI><A NAME="tex2html723"
  HREF="node17.html#SECTION00324400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> sfPortscan Alert Output</A>
<LI><A NAME="tex2html724"
  HREF="node17.html#SECTION00324500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Tuning sfPortscan</A>
</UL>
<BR>
<LI><A NAME="tex2html725"
  HREF="node17.html#SECTION00325000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">5</SPAN> RPC Decode</A>
<UL>
<LI><A NAME="tex2html726"
  HREF="node17.html#SECTION00325100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</UL>
<BR>
<LI><A NAME="tex2html727"
  HREF="node17.html#SECTION00326000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">6</SPAN> Performance Monitor</A>
<UL>
<LI><A NAME="tex2html728"
  HREF="node17.html#SECTION00326100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Examples</A>
</UL>
<BR>
<LI><A NAME="tex2html729"
  HREF="node17.html#SECTION00327000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN> HTTP Inspect</A>
<UL>
<LI><A NAME="tex2html730"
  HREF="node17.html#SECTION00327100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
<LI><A NAME="tex2html731"
  HREF="node17.html#SECTION00327200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A NAME="tex2html732"
  HREF="node17.html#SECTION00327300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
<LI><A NAME="tex2html733"
  HREF="node17.html#SECTION00327400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">4</SPAN> Server Configuration</A>
<LI><A NAME="tex2html734"
  HREF="node17.html#SECTION00327500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">5</SPAN> Example Default Configuration</A>
<LI><A NAME="tex2html735"
  HREF="node17.html#SECTION00327600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example IP Configuration</A>
<LI><A NAME="tex2html736"
  HREF="node17.html#SECTION00327700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">7</SPAN> Example Multiple IP Configuration</A>
<LI><A NAME="tex2html737"
  HREF="node17.html#SECTION00327800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">8</SPAN> Server Configuration Options</A>
<LI><A NAME="tex2html738"
  HREF="node17.html#SECTION00327900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example</A>
<LI><A NAME="tex2html739"
  HREF="node17.html#SECTION003271000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">10</SPAN> Examples</A>
</UL>
<BR>
<LI><A NAME="tex2html740"
  HREF="node17.html#SECTION00328000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN> SMTP Preprocessor</A>
<UL>
<LI><A NAME="tex2html741"
  HREF="node17.html#SECTION00328100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html742"
  HREF="node17.html#SECTION00328200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
<LI><A NAME="tex2html743"
  HREF="node17.html#SECTION00328300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
<LI><A NAME="tex2html744"
  HREF="node17.html#SECTION00328400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">4</SPAN> Note</A>
</UL>
<BR>
<LI><A NAME="tex2html745"
  HREF="node17.html#SECTION00329000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN> POP Preprocessor</A>
<UL>
<LI><A NAME="tex2html746"
  HREF="node17.html#SECTION00329100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html747"
  HREF="node17.html#SECTION00329200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
<LI><A NAME="tex2html748"
  HREF="node17.html#SECTION00329300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</UL>
<BR>
<LI><A NAME="tex2html749"
  HREF="node17.html#SECTION003210000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN> IMAP Preprocessor</A>
<UL>
<LI><A NAME="tex2html750"
  HREF="node17.html#SECTION003210100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html751"
  HREF="node17.html#SECTION003210200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
<LI><A NAME="tex2html752"
  HREF="node17.html#SECTION003210300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</UL>
<BR>
<LI><A NAME="tex2html753"
  HREF="node17.html#SECTION003211000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP/Telnet Preprocessor</A>
<UL>
<LI><A NAME="tex2html754"
  HREF="node17.html#SECTION003211100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
<LI><A NAME="tex2html755"
  HREF="node17.html#SECTION003211200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A NAME="tex2html756"
  HREF="node17.html#SECTION003211300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
<LI><A NAME="tex2html757"
  HREF="node17.html#SECTION003211400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">4</SPAN> Telnet Configuration</A>
<LI><A NAME="tex2html758"
  HREF="node17.html#SECTION003211500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">5</SPAN> Format</A>
<LI><A NAME="tex2html759"
  HREF="node17.html#SECTION003211600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example Telnet Configuration</A>
<LI><A NAME="tex2html760"
  HREF="node17.html#SECTION003211700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">7</SPAN> FTP Server Configuration</A>
<LI><A NAME="tex2html761"
  HREF="node17.html#SECTION003211800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example Default FTP Server Configuration</A>
<LI><A NAME="tex2html762"
  HREF="node17.html#SECTION003211900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example IP specific FTP Server Configuration</A>
<LI><A NAME="tex2html763"
  HREF="node17.html#SECTION0032111000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP Server Configuration Options</A>
<LI><A NAME="tex2html764"
  HREF="node17.html#SECTION0032111100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP Server Base Configuration Options</A>
<LI><A NAME="tex2html765"
  HREF="node17.html#SECTION0032111200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">12</SPAN> FTP Client Configuration</A>
<LI><A NAME="tex2html766"
  HREF="node17.html#SECTION0032111300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">13</SPAN> Example Default FTP Client Configuration</A>
<LI><A NAME="tex2html767"
  HREF="node17.html#SECTION0032111400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">14</SPAN> Example IP specific FTP Client Configuration</A>
<LI><A NAME="tex2html768"
  HREF="node17.html#SECTION0032111500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">15</SPAN> FTP Client Configuration Options</A>
<LI><A NAME="tex2html769"
  HREF="node17.html#SECTION0032111600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">16</SPAN> Examples/Default Configuration from snort.conf</A>
</UL>
<BR>
<LI><A NAME="tex2html770"
  HREF="node17.html#SECTION003212000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN> SSH</A>
<UL>
<LI><A NAME="tex2html771"
  HREF="node17.html#SECTION003212100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html772"
  HREF="node17.html#SECTION003212200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration from snort.conf</A>
</UL>
<BR>
<LI><A NAME="tex2html773"
  HREF="node17.html#SECTION003213000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN> DNS</A>
<UL>
<LI><A NAME="tex2html774"
  HREF="node17.html#SECTION003213100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html775"
  HREF="node17.html#SECTION003213200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</UL>
<BR>
<LI><A NAME="tex2html776"
  HREF="node17.html#SECTION003214000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN> SSL/TLS</A>
<UL>
<LI><A NAME="tex2html777"
  HREF="node17.html#SECTION003214100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html778"
  HREF="node17.html#SECTION003214200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
<LI><A NAME="tex2html779"
  HREF="node17.html#SECTION003214300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</UL>
<BR>
<LI><A NAME="tex2html780"
  HREF="node17.html#SECTION003215000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN> ARP Spoof Preprocessor</A>
<UL>
<LI><A NAME="tex2html781"
  HREF="node17.html#SECTION003215100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
<LI><A NAME="tex2html782"
  HREF="node17.html#SECTION003215200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration</A>
</UL>
<BR>
<LI><A NAME="tex2html783"
  HREF="node17.html#SECTION003216000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN> DCE/RPC 2 Preprocessor</A>
<UL>
<LI><A NAME="tex2html784"
  HREF="node17.html#SECTION003216100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html785"
  HREF="node17.html#SECTION003216200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target Based</A>
<LI><A NAME="tex2html786"
  HREF="node17.html#SECTION003216300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">3</SPAN> Configuration</A>
<LI><A NAME="tex2html787"
  HREF="node17.html#SECTION003216400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">4</SPAN> Events</A>
<LI><A NAME="tex2html788"
  HREF="node17.html#SECTION003216500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">5</SPAN> Rule Options</A>
</UL>
<BR>
<LI><A NAME="tex2html789"
  HREF="node17.html#SECTION003217000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN> Sensitive Data Preprocessor</A>
<UL>
<LI><A NAME="tex2html790"
  HREF="node17.html#SECTION003217100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependencies</A>
<LI><A NAME="tex2html791"
  HREF="node17.html#SECTION003217200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
<LI><A NAME="tex2html792"
  HREF="node17.html#SECTION003217300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</UL>
<BR>
<LI><A NAME="tex2html793"
  HREF="node17.html#SECTION003218000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN> Normalizer</A>
<UL>
<LI><A NAME="tex2html794"
  HREF="node17.html#SECTION003218100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">1</SPAN> IP4 Normalizations</A>
<LI><A NAME="tex2html795"
  HREF="node17.html#SECTION003218200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">2</SPAN> IP6 Normalizations</A>
<LI><A NAME="tex2html796"
  HREF="node17.html#SECTION003218300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">3</SPAN> ICMP4/6 Normalizations</A>
<LI><A NAME="tex2html797"
  HREF="node17.html#SECTION003218400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">4</SPAN> TCP Normalizations</A>
<LI><A NAME="tex2html798"
  HREF="node17.html#SECTION003218500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">5</SPAN> TTL Normalization</A>
</UL>
<BR>
<LI><A NAME="tex2html799"
  HREF="node17.html#SECTION003219000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN> SIP Preprocessor</A>
<UL>
<LI><A NAME="tex2html800"
  HREF="node17.html#SECTION003219100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html801"
  HREF="node17.html#SECTION003219200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">2</SPAN> Configuration</A>
<LI><A NAME="tex2html802"
  HREF="node17.html#SECTION003219300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">3</SPAN> Events</A>
<LI><A NAME="tex2html803"
  HREF="node17.html#SECTION003219400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">4</SPAN> Rule Options</A>
</UL>
<BR>
<LI><A NAME="tex2html804"
  HREF="node17.html#SECTION003220000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN> Reputation Preprocessor</A>
<UL>
<LI><A NAME="tex2html805"
  HREF="node17.html#SECTION003220100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A NAME="tex2html806"
  HREF="node17.html#SECTION003220200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">2</SPAN> Events</A>
<LI><A NAME="tex2html807"
  HREF="node17.html#SECTION003220300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">3</SPAN> Shared memory support</A>
</UL>
<BR>
<LI><A NAME="tex2html808"
  HREF="node17.html#SECTION003221000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN> GTP Decoder and Preprocessor</A>
<UL>
<LI><A NAME="tex2html809"
  HREF="node17.html#SECTION003221100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html810"
  HREF="node17.html#SECTION003221200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">2</SPAN> GTP Data Channel Decoder Configuration</A>
<LI><A NAME="tex2html811"
  HREF="node17.html#SECTION003221300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">3</SPAN> GTP Control Channel Preprocessor Configuration</A>
<LI><A NAME="tex2html812"
  HREF="node17.html#SECTION003221400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">4</SPAN> GTP Decoder Events</A>
<LI><A NAME="tex2html813"
  HREF="node17.html#SECTION003221500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">5</SPAN> GTP Preprocessor Events</A>
<LI><A NAME="tex2html814"
  HREF="node17.html#SECTION003221600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">6</SPAN> Rule Options</A>
</UL>
<BR>
<LI><A NAME="tex2html815"
  HREF="node17.html#SECTION003222000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN> Modbus Preprocessor</A>
<UL>
<LI><A NAME="tex2html816"
  HREF="node17.html#SECTION003222100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html817"
  HREF="node17.html#SECTION003222200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
<LI><A NAME="tex2html818"
  HREF="node17.html#SECTION003222300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
<LI><A NAME="tex2html819"
  HREF="node17.html#SECTION003222400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">4</SPAN> Preprocessor Events</A>
</UL>
<BR>
<LI><A NAME="tex2html820"
  HREF="node17.html#SECTION003223000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN> DNP3 Preprocessor</A>
<UL>
<LI><A NAME="tex2html821"
  HREF="node17.html#SECTION003223100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html822"
  HREF="node17.html#SECTION003223200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
<LI><A NAME="tex2html823"
  HREF="node17.html#SECTION003223300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
<LI><A NAME="tex2html824"
  HREF="node17.html#SECTION003223400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">4</SPAN> Preprocessor Events</A>
</UL>
<BR>
<LI><A NAME="tex2html825"
  HREF="node17.html#SECTION003224000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN> AppId Preprocessor</A>
<UL>
<LI><A NAME="tex2html826"
  HREF="node17.html#SECTION003224100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
<LI><A NAME="tex2html827"
  HREF="node17.html#SECTION003224200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
<LI><A NAME="tex2html828"
  HREF="node17.html#SECTION003224300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
<LI><A NAME="tex2html829"
  HREF="node17.html#SECTION003224400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">4</SPAN> Application Rule Events</A>
<LI><A NAME="tex2html830"
  HREF="node17.html#SECTION003224500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">5</SPAN> Application Usage Statistics</A>
<LI><A NAME="tex2html831"
  HREF="node17.html#SECTION003224600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">6</SPAN> Open Detector Package (ODP) Installation</A>
<LI><A NAME="tex2html832"
  HREF="node17.html#SECTION003224700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">7</SPAN> User Created Application Detectors</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00320000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessors</A>
</H1>

<P>
Preprocessors were introduced in version 1.5 of Snort. They allow the
functionality of Snort to be extended by allowing users and programmers to drop
modular plugins into Snort fairly easily.  Preprocessor code is run before the
detection engine is called, but after the packet has been decoded. The packet
can be modified or analyzed in an out-of-band manner using this mechanism.

<P>
Preprocessors are loaded and configured using the <TT>preprocessor</TT> keyword.
The format of the preprocessor directive in the Snort config file is:

<P>
<PRE>
    preprocessor &lt;name&gt;: &lt;options&gt;
</PRE>

<P>

<H2><A NAME="SECTION00321000000000000000"></A>
<A NAME="frag3_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag3
</H2>

<P>
The frag3 preprocessor is a target-based IP defragmentation module for Snort.
Frag3 is designed with the following goals:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">6</SPAN>.</B> 
<DD>Fast execution with less complex data management.
<DT> <B><SPAN CLASS="arabic">7</SPAN>.</B> 
<DD>Target-based host modeling anti-evasion techniques. 
</DD>
</DL> 
<P>
Frag3 uses the sfxhash data structure and linked lists for data handling
internally which allows it to have much more predictable and deterministic
performance in any environment which should aid us in managing heavily
fragmented environments.

<P>
Target-based analysis is a relatively new concept in network-based intrusion
detection.  The idea of a target-based system is to model the actual targets on
the network instead of merely modeling the protocols and looking for attacks
within them.  When IP stacks are written for different operating systems, they
are usually implemented by people who read the RFCs and then write their
interpretation of what the RFC outlines into code.  Unfortunately, there are
ambiguities in the way that the RFCs define some of the edge conditions that
may occur and when this happens different people implement certain aspects of
their IP stacks differently.  For an IDS this is a big problem.

<P>
In an environment where the attacker can determine what style of IP
defragmentation is being used on a particular target, the attacker can try to
fragment packets such that the target will put them back together in a specific
manner while any passive systems trying to model the host traffic have to guess
which way the target OS is going to handle the overlaps and retransmits.  As I
like to say, if the attacker has more information about the targets on a
network than the IDS does, it is possible to evade the IDS.  This is where the
idea for &ldquo;target-based IDS&rdquo; came from.  For more detail on this issue and how
it affects IDS, check out the famous Ptacek &amp; Newsham paper at
<TT><A NAME="tex2html3"
  HREF="http://www.snort.org/docs/idspaper/">http://www.snort.org/docs/idspaper/</A></TT>.

<P>
The basic idea behind target-based IDS is that we tell the IDS information
about hosts on the network so that it can avoid Ptacek &amp; Newsham style evasion
attacks based on information about how an individual target IP stack operates.
Vern Paxson and Umesh Shankar did a great paper on this very topic in 2003 that
detailed mapping the hosts on a network and determining how their various IP
stack implementations handled the types of problems seen in IP defragmentation
and TCP stream reassembly.  Check it out at
<TT><A NAME="tex2html4"
  HREF="http://www.icir.org/vern/papers/activemap-oak03.pdf">http://www.icir.org/vern/papers/activemap-oak03.pdf</A></TT>.

<P>
We can also present the IDS with topology information to avoid TTL-based
evasions and a variety of other issues, but that's a topic for another day.
Once we have this information we can start to really change the game for these
complex modeling problems.

<P>
Frag3 was implemented to showcase and prototype a target-based module within
Snort to test this idea.

<P>

<H3><A NAME="SECTION00321100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag 3 Configuration</A>
</H3>

<P>
There are at least two preprocessor directives required to activate frag3,
a global configuration directive and an engine instantiation.  There can
be an arbitrary number of engines defined at startup with their own
configuration, but only one global configuration.

<P>
<SPAN  CLASS="textbf">Global Configuration</SPAN>

<P>

<UL>
<LI>Preprocessor name: <TT>frag3_global</TT>

<P>
</LI>
<LI>Available options: NOTE: Global configuration options are comma
separated.

<P>

<UL>
<LI><TT>max_frags <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Maximum simultaneous fragments to
track. Default is 8192.

<P>
</LI>
<LI><TT>memcap <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>bytes<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Memory cap for self preservation.  Default
is 4MB.  

<P>
</LI>
<LI><TT>prealloc_memcap <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>bytes<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - alternate memory management mode,
use preallocated fragment nodes based on a memory cap (faster in some
situations).

<P>
</LI>
<LI><TT>prealloc_frags <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Alternate memory management mode,
use preallocated fragment nodes (faster in some situations).

<P>
</LI>
<LI><TT>disabled</TT> - This optional keyword is allowed with any
policy to avoid packet processing. This option disables the preprocessor
for this config, but not for other instances of multiple configurations.
Use the disable keyword in the base configuration to specify values for the
options <TT>memcap</TT>, <TT>prealloc_memcap</TT>, and <TT>prealloc_frags</TT>
without having the preprocessor inspect traffic for traffic applying to the base
configuration.  The other options are parsed but not used. Any valid
configuration may have "disabled" added to it.

<P>
</LI>
</UL>
</LI>
</UL>    

<P>
<SPAN  CLASS="textbf">Engine Configuration</SPAN>

<P>

<UL>
<LI>Preprocessor name: <TT>frag3_engine</TT>

<P>
</LI>
<LI>Available options:
  NOTE: Engine configuration options are space separated.

<P>

<UL>
<LI><TT>timeout <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>seconds<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Timeout for fragments.  Fragments in the
engine for longer than this period will be automatically dropped.  Default is
60 seconds.

<P>
</LI>
<LI><TT>min_ttl <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>value<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Minimum acceptable TTL value for a
fragment packet.  Default is 1. The accepted range for this option is 1 - 255.

<P>
</LI>
<LI><TT>detect_anomalies</TT> - Detect fragment anomalies.

<P>
</LI>
<LI><TT>bind_to <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>ip_list<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - IP List to bind this engine to.  This
engine will only run for packets with destination addresses contained within
the IP List.  Default value is <TT>all</TT>.

<P>
</LI>
<LI><TT>overlap_limit &lt;number&gt;</TT> - Limits the number of overlapping
fragments per packet.  The default is "0" (unlimited). This config option takes
values equal to or greater than zero. This is an optional parameter. 
detect_anomalies option must be configured for this option to take effect.

<P>
</LI>
<LI><TT>min_fragment_length &lt;number&gt;</TT> - Defines smallest fragment size
(payload size) that should be considered valid.  Fragments smaller than or
equal to this limit are considered malicious and an event is raised, if
detect_anomalies is also configured.  The default is "0" (unlimited), the
minimum is "0".  This is an optional parameter.  detect_anomalies option 
must be configured for this option to take effect.

<P>
</LI>
<LI><TT>policy <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>type<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT> - Select a target-based defragmentation mode.
Available types are first, last, bsd, bsd-right, linux, windows and solaris.
Default type is bsd.

<P>
The Paxson Active Mapping paper introduced the terminology frag3 is using to
describe policy types.  The known mappings are as follows.  Anyone who develops
more mappings and would like to add to this list please feel free to send us an
email!

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Platform</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Type</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">AIX 2</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">AIX 4.3 8.9.3</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">Cisco IOS</TD>
<TD ALIGN="LEFT">Last</TD>
</TR>
<TR><TD ALIGN="LEFT">FreeBSD</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">HP JetDirect (printer)</TD>
<TD ALIGN="LEFT">BSD-right</TD>
</TR>
<TR><TD ALIGN="LEFT">HP-UX B.10.20</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">HP-UX 11.00</TD>
<TD ALIGN="LEFT">First</TD>
</TR>
<TR><TD ALIGN="LEFT">IRIX 4.0.5F</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">IRIX 6.2</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">IRIX 6.3</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">IRIX64 6.4</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.2.10</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.2.14-5.0</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.2.16-3</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.2.19-6.2.10smp</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.4.7-10</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.4.9-31SGI 1.0.2smp</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">Linux 2.4 (RedHat 7.1-7.3)</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">MacOS (version unknown)</TD>
<TD ALIGN="LEFT">First</TD>
</TR>
<TR><TD ALIGN="LEFT">NCD Thin Clients</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">OpenBSD (version unknown)</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">OpenBSD (version unknown)</TD>
<TD ALIGN="LEFT">linux</TD>
</TR>
<TR><TD ALIGN="LEFT">OpenVMS 7.1</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">OS/2 (version unknown)</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">OSF1 V3.0</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">OSF1 V3.2</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">OSF1 V4.0,5.0,5.1</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">SunOS 4.1.4</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">SunOS 5.5.1,5.6,5.7,5.8</TD>
<TD ALIGN="LEFT">First</TD>
</TR>
<TR><TD ALIGN="LEFT">Tru64 Unix V5.0A,V5.1</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">Vax/VMS</TD>
<TD ALIGN="LEFT">BSD</TD>
</TR>
<TR><TD ALIGN="LEFT">Windows (95/98/NT4/W2K/XP)</TD>
<TD ALIGN="LEFT">Windows</TD>
</TR>
</TABLE>

<P>
</LI>
</UL>
</LI>
</UL>

<P>

<H3><A NAME="SECTION00321200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>

<P>
Note in the advanced configuration below that there are three engines specified
running with <SPAN  CLASS="textit">Linux</SPAN>, <TT>first</TT> and <TT>last</TT> policies assigned.
The first two engines are bound to specific IP address ranges and the last one
applies to all other traffic.  Packets that don't fall within the address
requirements of the first two engines automatically fall through to the third
one.

<P>

<H4><A NAME="SECTION00321210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Basic Configuration</A>
</H4>
<PRE>
    preprocessor frag3_global
    preprocessor frag3_engine
</PRE>

<P>

<H4><A NAME="SECTION00321220000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Advanced Configuration</A>
</H4>
<PRE>
    preprocessor frag3_global: prealloc_nodes 8192 
    preprocessor frag3_engine: policy linux bind_to 192.168.1.0/24
    preprocessor frag3_engine: policy first bind_to [10.1.47.0/24,172.16.8.0/24]
    preprocessor frag3_engine: policy last detect_anomalies
</PRE>

<P>

<H3><A NAME="SECTION00321300000000000000"></A>
<A NAME="frag3_alert_output"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Frag 3 Alert Output
</H3>

<P>
Frag3 is capable of detecting eight different types of anomalies.  Its event
output is packet-based so it will work with all output modes of Snort.  Read
the documentation in the <TT>doc/signatures</TT> directory with filenames that
begin with &ldquo;123-&rdquo; for information on the different event types.

<P>

<H2><A NAME="SECTION00322000000000000000"></A>
<A NAME="session_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Session
</H2>

<P>
The Session preprocessor is a global stream session management module
for Snort.  It is derived from the session management functions that
were part of the Stream5 preprocessor.

<P>
Since Session implements part of the functionality and API that was
previously in Stream5 it cannot be used with Stream5 but must be
used in conjunction with the new Stream preprocessor.  Similarly, 
due to the API changes, the other preprocessors in Snort 2.9.7 work
only with the new Session and Stream preprocessers.

<P>

<H3><A NAME="SECTION00322100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Session API</A>
</H3>

<P>
Session provides an API to enable the creation and management of
the session control block for a flow and the management of data
and state that may be associated with that flow by service and
application preprocessors (most of these functions were previously
supported by the Stream5 API). These methods are called to identify
sessions that may be ignored (large data transfers, etc), and 
update the identifying information about the session (application
protocol, direction, etc) that can later be used by rules.  
API methods to enable preprocessors to register for dispatch for
ports and services for which they should be called to process 
the packet have been added to the Session API. Session is required
for the use of the 'flow' and 'flowbits' keywords.

<P>

<H3><A NAME="SECTION00322200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Session Global Configuration</A>
</H3>

<P>
Global settings for the Session preprocessor.

<P>
<PRE>
    preprocessor stream5_global: \
        [track_tcp &lt;yes|no&gt;], [max_tcp &lt;number&gt;], \
        [memcap &lt;number bytes&gt;], \
        [track_udp &lt;yes|no&gt;], [max_udp &lt;number&gt;], \
        [track_icmp &lt;yes|no&gt;], [max_icmp &lt;number&gt;], \
        [track_ip &lt;yes|no&gt;], [max_ip &lt;number&gt;], \
        [flush_on_alert], [show_rebuilt_packets], \
        [prune_log_max &lt;number bytes&gt;], [disabled], \
        [enable_ha]
</PRE>

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>track_tcp &lt;yes|no&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Track sessions for TCP.  The default is "yes".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_tcp &lt;num sessions&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Maximum simultaneous TCP sessions tracked.  The default is "262144", maximum is
"1048576", minimum is "2".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>memcap &lt;num bytes&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Memcap for TCP packet storage.  The default is "8388608" (8MB), maximum is
"1073741824" (1GB), minimum is "32768" (32KB).</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>track_udp &lt;yes|no&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Track sessions for UDP.  The default is "yes".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_udp &lt;num sessions&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Maximum simultaneous UDP sessions tracked.  The default is "131072", maximum is
"1048576", minimum is "1".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>track_icmp &lt;yes|no&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Track sessions for ICMP.  The default is "no".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_icmp &lt;num sessions&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Maximum simultaneous ICMP sessions tracked.  The default is "65536", maximum is
"1048576", minimum is "1".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>track_ip &lt;yes|no&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Track sessions for IP.  The default is "no".  Note that "IP" includes all
non-TCP/UDP traffic over IP including ICMP if ICMP not otherwise configured.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_ip &lt;num sessions&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Maximum simultaneous IP sessions tracked.  The default is "16384", maximum is
"1048576", minimum is "1".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>disabled</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Option to disable the stream5 tracking. By default this option is turned off.
When the preprocessor is disabled only the options memcap, max_tcp, max_udp 
and max_icmp are applied when specified with the configuration.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>flush_on_alert</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Backwards compatibility.  Flush a TCP stream when an alert is generated on that
stream.  The default is set to off.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>show_rebuilt_packets</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Print/display packet after rebuilt (for debugging).  The default is set to
off.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>prune_log_max &lt;num bytes&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Print a message when a session terminates that was consuming more than the
specified number of bytes.  The default is "1048576" (1MB), minimum can be either "0"
(disabled) or if not disabled the minimum is "1024" and maximum is "1073741824".</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>enable_ha</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Enable High Availability state sharing.  The default is set to off.</TD>
</TR>
</TABLE>
</DIV>

<P>

<H3><A NAME="SECTION00322300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Session HA Configuration</A>
</H3>

<P>
Configuration for HA session state sharing.

<P>
<PRE>
    preprocessor stream5_ha: [min_session_lifetime &lt;num millisecs&gt;], \
        [min_sync_interval &lt;num millisecs&gt;], [startup_input_file &lt;filename&gt;], \
        [runtime_output_file &lt;filename&gt;], [use_side_channel]
</PRE>

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>min_session_lifetime &lt;num millisecs&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Minimum session liftime in milliseconds.  HA update messages will only be generated once a session has existed for
at least this long.  The default is 0, the minimum is 0, and the maximum is 65535.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>min_sync_interval &lt;num millisecs&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Minimum synchronization interval in milliseconds.  HA update messages will not be generated more often than
once per interval on a given session.  The default is 0, the minimum is 0, and the maximum is 65535.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>startup_input_file &lt;filename&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
The name of a file for snort to read HA messages from at startup.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>runtime_output_file &lt;filename&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
The name of a file to which Snort will write all HA messages that are generated while it is running.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>use_side_channel</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Indicates that all HA messages should also be sent to the side channel for processing.</TD>
</TR>
</TABLE>
</DIV>

<P>

<H3><A NAME="SECTION00322400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN> Example Configurations</A>
</H3>

<P>

<OL>
<LI>

<P>
This example configuration sets a maximum number of TCP session control blocks to 8192, 
enables tracking of TCP and UPD sessions, and disables tracking of ICMP sessions.  The 
number of UDP session control blocks will be set to the compiled default. 

<P>
<PRE>
    preprocessor stream5_global: \
        max_tcp 8192, track_tcp yes, track_udp yes, track_icmp no

    preprocessor stream5_tcp: \
        policy first, use_static_footprint_sizes

    preprocessor stream5_udp: \
        ignore_any_rules
</PRE>

<P>
</LI>
</OL>

<P>

<H2><A NAME="SECTION00323000000000000000"></A>
<A NAME="stream5_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream
</H2>

<P>
The Stream preprocessor is a target-based TCP reassembly module for Snort.  It
is capable of tracking sessions for both TCP and UDP.  

<P>

<H3><A NAME="SECTION00323100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Transport Protocols</A>
</H3>

<P>
TCP sessions are identified via the classic TCP "connection".  UDP sessions are
established as the result of a series of UDP packets from two end points via
the same set of ports.  ICMP messages are tracked for the purposes of checking
for unreachable and service unavailable messages, which effectively terminate a
TCP or UDP session.

<P>

<H3><A NAME="SECTION00323200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target-Based</A>
</H3>

<P>
Stream, like Frag3, introduces target-based actions for handling of
overlapping data and other TCP anomalies.  The methods for handling overlapping
data, TCP Timestamps, Data on SYN, FIN and Reset sequence numbers, etc. and the
policies supported by Stream are the results of extensive research with many
target operating systems.

<P>

<H3><A NAME="SECTION00323300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream API</A>
</H3>

<P>
Stream supports the modified Stream API that is now focused on
functions specific to reassembly and protocol aware flushing
operations.  Session management functions have been moved to the
Session API.  The remaining API functions enable other protocol 
normalizers/preprocessors to dynamically configure reassembly 
behavior as required by the application layer protocol.

<P>

<H3><A NAME="SECTION00323400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">4</SPAN> Anomaly Detection</A>
</H3>

<P>
TCP protocol anomalies, such as data on SYN packets, data received outside the
TCP window, etc are configured via the <TT>detect_anomalies</TT> option to the
TCP configuration.  Some of these anomalies are detected on a per-target basis.
For example, a few operating systems allow data in TCP SYN packets, while
others do not.

<P>

<H3><A NAME="SECTION00323500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">5</SPAN> Protocol Aware Flushing</A>
</H3>

<P>
Protocol aware flushing of HTTP, SMB and DCE/RPC can be enabled with this option:

<P>
<PRE>
config paf_max: &lt;max-pdu&gt;
</PRE>

<P>
where <TT>&lt;max-pdu&gt;</TT> is between zero (off) and 63780.  This allows Snort to
statefully scan a stream and reassemble a complete PDU regardless of
segmentation.  For example, multiple PDUs within a single TCP segment, as well
as one PDU spanning multiple TCP segments will be reassembled into one PDU per
packet for each PDU.  PDUs larger than the configured maximum will be split
into multiple packets.

<P>

<H3><A NAME="SECTION00323600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">6</SPAN> Stream TCP Configuration</A>
</H3>

<P>
Provides a means on a per IP address target to configure TCP policy.  This can
have multiple occurrences, per policy that is bound to an IP address or network.
One default policy must be specified, and that policy is not bound to an IP
address or network.

<P>
<PRE>
    preprocessor stream5_tcp: \
        [log_asymmetric_traffic &lt;yes|no&gt;], \
        [bind_to &lt;ip_addr&gt;], \
        [timeout &lt;number secs&gt;], [policy &lt;policy_id&gt;], \
        [overlap_limit &lt;number&gt;], [max_window &lt;number&gt;], \
        [require_3whs [&lt;number secs&gt;]], [detect_anomalies], \
        [check_session_hijacking], [use_static_footprint_sizes], \
        [dont_store_large_packets], [dont_reassemble_async], \
        [max_queued_bytes &lt;bytes&gt;], [max_queued_segs &lt;number segs&gt;], \
        [small_segments &lt;number&gt; bytes &lt;number&gt; [ignore_ports number [number]*]],  \
        [ports &lt;client|server|both&gt; &lt;all|number|!number [number]* [!number]*&gt;], \
        [protocol &lt;client|server|both&gt; &lt;all|service name [service name]*&gt;], \
        [ignore_any_rules], [flush_factor &lt;number segs&gt;]
</PRE>

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT" VALIGN="TOP" WIDTH=144><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=288><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>bind_to &lt;ip_addr&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
IP address or network for this policy.  The default is set to any.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>timeout &lt;num seconds&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Session timeout.  The default is "30",  the minimum is "1", and the maximum is
"86400" (approximately 1 day).</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>policy &lt;policy_id&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
The Operating System policy for the target OS.  The policy_id can be one of
the following:

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Policy Name</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Operating Systems.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>first</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180><P>
Favor first overlapped segment.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>last</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Favor last overlapped segment.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>bsd</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>FresBSD 4.x and newer, NetBSD 2.x and newer, OpenBSD 3.x and newer</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>linux</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Linux 2.4 and newer</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>old-linux</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Linux 2.2 and earlier</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>windows</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Windows 2000, Windows XP, Windows 95/98/ME</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>win2003</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Windows 2003 Server</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>vista</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Windows Vista</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>solaris</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>Solaris 9.x and newer</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>hpux</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>HPUX 11 and newer</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>hpux10</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>HPUX 10</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>irix</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>IRIX 6 and newer</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>macos</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=180>MacOS 10.3 and newer</TD>
</TR>
</TABLE></TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>overlap_limit &lt;number&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Limits the number of overlapping packets per session.  The default is "0"
(unlimited), the minimum is "0", and the maximum is "255".</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>max_window &lt;number&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Maximum TCP window allowed.  The default is "0" (unlimited), the minimum is
"0", and the maximum is "1073725440" (65535 left shift 14).  That is the
highest possible TCP window per RFCs.  This option is intended to prevent a DoS
against Stream by an attacker using an abnormally large window, so using a
value near the maximum is discouraged.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>require_3whs [&lt;number seconds&gt;]</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Establish sessions only on completion of a SYN/SYN-ACK/ACK handshake.  The
default is set to off.  The optional number of seconds specifies a startup
timeout.  This allows a grace period for existing sessions to be considered
established during that interval immediately after Snort is started.  The
default is "0" (don't consider existing sessions established), the minimum is
"0", and the maximum is "86400" (approximately 1 day).</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>detect_anomalies</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Detect and alert on TCP protocol anomalies.  The default is set to off.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>check_session_hijacking</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Check for TCP session hijacking.  This check validates the hardware (MAC)
address from both sides of the connect - as established on the 3-way handshake
against subsequent packets received on the session.  If an ethernet layer is
not part of the protocol stack received by Snort, there are no checks
performed.  Alerts are generated (per '<TT>detect_anomalies</TT>' option) for
either the client or server when the MAC address for one side or the other does
not match.  The default is set to off.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>use_static_footprint_sizes</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Use static values for determining when to build a reassembled packet to
allow for repeatable tests.  This option should not be used production
environments.  The default is set to off.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>dont_store_large_packets</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Performance improvement to not queue large packets in reassembly buffer.  The
default is set to off.  Using this option may result in missed attacks.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>dont_reassemble_async</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Don't queue packets for reassembly if traffic has not been seen in both
directions.  The default is set to queue packets.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>max_queued_bytes &lt;bytes&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Limit the number of bytes queued for reassembly on a given TCP session to
bytes.  Default is "1048576" (1MB).  A value of "0" means unlimited, with a
non-zero minimum of "1024", and a maximum of "1073741824" (1GB).  A message is
written to console/syslog when this limit is enforced.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>max_queued_segs &lt;num&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Limit the number of segments queued for reassembly on a given TCP session.  The
default is "2621", derived based on an average size of 400 bytes.  A value of
"0" means unlimited, with a non-zero minimum of "2", and a maximum of
"1073741824" (1GB).  A message is written to console/syslog when this limit is
enforced.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>small_segments &lt;number&gt; bytes &lt;number&gt; [ignore_ports &lt;number(s)&gt; ]</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Configure the maximum small segments queued. This feature requires that 
detect_anomalies be enabled. The first number is the number of consecutive segments 
that will trigger the detection rule. The default value is "0" (disabled), with a 
maximum of "2048". The second number is the minimum bytes for a segment to be 
considered "small". The default value is "0" (disabled), with a maximum of "2048".  
ignore_ports is optional, defines the list of ports in which will be ignored for 
this rule. The number of ports can be up to "65535".  A message is written to 
console/syslog when this limit is enforced.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>ports &lt;client|server|both&gt; &lt;all|number(s)|!number(s)&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Specify the client, server, or both and list of ports in which to perform
reassembly.  This can appear more than once in a given config.  The default
settings are <TT>ports client 21 23 25 42 53 80 110 111 135 136 137 139 143
445 513 514 1433 1521 2401 3306</TT>.  The minimum port allowed is "1" and the
maximum allowed is "65535".  To disable reassembly for a port specifiy the port
number preceeded by an '!', e.g. !8080 !25</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>protocol &lt;client|server|both&gt; &lt;all|service name(s)&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Specify the client, server, or both and list of services in which to perform
reassembly.  This can appear more than once in a given config.  The default
settings are <TT>ports client ftp telnet smtp nameserver dns http pop3
sunrpc dcerpc netbios-ssn imap login shell mssql oracle cvs mysql</TT>.  The
service names can be any of those used in the host attribute table (see
<A HREF="node22.html#targetbased"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>), including any of the internal defaults (see
<A HREF="node22.html#attribute:service_names"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>) or others specific to the network.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>ignore_any_rules</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Don't process any <TT>-&gt;</TT> any (ports) rules for TCP that attempt to match
payload if there are no port specific rules for the src or destination port.
Rules that have flow or flowbits will never be ignored.  This is a performance
improvement and may result in missed attacks.  Using this does not affect rules
that look at protocol headers, only those with content, PCRE, or byte test
options.  The default is "off". This option can be used only in default
policy.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=144><TT>flush_factor</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=288><P>
Useful in ips mode to flush upon seeing a drop in segment size after N
segments of non-decreasing size.  The drop in size often indicates an
end of request or response.</TD>
</TR>
</TABLE>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
If no options are specified for a given TCP policy, that is the default TCP
policy.  If only a bind_to option is used with no other options that TCP
policy uses all of the default values.

<P>
        
        </b></td></tr></table></p>

<P>

<H3><A NAME="SECTION00323700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">7</SPAN> Stream UDP Configuration</A>
</H3>

<P>
Configuration for UDP session tracking.  Since there is no target based
binding, there should be only one occurrence of the UDP configuration.

<P>
<PRE>
    preprocessor stream5_udp: [timeout &lt;number secs&gt;], [ignore_any_rules]
</PRE>

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>timeout &lt;num seconds&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Session timeout.  The default is "30", the minimum is "1", and the maximum is
"86400" (approximately 1 day).</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ignore_any_rules</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Don't process any <TT>-&gt;</TT> any (ports) rules for UDP that attempt to match
payload if there are no port specific rules for the src or destination port.
Rules that have flow or flowbits will never be ignored.  This is a performance
improvement and may result in missed attacks.  Using this does not affect rules
that look at protocol headers, only those with content, PCRE, or byte test
options.  The default is "off".</TD>
</TR>
</TABLE>
</DIV>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
With the ignore_any_rules option, a UDP rule will be ignored except when
there is another port specific rule that may be applied to the traffic.  For
example, if a UDP rule specifies destination port 53, the 'ignored' any
<TT>-&gt;</TT> any rule will be applied to traffic to/from port 53, but NOT to any
other source or destination port.  A list of rule SIDs affected by this option
are printed at Snort's startup.

<P>
        
        </b></td></tr></table></p>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
With the ignore_any_rules option, if a UDP rule that uses any <TT>-&gt;</TT> any
ports includes either flow or flowbits, the ignore_any_rules option is
effectively pointless.  Because of the potential impact of disabling a flowbits
rule, the ignore_any_rules option will be disabled in this case.

<P>
        
        </b></td></tr></table></p>

<P>

<H3><A NAME="SECTION00323800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">8</SPAN> Stream ICMP Configuration</A>
</H3>

<P>
Configuration for ICMP session tracking.  Since there is no target based
binding, there should be only one occurrence of the ICMP configuration.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
ICMP is currently untested, in minimal code form and is NOT ready for use in
production networks.  It is not turned on by default.

<P>
        
        </b></td></tr></table></p>

<P>
<PRE>
    preprocessor stream5_icmp: [timeout &lt;number secs&gt;]
</PRE>

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>timeout &lt;num seconds&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Session timeout.  The default is "30", the minimum is "1", and the maximum is
"86400" (approximately 1 day).</TD>
</TR>
</TABLE>
</DIV>

<P>

<H3><A NAME="SECTION00323900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">9</SPAN> Stream IP Configuration</A>
</H3>

<P>
Configuration for IP session tracking.  Since there is no target based
binding, there should be only one occurrence of the IP configuration.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
"IP" includes all non-TCP/UDP traffic over IP including ICMP if ICMP
not otherwise configured.  It is not turned on by default.

<P>
        
        </b></td></tr></table></p>

<P>
<PRE>
    preprocessor stream5_ip: [timeout &lt;number secs&gt;]
</PRE>

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>timeout &lt;num seconds&gt;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324><P>
Session timeout.  The default is "30", the minimum is "1", and the maximum is
"86400" (approximately 1 day).</TD>
</TR>
</TABLE>
</DIV>

<P>

<H3><A NAME="SECTION003231000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">10</SPAN> Example Configurations</A>
</H3>

<P>

<OL>
<LI>

<P>
This example configuration is the default configuration in snort.conf and
can be used for repeatable tests of stream reassembly in readback mode.

<P>
<PRE>
    preprocessor stream5_global: \
        max_tcp 8192, track_tcp yes, track_udp yes, track_icmp no

    preprocessor stream5_tcp: \
        policy first, use_static_footprint_sizes

    preprocessor stream5_udp: \
        ignore_any_rules
</PRE>

<P>
</LI>
<LI>

<P>
This configuration maps two network segments to different OS policies, one for
Windows and one for Linux, with all other traffic going to the default policy
of Solaris.

<P>
<PRE>
    preprocessor stream5_global: track_tcp yes
    preprocessor stream5_tcp: bind_to 192.168.1.0/24, policy windows
    preprocessor stream5_tcp: bind_to 10.1.1.0/24, policy linux
    preprocessor stream5_tcp: policy solaris
</PRE>

<P>
</LI>
</OL>

<P>

<H2><A NAME="SECTION00324000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN> sfPortscan</A>
</H2>

<P>
The sfPortscan module, developed by Sourcefire, is designed to detect the first
phase in a network attack: Reconnaissance. In the Reconnaissance phase, an
attacker determines what types of network protocols or services a host
supports. This is the traditional place where a portscan takes place. This
phase assumes the attacking host has no prior knowledge of what protocols or
services are supported by the target; otherwise, this phase would not be
necessary.

<P>
As the attacker has no beforehand knowledge of its intended target, most
queries sent by the attacker will be negative (meaning that the service ports
are closed). In the nature of legitimate network communications, negative
responses from hosts are rare, and rarer still are multiple negative responses
within a given amount of time.  Our primary objective in detecting portscans is
to detect and track these negative responses.

<P>
One of the most common portscanning tools in use today is Nmap. Nmap
encompasses many, if not all, of the current portscanning techniques.
sfPortscan was designed to be able to detect the different types of scans Nmap
can produce.

<P>
sfPortscan will currently alert for the following types of Nmap scans:

<P>

<UL>
<LI>TCP Portscan
</LI>
<LI>UDP Portscan
</LI>
<LI>IP Portscan
</LI>
</UL>

<P>
These alerts are for one<SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$\rightarrow$"></SPAN>one portscans, which are the traditional
types of scans; one host scans multiple ports on another host. Most of the port
queries will be negative, since most hosts have relatively few services
available.

<P>
sfPortscan also alerts for the following types of decoy portscans:

<P>

<UL>
<LI>TCP Decoy Portscan
</LI>
<LI>UDP Decoy Portscan
</LI>
<LI>IP Decoy Portscan
</LI>
</UL>

<P>
Decoy portscans are much like the Nmap portscans described above, only the
attacker has a spoofed source address inter-mixed with the real scanning
address. This tactic helps hide the true identity of the attacker.

<P>
sfPortscan alerts for the following types of distributed portscans:

<P>

<UL>
<LI>TCP Distributed Portscan
</LI>
<LI>UDP Distributed Portscan
</LI>
<LI>IP Distributed Portscan
</LI>
</UL>

<P>
These are many<SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$\rightarrow$"></SPAN>one portscans. Distributed portscans occur when
multiple hosts query one host for open services. This is used to evade an IDS
and obfuscate command and control hosts.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Negative queries will be distributed among scanning hosts, so we track this
type of scan through the scanned host.

<P>
        
        </b></td></tr></table></p>

<P>
sfPortscan alerts for the following types of portsweeps:

<P>

<UL>
<LI>TCP Portsweep
</LI>
<LI>UDP Portsweep
</LI>
<LI>IP Portsweep
</LI>
<LI>ICMP Portsweep
</LI>
</UL>

<P>
These alerts are for one<SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$\rightarrow$"></SPAN>many portsweeps. One host scans a single
port on multiple hosts. This usually occurs when a new exploit comes out and
the attacker is looking for a specific service. 

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
The characteristics of a portsweep scan may not result in many negative
responses. For example, if an attacker portsweeps a web farm for port 80, we
will most likely not see many negative responses.

<P>
        
        </b></td></tr></table></p>

<P>
sfPortscan alerts on the following filtered portscans and portsweeps:

<P>

<UL>
<LI>TCP Filtered Portscan
</LI>
<LI>UDP Filtered Portscan
</LI>
<LI>IP Filtered Portscan

<P>
</LI>
<LI>TCP Filtered Decoy Portscan
</LI>
<LI>UDP Filtered Decoy Portscan
</LI>
<LI>IP Filtered Decoy Portscan

<P>
</LI>
<LI>TCP Filtered Portsweep
</LI>
<LI>UDP Filtered Portsweep
</LI>
<LI>IP Filtered Portsweep
</LI>
<LI>ICMP Filtered Portsweep

<P>
</LI>
<LI>TCP Filtered Distributed Portscan
</LI>
<LI>UDP Filtered Distributed Portscan
</LI>
<LI>IP Filtered Distributed Portscan
</LI>
</UL>

<P>
&ldquo;Filtered&rdquo; alerts indicate that there were no network errors (ICMP
unreachables or TCP RSTs) or responses on closed ports have been suppressed.
It's also a good indicator of whether the alert is just a very active
legitimate host. Active hosts, such as NATs, can trigger these alerts because
they can send out many connection attempts within a very small amount of time.
A filtered alert may go off before responses from the remote hosts are
received.

<P>
sfPortscan only generates one alert for each host pair in question during the
time window (more on windows below). On TCP scan alerts, sfPortscan will also
display any open ports that were scanned. On TCP sweep alerts however,
sfPortscan will only track open ports after the alert has been triggered. Open
port events are not individual alerts, but tags based on the original scan
alert.

<P>

<H3><A NAME="SECTION00324100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> sfPortscan Configuration</A>
</H3>

<P>
Use of the Stream preprocessor is required for sfPortscan. Stream gives
portscan direction in the case of connectionless protocols like ICMP and UDP.
You should enable the Stream preprocessor in your <TT>snort.conf</TT>, as
described in Section <A HREF="#stream5_section"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
The parameters you can use to configure the portscan module are:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">8</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">proto <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>protocol<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options:

<P>

<UL>
<LI><TT>TCP</TT>
</LI>
<LI><TT>UDP</TT>
</LI>
<LI><TT>ICMP</TT>
</LI>
<LI><TT>ip_proto</TT>
</LI>
<LI><TT>all</TT>
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">9</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">scan_type <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>scan_type<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options: 

<P>

<UL>
<LI><TT>portscan</TT> 
</LI>
<LI><TT>portsweep</TT> 
</LI>
<LI><TT>decoy_portscan</TT>
</LI>
<LI><TT>distributed_portscan</TT>
</LI>
<LI><TT>all</TT>
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">10</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">sense_level <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>level<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options:

<P>

<UL>
<LI><TT>low</TT> - &ldquo;Low&rdquo; alerts are only generated on error packets sent
from the target host, and because of the nature of error responses, this
setting should see very few false positives. However, this setting will never
trigger a Filtered Scan alert because of a lack of error responses. This
setting is based on a static time window of 60 seconds, after which this window
is reset.

<P>
</LI>
<LI><TT>medium</TT> - &ldquo;Medium&rdquo; alerts track connection counts, and so will
generate filtered scan alerts. This setting may false positive on active hosts
(NATs, proxies, DNS caches, etc), so the user may need to deploy the use of
Ignore directives to properly tune this directive.

<P>
</LI>
<LI><TT>high</TT> - &ldquo;High&rdquo; alerts continuously track hosts on a network
using a time window to evaluate portscan statistics for that host. A "High"
setting will catch some slow scans because of the continuous monitoring, but is
very sensitive to active hosts. This most definitely will require the user to
tune sfPortscan.

<P>
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">11</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">watch_ip <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>ip1<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>ip2/cidr[ [port<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>port2-port3]]<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Defines which IPs, networks, and specific ports on those hosts to watch.  The
list is a comma separated list of IP addresses, IP address using CIDR notation.
Optionally, ports are specified after the IP address/CIDR using a space and can
be either a single port or a range denoted by a dash.  IPs or networks not
falling into this range are ignored if this option is used.

<P>
<DT> <B><SPAN CLASS="arabic">12</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">ignore_scanners <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>ip1<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>ip2/cidr[ [port<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>port2-port3]]<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Ignores the source of scan alerts.  The parameter is the same format as that of
<TT>watch_ip</TT>.

<P>
<DT> <B><SPAN CLASS="arabic">13</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">ignore_scanned <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>ip1<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>ip2/cidr[ [port<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>port2-port3]]<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Ignores the destination of scan alerts.  The parameter is the same format as
that of <TT>watch_ip</TT>.

<P>
<DT> <B><SPAN CLASS="arabic">14</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">logfile <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>file<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> </SPAN> 

<P>
This option will output portscan events to the file specified. If <TT>file</TT>
does not contain a leading slash, this file will be placed in the Snort config
dir.

<P>
<DT> <B><SPAN CLASS="arabic">15</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">include_midstream</SPAN>

<P>
This option will include sessions picked up in midstream by Stream.
This can lead to false alerts, especially under heavy load with dropped
packets; which is why the option is off by default.

<P>
<DT> <B><SPAN CLASS="arabic">16</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">detect_ack_scans</SPAN>

<P>
This option will include sessions picked up in midstream by the stream module,
which is necessary to detect ACK scans.  However, this can lead to false
alerts, especially under heavy load with dropped packets; which is why the
option is off by default.

<P>
<DT> <B><SPAN CLASS="arabic">17</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">disabled</SPAN>

<P>
This optional keyword is allowed with any policy to avoid packet processing.
This option disables the preprocessor. When the preprocessor is disabled
only the memcap option is applied when specified with the configuration.
The other options are parsed but not used. Any valid configuration may have
"disabled" added to it.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION00324200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>

<P>
<PRE>
    preprocessor sfportscan: proto &lt;protocols&gt; \
        scan_type &lt;portscan|portsweep|decoy_portscan|distributed_portscan|all&gt; \
        sense_level &lt;low|medium|high&gt; \
        watch_ip &lt;IP or IP/CIDR&gt; \
        ignore_scanners &lt;IP list&gt; \
        ignore_scanned &lt;IP list&gt; \
        logfile &lt;path and filename&gt; \
        disabled
</PRE>

<P>

<H3><A NAME="SECTION00324300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example</A>
</H3>

<P>
<PRE>
    preprocessor flow: stats_interval 0 hash 2
    preprocessor sfportscan:\
        proto { all } \
        scan_type { all } \
        sense_level { low }
</PRE>

<P>

<H3><A NAME="SECTION00324400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> sfPortscan Alert Output</A>
</H3>

<P>

<H4><A NAME="SECTION00324410000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Unified Output</A>
</H4>

<P>
In order to get all the portscan information logged with the alert, snort
generates a pseudo-packet and uses the payload portion to store the additional
portscan information of priority count, connection count, IP count, port count,
IP range, and port range.  The characteristics of the packet are:

<P>
<PRE>
    Src/Dst MAC Addr == MACDAD
    IP Protocol == 255
    IP TTL == 0
</PRE>

<P>
Other than that, the packet looks like the IP portion of the packet that caused
the portscan alert to be generated.  This includes any IP options, etc.  The
payload and payload size of the packet are equal to the length of the
additional portscan information that is logged.  The size tends to be around
100 - 200 bytes.

<P>
Open port alerts differ from the other portscan alerts, because open port
alerts utilize the tagged packet output system.  This means that if an output
system that doesn't print tagged packets is used, then the user won't see open
port alerts.  The open port information is stored in the IP payload and
contains the port that is open.

<P>
The sfPortscan alert output was designed to work with unified2 packet logging,
so it is possible to extend favorite Snort GUIs to display portscan alerts and
the additional information in the IP payload using the above packet
characteristics.

<P>

<H4><A NAME="SECTION00324420000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Log File Output</A>
</H4>

<P>
Log file output is displayed in the following format, and explained further
below:

<P>
<PRE>
    Time: 09/08-15:07:31.603880
    event_id: 2
    192.168.169.3 -&gt; 192.168.169.5 (portscan) TCP Filtered Portscan
    Priority Count: 0
    Connection Count: 200
    IP Count: 2
    Scanner IP Range: 192.168.169.3:192.168.169.4
    Port/Proto Count: 200
    Port/Proto Range: 20:47557
</PRE>

<P>
If there are open ports on the target, one or more additional tagged packet(s)
will be appended:

<P>
<PRE>
    Time: 09/08-15:07:31.603881
    event_ref: 2
    192.168.169.3 -&gt; 192.168.169.5 (portscan) Open Port
    Open Port: 38458
</PRE>

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">18</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Event_id/Event_ref</SPAN>

<P>
These fields are used to link an alert with the corresponding <TT>Open
Port</TT> tagged packet

<P>
<DT> <B><SPAN CLASS="arabic">19</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Priority Count</SPAN>

<P>
<TT>Priority Count</TT> keeps track of bad responses (resets, unreachables).
The higher the priority count, the more bad responses have been received.

<P>
<DT> <B><SPAN CLASS="arabic">20</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Connection Count</SPAN>

<P>
<TT>Connection Count</TT> lists how many connections are active on the hosts
(src or dst). This is accurate for connection-based protocols, and is more of
an estimate for others. Whether or not a portscan was filtered is determined
here. High connection count and low priority count would indicate filtered (no
response received from target).

<P>
<DT> <B><SPAN CLASS="arabic">21</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">IP Count</SPAN>

<P>
IP Count keeps track of the last IP to contact a host, and increments the count
if the next IP is different. For one-to-one scans, this is a low number. For
active hosts this number will be high regardless, and one-to-one scans may
appear as a distributed scan.

<P>
<DT> <B><SPAN CLASS="arabic">22</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Scanned/Scanner IP Range</SPAN>

<P>
This field changes depending on the type of alert. Portsweep (one-to-many)
scans display the scanned IP range; Portscans (one-to-one) display the scanner
IP. 

<P>
<DT> <B><SPAN CLASS="arabic">23</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Port Count</SPAN>

<P>
Port Count keeps track of the last port contacted and increments this number
when that changes. We use this count (along with IP Count) to determine the
difference between one-to-one portscans and one-to-one decoys.   
</DD>
</DL> 
<P>

<H3><A NAME="SECTION00324500000000000000"></A>
<A NAME="tuning_sfportscan"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Tuning sfPortscan
</H3>

<P>
The most important aspect in detecting portscans is tuning the detection engine
for your network(s).  Here are some tuning tips:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">24</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Use the watch_ip, ignore_scanners, and ignore_scanned options.</SPAN>

<P>
It's important to correctly set these options.  The <TT>watch_ip</TT> option
is easy to understand.  The analyst should set this option to the list of CIDR
blocks and IPs that they want to watch.  If no <TT>watch_ip</TT> is defined,
sfPortscan will watch all network traffic.

<P>
The <TT>ignore_scanners</TT> and <TT>ignore_scanned</TT> options come into
play in weeding out legitimate hosts that are very active on your network.
Some of the most common examples are NAT IPs, DNS cache servers, syslog
servers, and nfs servers.  sfPortscan may not generate false positives for
these types of hosts, but be aware when first tuning sfPortscan for these IPs.
Depending on the type of alert that the host generates, the analyst will know
which to ignore it as.  If the host is generating portsweep events, then add it
to the <TT>ignore_scanners</TT> option.  If the host is generating portscan
alerts (and is the host that is being scanned), add it to the
<TT>ignore_scanned</TT> option.

<P>
<DT> <B><SPAN CLASS="arabic">25</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Filtered scan alerts are much more prone to false positives.</SPAN>

<P>
When determining false positives, the alert type is very important.  Most of
the false positives that sfPortscan may generate are of the filtered scan alert
type.  So be much more suspicious of filtered portscans.  Many times this just
indicates that a host was very active during the time period in question.  If
the host continually generates these types of alerts, add it to the
<TT>ignore_scanners</TT> list or use a lower sensitivity level.

<P>
<DT> <B><SPAN CLASS="arabic">26</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Make use of the Priority Count, Connection Count, IP Count, Port
Count, IP Range, and Port Range to determine false positives.</SPAN>

<P>
The portscan alert details are vital in determining the scope of a portscan and
also the confidence of the portscan.  In the future, we hope to automate much
of this analysis in assigning a scope level and confidence level, but for now
the user must manually do this.  The easiest way to determine false positives
is through simple ratio estimations.  The following is a list of ratios to
estimate and the associated values that indicate a legitimate scan and not a
false positive.

<P>
<SPAN  CLASS="textbf">Connection Count / IP Count:</SPAN>  This ratio indicates an estimated
average of connections per IP.  For portscans, this ratio should be high, the
higher the better.  For portsweeps, this ratio should be low.

<P>
<SPAN  CLASS="textbf">Port Count / IP Count:</SPAN>  This ratio indicates an estimated average of
ports connected to per IP.  For portscans, this ratio should be high and
indicates that the scanned host's ports were connected to by fewer IPs.  For
portsweeps, this ratio should be low, indicating that the scanning host
connected to few ports but on many hosts.

<P>
<SPAN  CLASS="textbf">Connection Count / Port Count:</SPAN>  This ratio indicates an estimated
average of connections per port.  For portscans, this ratio should be low.
This indicates that each connection was to a different port.  For portsweeps,
this ratio should be high.  This indicates that there were many connections to
the same port.

<P>
The reason that <TT>Priority Count</TT> is not included, is because the
priority count is included in the connection count and the above comparisons
take that into consideration.  The Priority Count play an important role in
tuning because the higher the priority count the more likely it is a real
portscan or portsweep (unless the host is firewalled).

<P>
<DT> <B><SPAN CLASS="arabic">27</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">If all else fails, lower the sensitivity level.</SPAN>

<P>
If none of these other tuning techniques work or the analyst doesn't have the
time for tuning, lower the sensitivity level.  You get the best protection the
higher the sensitivity level, but it's also important that the portscan
detection engine generate alerts that the analyst will find informative.  The
low sensitivity level only generates alerts based on error responses.  These
responses indicate a portscan and the alerts generated by the low sensitivity
level are highly accurate and require the least tuning.  The low sensitivity
level does not catch filtered scans; since these are more prone to false
positives.   
</DD>
</DL> 
<P>

<H2><A NAME="SECTION00325000000000000000"></A>
<A NAME="sub:rpc-decoder"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">5</SPAN> RPC Decode
</H2>

<P>
The rpc_decode preprocessor normalizes RPC multiple fragmented records into a
single un-fragmented record.  It does this by normalizing the packet into the
packet buffer.  If stream5 is enabled, it will only process client-side
traffic.  By default, it runs against traffic on ports 111 and 32771.

<P>

<H3><A NAME="SECTION00325100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>

<P>
<PRE>
    preprocessor rpc_decode: \
        &lt;ports&gt; [ alert_fragments ] \
        [no_alert_multiple_requests] \
        [no_alert_large_fragments] \
        [no_alert_incomplete]
</PRE>

<P>
<BR>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>alert_fragments</TT></TD>
<TD ALIGN="LEFT"><P>
Alert on any fragmented RPC record.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>no_alert_multiple_requests</TT></TD>
<TD ALIGN="LEFT"><P>
Don't alert when there are multiple records in one packet.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>no_alert_large_fragments</TT></TD>
<TD ALIGN="LEFT"><P>
Don't alert when the sum of fragmented records exceeds one packet.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>no_alert_incomplete</TT></TD>
<TD ALIGN="LEFT"><P>
Don't alert when a single fragment record exceeds the size of one packet.</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>

<H2><A NAME="SECTION00326000000000000000"></A>
<A NAME="sub:perfmonitor"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">6</SPAN> Performance Monitor
</H2>

<P>
This preprocessor measures Snort's real-time and theoretical maximum
performance.  Whenever this preprocessor is turned on, it should have an output
mode enabled, either &ldquo;console&rdquo; which prints statistics to the console window
or &ldquo;file&rdquo; with a file name, where statistics get printed to the specified
file name. By default, Snort's real-time statistics are processed. This
includes:

<P>

<UL>
<LI>Time Stamp
</LI>
<LI>Drop Rate
</LI>
<LI>Mbits/Sec (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Alerts/Sec 
</LI>
<LI>K-Pkts/Sec (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Avg Bytes/Pkt (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Pat-Matched [percent of data received that Snort processes in pattern matching]
</LI>
<LI>Syns/Sec
</LI>
<LI>SynAcks/Sec
</LI>
<LI>New Sessions Cached/Sec
</LI>
<LI>Sessions Del fr Cache/Sec
</LI>
<LI>Current Cached Sessions
</LI>
<LI>Max Cached Sessions
</LI>
<LI>Stream Flushes/Sec
</LI>
<LI>Stream Session Cache Faults
</LI>
<LI>Stream Session Cache Timeouts
</LI>
<LI>New Frag Trackers/Sec
</LI>
<LI>Frag-Completes/Sec
</LI>
<LI>Frag-Inserts/Sec
</LI>
<LI>Frag-Deletes/Sec
</LI>
<LI>Frag-Auto Deletes/Sec [memory DoS protection]
</LI>
<LI>Frag-Flushes/Sec
</LI>
<LI>Frag-Current [number of current Frag Trackers]
</LI>
<LI>Frag-Max [max number of Frag Trackers at any time]
</LI>
<LI>Frag-Timeouts
</LI>
<LI>Frag-Faults
</LI>
<LI>Number of CPUs [*** Only if compiled with LINUX_SMP ***, the next three appear for each CPU]
</LI>
<LI>CPU usage (user)
</LI>
<LI>CPU usage (sys)
</LI>
<LI>CPU usage (Idle)
</LI>
<LI>Mbits/Sec (wire) [average mbits of total traffic]
</LI>
<LI>Mbits/Sec (ipfrag) [average mbits of IP fragmented traffic]
</LI>
<LI>Mbits/Sec (ipreass) [average mbits Snort injects after IP reassembly]
</LI>
<LI>Mbits/Sec (tcprebuilt) [average mbits Snort injects after TCP reassembly]
</LI>
<LI>Mbits/Sec (applayer) [average mbits seen by rules and protocol decoders]
</LI>
<LI>Avg Bytes/Pkt (wire)
</LI>
<LI>Avg Bytes/Pkt (ipfrag)
</LI>
<LI>Avg Bytes/Pkt (ipreass)
</LI>
<LI>Avg Bytes/Pkt (tcprebuilt)
</LI>
<LI>Avg Bytes/Pkt (applayer)
</LI>
<LI>K-Pkts/Sec (wire)
</LI>
<LI>K-Pkts/Sec (ipfrag)
</LI>
<LI>K-Pkts/Sec (ipreass)
</LI>
<LI>K-Pkts/Sec (tcprebuilt)
</LI>
<LI>K-Pkts/Sec (applayer)
</LI>
<LI>Total Packets Received
</LI>
<LI>Total Packets Dropped (not processed)
</LI>
<LI>Total Packets Blocked (inline)
</LI>
<LI>Percentage of Packets Dropped
</LI>
<LI>Total Filtered TCP Packets
</LI>
<LI>Total Filtered UDP Packets
</LI>
<LI>Midstream TCP Sessions/Sec
</LI>
<LI>Closed TCP Sessions/Sec
</LI>
<LI>Pruned TCP Sessions/Sec
</LI>
<LI>TimedOut TCP Sessions/Sec
</LI>
<LI>Dropped Async TCP Sessions/Sec
</LI>
<LI>TCP Sessions Initializing
</LI>
<LI>TCP Sessions Established
</LI>
<LI>TCP Sessions Closing
</LI>
<LI>Max TCP Sessions (interval)
</LI>
<LI>New Cached UDP Sessions/Sec
</LI>
<LI>Cached UDP Ssns Del/Sec
</LI>
<LI>Current Cached UDP Sessions
</LI>
<LI>Max Cached UDP Sessions
</LI>
<LI>Current Attribute Table Hosts (Target Based)
</LI>
<LI>Attribute Table Reloads (Target Based)
</LI>
<LI>Mbits/Sec (Snort)
</LI>
<LI>Mbits/Sec (sniffing)
</LI>
<LI>Mbits/Sec (combined)
</LI>
<LI>uSeconds/Pkt (Snort)
</LI>
<LI>uSeconds/Pkt (sniffing)
</LI>
<LI>uSeconds/Pkt (combined)
</LI>
<LI>KPkts/Sec (Snort)
</LI>
<LI>KPkts/Sec (sniffing)
</LI>
<LI>KPkts/Sec (combined)
</LI>
</UL>

<P>
There are over 100 individual statistics included.  A header line is output at startup and
rollover that labels each column.

<P>
The following options can be used with the performance monitor:

<P>

<UL>
<LI><TT>flow</TT> - Prints out statistics about the type and amount of traffic
and protocol distributions that Snort is seeing. This option can produce large
amounts of output.

<P>
</LI>
<LI><TT>flow-file</TT> - Prints <TT>flow</TT> statistics in a comma-delimited
format to the file that is specified.

<UL>
<LI>Timestamp
</LI>
<LI>Total % TCP bytes
</LI>
<LI>Total % UDP bytes
</LI>
<LI>Total % ICMP bytes
</LI>
<LI>Total % OTHER bytes
</LI>
<LI>Number of Packet length entries
</LI>
<LI>Packet length entries - bytes,%total
</LI>
<LI>Number of TCP port flow entries
</LI>
<LI>TCP port flow entries : port,%total,%src,%dst
</LI>
<LI>% TCP high port to high port
</LI>
<LI>Number of UDP port flow entries
</LI>
<LI>UDP port flow entries : port,%total,%src,%dst
</LI>
<LI>% UDP high port to high port
</LI>
<LI>Number of ICMP type entries
</LI>
<LI>ICMP type entries : type,%total
</LI>
</UL>
Specifying this option implicitly enables <TT>flow</TT> statistics.

<P>
</LI>
<LI><TT>events</TT> - Turns on event reporting.  This prints out statistics
as to the number of rules that were evaluated and didn't match
(<SPAN  CLASS="textit">non-qualified events</SPAN>) vs. the number of rules that were evaluated and
matched (<SPAN  CLASS="textit">qualified events</SPAN>).  A high <SPAN  CLASS="textit">non-qualified event</SPAN> to
<SPAN  CLASS="textit">qualified event</SPAN> ratio can indicate there are many rules with either
minimal content or no content that are being evaluated without success.  The
fast pattern matcher is used to select a set of rules for evaluation based on
the longest <TT>content</TT> or a <TT>content</TT> modified with the
<TT>fast_pattern</TT> rule option in a rule.  Rules with short, generic
contents are more likely to be selected for evaluation than those with
longer, more unique contents.  Rules without <TT>content</TT> are not
filtered via the fast pattern matcher and are always evaluated, so if
possible, adding a <TT>content</TT> rule option to those rules can decrease the
number of times they need to be evaluated and improve performance.

<P>
</LI>
<LI><TT>max</TT> - Turns on the theoretical maximum performance that Snort
calculates given the processor speed and current performance.  This is only
valid for uniprocessor machines, since many operating systems don't keep
accurate kernel statistics for multiple CPUs.  

<P>
</LI>
<LI><TT>console</TT> - Prints statistics at the console.

<P>
</LI>
<LI><TT>file</TT> - Prints statistics in a comma-delimited format to the file
that is specified.  Not all statistics are output to this file.  You may also
use <TT>snortfile</TT> which will output into your defined Snort log directory.
Both of these directives can be overridden on the command line with the
<TT>-Z</TT> or <TT>-perfmon-file</TT> options.  At startup, Snort will log
a distinctive line to this file with a timestamp to all readers to easily identify
gaps in the stats caused by Snort not running.

<P>
</LI>
<LI><TT>pktcnt</TT> - Adjusts the number of packets to process before
checking for the time sample.  This boosts performance, since checking the time
sample reduces Snort's performance.  By default, this is 10000.  

<P>
</LI>
<LI><TT>time</TT> - Represents the number of seconds between intervals.

<P>
</LI>
<LI><TT>accumulate</TT> or <TT>reset</TT> - Defines which type of drop
statistics are kept by the operating system. By default, <TT>reset</TT> is
used.

<P>
</LI>
<LI><TT>atexitonly</TT> - Dump stats for entire life of Snort.
One or more of the following arguments can be given to specify specific
statistic types to dump at exit:

<UL>
<LI><TT>base-stats</TT>
</LI>
<LI><TT>flow-stats</TT>
</LI>
<LI><TT>flow-ip-stats</TT>
</LI>
<LI><TT>events-stats</TT>
</LI>
</UL>
Without any arguments, all enabled stats will be dumped only when Snort exits.

<P>
</LI>
<LI><TT>max_file_size</TT> - Defines the maximum size of the
comma-delimited file.  Before the file exceeds this size, it will be rolled
into a new date stamped file of the format YYYY-MM-DD, followed by
YYYY-MM-DD.x, where x will be incremented each time the comma delimited file
is rolled over.  The minimum is 4096 bytes and the maximum is 2147483648 bytes
(2GB).  The default is the same as the maximum.

<P>
</LI>
<LI><TT>flow-ip</TT> - Collects IP traffic distribution statistics based on
host pairs.  For each pair of hosts for which IP traffic has been seen, the
following statistics are collected for both directions (A to B and B to A):

<UL>
<LI>TCP Packets
</LI>
<LI>TCP Traffic in Bytes
</LI>
<LI>TCP Sessions Established
</LI>
<LI>TCP Sessions Closed
</LI>
<LI>UDP Packets
</LI>
<LI>UDP Traffic in Bytes
</LI>
<LI>UDP Sessions Created
</LI>
<LI>Other IP Packets
</LI>
<LI>Other IP Traffic in Bytes
</LI>
</UL>
These statistics are printed and reset at the end of each interval.

<P>
</LI>
<LI><TT>flow-ip-file</TT> - Prints the flow IP statistics in a
comma-delimited format to the file that is specified.  All of the statistics
mentioned above, as well as the IP addresses of the host pairs in
human-readable format, are included.

<P>
Each line in the file will have its values correspond (in order) to those below:

<UL>
<LI>IP Address A (String)
</LI>
<LI>IP Address B (String)
</LI>
<LI>TCP Packets from A to B
</LI>
<LI>TCP Traffic in Bytes from A to B
</LI>
<LI>TCP Packets from B to A
</LI>
<LI>TCP Traffic in Bytes from B to A
</LI>
<LI>UDP Packets from A to B
</LI>
<LI>UDP Traffic in Bytes from A to B
</LI>
<LI>UDP Packets from B to A
</LI>
<LI>UDP Traffic in Bytes from B to A
</LI>
<LI>Other IP Packets from A to B
</LI>
<LI>Other IP Traffic in Bytes from A to B
</LI>
<LI>Other IP Packets from B to A
</LI>
<LI>Other IP Traffic in Bytes from B to A
</LI>
<LI>TCP Sessions Established
</LI>
<LI>TCP Sessions Closed
</LI>
<LI>UDP Sessions Created
</LI>
</UL>

<P>
</LI>
<LI><TT>flow-ip-memcap</TT> - Sets the memory cap on the hash table used to
store IP traffic statistics for host pairs.  Once the cap has been reached, the
table will start to prune the statistics for the least recently seen host pairs
to free memory.  This value is in bytes and the default value is
52428800 (50MB).

<P>
</LI>
</UL>
<H3><A NAME="SECTION00326100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Examples</A>
</H3>

<P>
<PRE>
    preprocessor perfmonitor: \
        time 30 events flow file stats.profile max console pktcnt 10000 

    preprocessor perfmonitor: \
        time 300 file /var/tmp/snortstat pktcnt 10000

    preprocessor perfmonitor: \
        time 30 flow-ip flow-ip-file flow-ip-stats.csv pktcnt 1000

    preprocessor perfmonitor: \
        time 30 pktcnt 1000 snortfile base.csv flow-file flows.csv atexitonly flow-stats

    preprocessor perfmonitor: \
        time 30 pktcnt 1000 flow events atexitonly base-stats flow-stats console
</PRE>

<P>

<H2><A NAME="SECTION00327000000000000000"></A>
<A NAME="sub:http-inspect"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN> HTTP Inspect
</H2>

<P>
HTTP Inspect is a generic HTTP decoder for user applications.  Given a data
buffer, HTTP Inspect will decode the buffer, find HTTP fields, and normalize
the fields.  HTTP Inspect works on both client requests and server responses.

<P>
HTTP Inspect has a very &ldquo;rich&rdquo; user configuration.  Users can configure
individual HTTP servers with a variety of options, which should allow the user
to emulate any type of web server. Within HTTP Inspect, there are two areas of
configuration: global and server.

<P>

<H3><A NAME="SECTION00327100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
</H3>

<P>
The global configuration deals with configuration options that determine the
global functioning of HTTP Inspect.  The following example gives the generic
global configuration format:

<P>

<H3><A NAME="SECTION00327200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>
<PRE>
    preprocessor http_inspect: \
        global \
        iis_unicode_map &lt;map_filename&gt; \
        codemap &lt;integer&gt; \
        [detect_anomalous_servers] \
        [proxy_alert] \
        [max_gzip_mem &lt;num&gt;] \
        [compress_depth &lt;num&gt;] [decompress_depth &lt;num&gt;] \
        [memcap &lt;num&gt;] \
        disabled
</PRE>

<P>
You can only have a single global configuration, you'll get an error if you try
otherwise.

<P>

<H4><A NAME="SECTION00327210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">28</SPAN>.</B> 
<DD><TT>iis_unicode_map <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>map_filename<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> [codemap <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN>]</TT>

<P>
This is the global <TT>iis_unicode_map</TT> file.  The
<TT>iis_unicode_map</TT> is a required configuration parameter.  The map file
can reside in the same directory as <TT>snort.conf</TT> or be specified via a
fully-qualified path to the map file.

<P>
The <TT>iis_unicode_map</TT> file is a Unicode codepoint map which tells HTTP
Inspect which codepage to use when decoding Unicode characters.  For US
servers, the codemap is usually 1252.

<P>
A Microsoft US Unicode codepoint map is provided in the Snort source
<TT>etc</TT> directory by default.  It is called <TT>unicode.map</TT> and
should be used if no other codepoint map is available.  A tool is supplied with
Snort to generate custom Unicode <TT>maps-ms_unicode_generator.c</TT>, which
is available at <TT><A NAME="tex2html5"
  HREF="http://www.snort.org/dl/contrib/">http://www.snort.org/dl/contrib/</A></TT>.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Remember that this configuration is for the global IIS Unicode map, individual
servers can reference their own IIS Unicode map.

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">29</SPAN>.</B> 
<DD><TT>detect_anomalous_servers</TT>

<P>
This global configuration option enables generic HTTP server traffic inspection
on non-HTTP configured ports, and alerts if HTTP traffic is seen.  Don't turn
this on if you don't have a default server configuration that encompasses all
of the HTTP server ports that your users might access.  In the future, we want
to limit this to specific networks so it's more useful, but for right now, this
inspects all network traffic. This option is turned off by default.

<P>
<DT> <B><SPAN CLASS="arabic">30</SPAN>.</B> 
<DD><TT>proxy_alert</TT>

<P>
This enables global alerting on HTTP server proxy usage.  By configuring HTTP
Inspect servers and enabling <TT>allow_proxy_use</TT>, you will only receive
proxy use alerts for web users that aren't using the configured proxies or are
using a rogue proxy server.

<P>
Please note that if users aren't required to configure web proxy use, then you
may get a lot of proxy alerts.  So, please only use this feature with
traditional proxy environments. Blind firewall proxies don't count.

<P>
<DT> <B><SPAN CLASS="arabic">31</SPAN>.</B> 
<DD><TT>compress_depth <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>
This option specifies the maximum amount of packet payload to decompress. This
value can be set from 1 to 65535. The default for this option is 1460.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Please note, in case of multiple policies, the value specified in the default policy
is used and this value overwrites the values specified in the other policies. In case
of <TT>unlimited_decompress</TT> this should be set to its max value. This value should 
be specified in the default policy even when the HTTP inspect preprocessor is turned off 
using the <TT>disabled</TT> keyword.

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">32</SPAN>.</B> 
<DD><TT>decompress_depth <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>
This option specifies the maximum amount of decompressed data to obtain from the
compressed packet payload. This value can be set from 1 to 65535. The default for
this option is 2920.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Please note, in case of multiple policies, the value specified in the default policy
is used and this value overwrites the values specified in the other policies. In case
of <TT>unlimited_decompress</TT> this should be set to its max value. This value should 
be specified in the default policy even when the HTTP inspect preprocessor is turned off 
using the <TT>disabled</TT> keyword.

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">33</SPAN>.</B> 
<DD><TT>max_gzip_mem <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option determines (in bytes) the maximum amount of memory the HTTP Inspect preprocessor 
will use for decompression. The minimum allowed value for this option is 3276 bytes. This option
determines the number of concurrent sessions that can be decompressed at any given instant.
The default value for this option is 838860.

<P>
This value is also used for the optional SWF/PDF file decompression.  If these modes are enabled
this same value sets the maximum about of memory used for file decompression session state
information.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
This value should be specified in the default policy even when the HTTP inspect preprocessor is 
turned off using the <TT>disabled</TT> keyword.

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">34</SPAN>.</B> 
<DD><TT>memcap <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option determines (in bytes) the maximum amount of memory the HTTP Inspect preprocessor
will use for logging the URI and Hostname data. This value can be set from 2304 to 603979776 (576 MB).
This option along with the maximum uri and hostname logging size (which is defined in snort) will
determine the maximum HTTP sessions that will log the URI and hostname data at any given instant. The
maximum size for logging URI data is 2048 and for hostname is 256. The default value for this
option is 150994944 (144 MB).

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
This value should be specified in the default policy even when the HTTP inspect preprocessor is turned off 
using the <TT>disabled</TT> keyword. In case of multiple policies, the value specified in the
default policy will overwrite the value specified in other policies.

<P>
max http sessions logged = memcap /( max uri logging size + max hostname logging size )
max uri logging size defined in snort : 2048
max hostname logging size defined in snort : 256

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">35</SPAN>.</B> 
<DD><TT>normalize_random_nulls_in_text</TT>

<P>
This option normalizes the text content with randomly encoded null bytes in 16LE,16BE,32LE and
32BE UTF encodings to UTF8 in the server response. It relies on file preprocessor to determine
if the content is text. Hence file preprocessor should be enabled and configured with prepackaged
file magics wihtout which this option is not effective.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
This opton relies on file prepreprocessor to determine if content can safely be considered as text
before normalizing. However, it is possible that non text file types unknown to file preprocessor
may get normalized as this option treats file types unknown to file preprocessor as text. Such cases
may result in false positives or false negatives in detection. 

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">36</SPAN>.</B> 
<DD><TT>fast_blocking</TT>

<P>
This option enables inspecting http data before the data is flushed. This enables early IPS rule
evaluation so that the block rules will take into effect and the connection is blocked at the earliest
instead of blocking later after flushing the data. This config will be effective only when inline
normalisation is enabled.

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>.</B> 
<DD><TT>disabled</TT>

<P>
This optional keyword is allowed with any policy to avoid packet processing.
This option disables the preprocessor. When the preprocessor is disabled
only the "memcap", "max_gzip_mem", "compress_depth" and "decompress_depth" 
options are applied when specified with the configuration. Other options are
parsed but not used. Any valid configuration may have "disabled" added to it.

<P>
</DD>
</DL>
<H3><A NAME="SECTION00327300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect: \
        global iis_unicode_map unicode.map 1252
</PRE>

<P>

<H3><A NAME="SECTION00327400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">4</SPAN> Server Configuration</A>
</H3>

<P>
There are two types of server configurations: default and by IP address.

<P>

<H4><A NAME="SECTION00327410000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default server configuration for any server
that is not individually configured.  Most of your web servers will most likely
end up using the default configuration.

<P>

<H3><A NAME="SECTION00327500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">5</SPAN> Example Default Configuration</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect_server: \
        server default profile all ports { 80 }
</PRE>

<P>

<H4><A NAME="SECTION00327510000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>

<P>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A NAME="SECTION00327600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example IP Configuration</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect_server: \
        server 10.1.1.1 profile all ports { 80 }
</PRE>

<P>

<H4><A NAME="SECTION00327610000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by Multiple IP Addresses</A>
</H4>

<P>
This format is very similar to &ldquo;Configuration by IP Address&rdquo;, the only
difference being that multiple IPs can be specified via a space separated list.
There is a limit of 40 IP addresses or CIDR notations per
<TT>http_inspect_server</TT> line.

<P>

<H3><A NAME="SECTION00327700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">7</SPAN> Example Multiple IP Configuration</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect_server: \
        server { 10.1.1.1 10.2.2.0/24 } profile all ports { 80 }
</PRE>

<P>

<H3><A NAME="SECTION00327800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">8</SPAN> Server Configuration Options</A>
</H3>

<P>
Important: Some configuration options have an argument of `yes' or `no'.  This
argument specifies whether the user wants the configuration option to generate
an HTTP Inspect alert or not.  The `yes/no' argument does not specify whether
the configuration option itself is on or off, only the alerting functionality.
In other words, whether set to `yes' or 'no', HTTP normalization will still
occur, and rules based on HTTP traffic will still trigger.

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">38</SPAN>.</B> 
<DD><TT>profile <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>all<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>apache<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>iis<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>iis5_0<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>iis4_0<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
Users can configure HTTP Inspect by using pre-defined HTTP server profiles.
Profiles allow the user to easily configure the preprocessor for a certain type
of server, but are not required for proper operation. 

<P>
There are five profiles available: all, apache, iis, iis5_0, and iis4_0.

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">37</SPAN>-<SPAN CLASS="Alph">A</SPAN>. </B> 
<DD><TT>all</TT>

<P>
The <TT>all</TT> profile is meant to normalize the URI using most of the common
tricks available.  We alert on the more serious forms of evasions.  This is a
great profile for detecting all types of attacks, regardless of the HTTP
server.  <TT>profile all</TT> sets the configuration options described in Table
<A HREF="#profile_all_options"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR>
<DIV ALIGN="CENTER">
<A NAME="profile_all_options"></A><A NAME="1231"></A>
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<CAPTION><STRONG>Table:</STRONG>
Options for the &ldquo;all&rdquo; Profile</CAPTION>
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=216><SPAN  CLASS="textbf">Setting</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">server_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">client_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">post_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0</TD>
</TR>
<TR><TD ALIGN="LEFT">chunk encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>alert on chunks larger than 500000 bytes</TD>
</TR>
<TR><TD ALIGN="LEFT">iis_unicode_map</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>codepoint map in the global configuration</TD>
</TR>
<TR><TD ALIGN="LEFT">ASCII decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">multiple slash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">directory normalization</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">apache whitespace</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">double decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">%u decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">bare byte decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">iis unicode codepoints</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">iis backslash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">iis delimiter</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">webroot</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">non_strict URL parsing</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on</TD>
</TR>
<TR><TD ALIGN="LEFT">tab_uri_delimiter</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>is set</TD>
</TR>
<TR><TD ALIGN="LEFT">max_header_length</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, header length not checked</TD>
</TR>
<TR><TD ALIGN="LEFT">max_spaces</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>200</TD>
</TR>
<TR><TD ALIGN="LEFT">max_headers</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, number of headers not checked</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>-<SPAN CLASS="Alph">B</SPAN>. </B> 
<DD><TT>apache</TT> 

<P>
The <TT>apache</TT> profile is used for Apache web servers.  This differs from
the <TT>iis</TT> profile by only accepting UTF-8 standard Unicode encoding and
not accepting backslashes as legitimate slashes, like IIS does.  Apache also
accepts tabs as whitespace.  <TT>profile apache</TT> sets the configuration
options described in Table <A HREF="#profile_apache_options"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR>
<DIV ALIGN="CENTER">
<A NAME="profile_apache_options"></A><A NAME="6157"></A>
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<CAPTION><STRONG>Table:</STRONG>
Options for the <TT>apache</TT> Profile</CAPTION>
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=216><SPAN  CLASS="textbf">Setting</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">server_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">client_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">post_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0</TD>
</TR>
<TR><TD ALIGN="LEFT">chunk encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>alert on chunks larger than 500000 bytes</TD>
</TR>
<TR><TD ALIGN="LEFT">ASCII decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">multiple slash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">directory normalization</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">webroot</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">apache whitespace</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">utf_8 encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">non_strict url parsing</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on</TD>
</TR>
<TR><TD ALIGN="LEFT">tab_uri_delimiter</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>is set</TD>
</TR>
<TR><TD ALIGN="LEFT">max_header_length</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, header length not checked</TD>
</TR>
<TR><TD ALIGN="LEFT">max_spaces</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>200</TD>
</TR>
<TR><TD ALIGN="LEFT">max_headers</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, number of headers not checked</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>-<SPAN CLASS="Alph">C</SPAN>. </B> 
<DD><TT>iis</TT>

<P>
The <TT>iis</TT> profile mimics IIS servers.  So that means we use IIS Unicode
codemaps for each server, %u encoding, bare-byte encoding, double decoding,
backslashes, etc. <TT>profile iis</TT> sets the configuration options described
in Table <A HREF="#profile_iis_options"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR>
<DIV ALIGN="CENTER">
<A NAME="profile_iis_options"></A><A NAME="6159"></A>
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<CAPTION><STRONG>Table:</STRONG>
Options for the <TT>iis</TT> Profile</CAPTION>
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=216><SPAN  CLASS="textbf">Setting</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">server_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">client_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">post_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>-1</TD>
</TR>
<TR><TD ALIGN="LEFT">chunk encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>alert on chunks larger than 500000 bytes</TD>
</TR>
<TR><TD ALIGN="LEFT">iis_unicode_map</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>codepoint map in the global configuration</TD>
</TR>
<TR><TD ALIGN="LEFT">ASCII decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">multiple slash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">directory normalization</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">webroot</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">double decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">%u decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">bare byte decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">iis unicode codepoints</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">iis backslash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">iis delimiter</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">apache whitespace</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">non_strict URL parsing</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on</TD>
</TR>
<TR><TD ALIGN="LEFT">max_header_length</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, header length not checked</TD>
</TR>
<TR><TD ALIGN="LEFT">max_spaces</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>200</TD>
</TR>
<TR><TD ALIGN="LEFT">max_headers</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, number of headers not checked</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>-<SPAN CLASS="Alph">D</SPAN>. </B> 
<DD><TT>iis4_0, iis5_0</TT>

<P>
In IIS 4.0 and IIS 5.0, there was a double decoding vulnerability.  These two
profiles are identical to <TT>iis</TT>, except they will alert by default if a
URL has a double encoding.  Double decode is not supported in IIS 5.1 and
beyond, so it's disabled by default.

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>-<SPAN CLASS="Alph">E</SPAN>. </B> 
<DD><TT>default, no profile</TT>

<P>
The default options used by HTTP Inspect do not use a profile and are described
in Table <A HREF="#default_HTTP_Inspect_options"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR>
<DIV ALIGN="CENTER">
<A NAME="default_HTTP_Inspect_options"></A><A NAME="1277"></A>
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<CAPTION><STRONG>Table:</STRONG>
Default HTTP Inspect Options</CAPTION>
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=216><SPAN  CLASS="textbf">Setting</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">port</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>80</TD>
</TR>
<TR><TD ALIGN="LEFT">server_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">client_flow_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>300</TD>
</TR>
<TR><TD ALIGN="LEFT">post_depth</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>-1</TD>
</TR>
<TR><TD ALIGN="LEFT">chunk encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>alert on chunks larger than 500000 bytes</TD>
</TR>
<TR><TD ALIGN="LEFT">ASCII decoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">utf_8 encoding</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">multiple slash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">directory normalization</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">webroot</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert on</TD>
</TR>
<TR><TD ALIGN="LEFT">iis backslash</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">apache whitespace</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">iis delimiter</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on, alert off</TD>
</TR>
<TR><TD ALIGN="LEFT">non_strict URL parsing</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>on</TD>
</TR>
<TR><TD ALIGN="LEFT">max_header_length</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, header length not checked</TD>
</TR>
<TR><TD ALIGN="LEFT">max_spaces</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>200</TD>
</TR>
<TR><TD ALIGN="LEFT">max_headers</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>0, number of headers not checked</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>
Profiles must be specified as the first server option and cannot be combined
with any other options except:

<P>

<UL>
<LI><TT>ports</TT>
</LI>
<LI><TT>iis_unicode_map</TT>
</LI>
<LI><TT>allow_proxy_use</TT>
</LI>
<LI><TT>server_flow_depth</TT>
</LI>
<LI><TT>client_flow_depth</TT>
</LI>
<LI><TT>post_depth</TT>
</LI>
<LI><TT>no_alerts</TT>
</LI>
<LI><TT>inspect_uri_only</TT>
</LI>
<LI><TT>oversize_dir_length</TT> 
</LI>
<LI><TT>normalize_headers</TT> 
</LI>
<LI><TT>normalize_cookies</TT> 
</LI>
<LI><TT>normalize_utf</TT>
</LI>
<LI><TT>max_header_length</TT> 
</LI>
<LI><TT>max_spaces</TT> 
</LI>
<LI><TT>max_headers</TT> 
</LI>
<LI><TT>extended_response_inspection</TT>
</LI>
<LI><TT>enable_cookie</TT>
</LI>
<LI><TT>inspect_gzip</TT>
</LI>
<LI><TT>unlimited_decompress</TT>
</LI>
<LI><TT>normalize_javascript</TT>
</LI>
<LI><TT>max_javascript_whitespaces</TT>
</LI>
<LI><TT>enable_xff</TT>
</LI>
<LI><TT>http_methods</TT>
</LI>
<LI><TT>log_uri</TT>
</LI>
<LI><TT>log_hostname</TT>
</LI>
<LI><TT>small_chunk_length</TT>
</LI>
<LI><TT>decompress_swf</TT>
</LI>
<LI><TT>decompress_pdf</TT>
</LI>
<LI><TT>legacy_mode</TT>
</LI>
</UL>

<P>
These options must be specified after the <TT>profile</TT> option.

<P>
</DD>
</DL> 
<P>
</DD>
</DL>
<H3><A NAME="SECTION00327900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect_server: \
        server 1.1.1.1 profile all ports { 80 3128 }
</PRE>

<P>
<TT>ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This is how the user configures which ports to decode on the HTTP server.
However, HTTPS traffic is encrypted and cannot be decoded with HTTP Inspect.
To ignore HTTPS traffic, use the SSL preprocessor.

<P>
<TT>iis_unicode_map <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>map_filename<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> codemap <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The IIS Unicode map is generated by the program ms_unicode_generator.c.  This
program is located on the Snort.org web site at
<TT><A NAME="tex2html10"
  HREF="http://www.snort.org/dl/contrib/">http://www.snort.org/dl/contrib/</A></TT> directory.  Executing this program
generates a Unicode map for the system that it was run on.  So, to get the
specific Unicode mappings for an IIS web server, you run this program on that
server and use that Unicode map in this configuration.

<P>
When using this option, the user needs to specify the file that contains the
IIS Unicode map and also specify the Unicode map to use.  For US servers, this
is usually 1252.  But the ms_unicode_generator program tells you which
codemap to use for you server; it's the ANSI code page.  You can select the
correct code page by looking at the available code pages that the
ms_unicode_generator outputs.

<P>
<TT>extended_response_inspection</TT>

<P>
This enables the extended HTTP response inspection. The default http response
inspection does not inspect the various fields of a HTTP response. By turning
this option the HTTP response will be thoroughly inspected. The different fields
of a HTTP response such as status code, status message, headers, cookie (when
enable_cookie is configured) and body are extracted and saved into buffers.
Different rule options are provided to inspect these buffers.

<P>
This option must be enabled to make use of the decompress_swf or decompress_pdf
options.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
When this option is turned on, if the HTTP response packet has a body then any
content pattern matches ( without http modifiers ) will search the response body
((decompressed in case of gzip) and not the entire packet payload. To search for 
patterns in the header of the response, one should use the http modifiers with 
content such as <TT>http_header</TT>, <TT>http_stat_code</TT>, <TT>http_stat_msg</TT> 
and <TT>http_cookie</TT>.

<P>
        
        </b></td></tr></table></p>

<P>
<TT>enable_cookie</TT>

<P>
This options turns on the cookie extraction from HTTP requests and HTTP response.
By default the cookie inspection and extraction will be turned off. The cookie from 
the <TT>Cookie</TT> header line is extracted and stored in HTTP Cookie buffer for 
HTTP requests and cookie from the <TT>Set-Cookie</TT> is extracted and stored in 
HTTP Cookie buffer for HTTP responses. The <TT>Cookie:</TT> and <TT>Set-Cookie:</TT> 
header names itself along with leading spaces and the CRLF terminating the header 
line are stored in the HTTP header buffer and are not stored in the HTTP cookie buffer.

<P>
<PRE>
Ex: Set-Cookie: mycookie \r\n

In this case, Set-Cookie: \r\n will be in the HTTP header buffer and the pattern
mycookie will be in the HTTP cookie buffer.
</PRE>

<P>
<TT>inspect_gzip</TT>

<P>
This option specifies the HTTP inspect module to uncompress the compressed
data(gzip/deflate) in HTTP response. You should select the config option
"extended_response_inspection" before configuring this option.  Decompression 
is done across packets. So the decompression will end when either the 
'compress_depth' or 'decompress_depth' is reached or when the compressed data ends.
When the compressed data is spanned across multiple packets, the state of the last 
decompressed packet is used to decompressed the data of the next packet. 
But the decompressed data are individually inspected. (i.e. the 
decompressed data from different packets are not combined while inspecting). 
Also the amount of decompressed data that will be inspected depends on the 
'server_flow_depth' configured.

<P>
Http Inspect generates a preprocessor alert with gid 120 and sid 6 when the decompression
fails. When the decompression fails due to a CRC error encountered by zlib, HTTP Inspect
will also provide the detection module with the data that was decompressed by zlib.

<P>
<TT>unlimited_decompress</TT>

<P>
This option enables the user to decompress unlimited gzip data (across multiple 
packets).Decompression will stop when the compressed data ends or when a out of 
sequence packet is received. To ensure unlimited decompression, user should set 
the 'compress_depth' and 'decompress_depth' to its maximum values in the default 
policy. The decompression in a single packet is still limited by the 'compress_depth' 
and 'decompress_depth'.

<P>
<TT>decompress_swf <!-- MATH
 $\{ mode [mode] \}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="104" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img9.png"
 ALT="$\{ mode [mode] \}$"></SPAN> </TT> 

<P>
This option will enable decompression of compressed SWF (Adobe Flash content) files
encountered as the HTTP Response body in a GET transaction.  The available decompression
modes are 'deflate' and 'lzma'.  A prerequisite is enabling
extended_response_inspection (described above).  When enabled, the preprocessor will
examine the response body for the corresponding file signature.  'CWS' for Deflate/ZLIB
compressed and 'ZWS' for LZMA compressed.  Each decompression mode can be individually enabled.
e.g. ...  lzma  or  deflate  or  lzma deflate .  The compressed content is decompressed
'in-place' with the content made available to the detection/rules 'file_data' option.
If enabled and located, the compressed SWF file signature is converted to 'FWS' to indicate
an uncompressed file.

<P>
The 'decompress_depth', 'compress_depth', and 'unlimited_decompress' are optionally used to 
place limits on the decompression process.  The semantics for SWF files are similar to the
gzip decompression process.

<P>
During the decompression process, the preprocessor may generate alert 120:12 if Deflate
decompression fails or alert 120:13 if LZMA decompression fails.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
LZMA decompression is only available if Snort is built with the liblzma package present
and functional.  If the LZMA package is not present, then the  lzma  option will indicate
a fatal parsing error.  If the liblzma package IS present, but one desires to disable LZMA
support, then the -disable-lzma option on configure will disable usage of the library.
        
        </b></td></tr></table></p>

<P>
<TT>decompress_pdf <!-- MATH
 $\{ mode [mode] \}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="104" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img9.png"
 ALT="$\{ mode [mode] \}$"></SPAN> </TT> 

<P>
This option will enable decompression of the compressed portions of PDF files encountered
as the HTTP Response body in a GET transaction.  A prerequisite is enabling
extended_response_inspection (described above).

<P>
When enabled, the preprocessor will examine the response body for the 'PDF files are then parsed, locating PDF 'streams' with a single '/FlateDecode' filter.  These
streams are decompressed in-place, replacing the compressed content.

<P>
The 'decompress_depth', 'compress_depth', and 'unlimited_decompress' are optionally used to 
place limits on the decompression process.  The semantics for PDF files are similar to the
gzip decompression process.

<P>
During the file parsing/decompression process, the preprocessor may generate several alerts:

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Alert</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=324><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">120:14</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324>Deflate decompression failure</TD>
</TR>
<TR><TD ALIGN="LEFT">120:15</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324>Located a 'stream' with an unsupported compression ('/Filter') algorithm</TD>
</TR>
<TR><TD ALIGN="LEFT">120:16</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324>Located a 'stream' with unsupported cascaded '/FlateDecode' options, e.g.: <PRE>/Filter [ /FlateDecode /FlateDecode ]
</PRE></TD>
</TR>
<TR><TD ALIGN="LEFT">120:17</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=324>PDF File parsing error</TD>
</TR>
</TABLE>
</DIV>

<P>
<TT>normalize_javascript</TT>
This option enables the normalization of Javascript within the HTTP response body.
You should select the config option <TT>extended_response_inspection</TT> before configuring 
this option. When this option is turned on, Http Inspect searches for a Javascript within the 
HTTP response body by searching for the <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>script<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> tags and starts normalizing it. 
When Http Inspect sees the <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>script<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> tag without a type, it is considered as a javascript.
The obfuscated data within the javascript functions such as unescape, String.fromCharCode, decodeURI, 
decodeURIComponent will be normalized. The different encodings handled within the unescape/
decodeURI/decodeURIComponent are <TT>%XX</TT>, <TT>%uXXXX</TT>, <TT>
<BR>
XX</TT> and <TT>
<BR>
uXXXXi</TT>. 
Apart from these encodings, Http Inspect will also detect the consecutive whitespaces and normalize 
it to a single space. Http Inspect will also normalize the plus and concatenate the strings. 
The rule option <TT>file_data</TT> can be used to access this normalized buffer from the rule.
A preprocessor alert with SID 9 and GID 120 is generated when the obfuscation levels within the 
Http Inspect is equal to or greater than 2.

<P>
<PRE>
Example:

HTTP/1.1 200 OK\r\n
Date: Wed, 29 Jul 2009 13:35:26 GMT\r\n
Server: Apache/2.2.3 (Debian) PHP/5.2.0-8+etch10 mod_ssl/2.2.3 OpenSSL/0.9.8c\r\n
Last-Modified: Sun, 20 Jan 2008 12:01:21 GMT\r\n
Accept-Ranges: bytes\r\n
Content-Length: 214\r\n
Keep-Alive: timeout=15, max=99\r\n
Connection: Keep-Alive\r\n
Content-Type: application/octet-stream\r\n\r\n 
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
&lt;title&gt;FIXME&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script&gt;document.write(unescape(unescape("%48%65%6C%6C%6F%2C%20%73%6E%6F%72%74%20%74%65%61%6D%21")));
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</PRE>

<P>
The above javascript will generate the preprocessor alert with SID 9 and GIDF 120 when <TT>normalize_javascript</TT>
is turned on.

<P>
Http Inspect will also generate a preprocessor alert with GID 120 and SID 11 when there are more than one type 
of encodings within the escaped/encoded data.

<P>
<PRE>
For example:

unescape("%48\x65%6C%6C%6F%2C%20%73%6E%6F%72%74%20%74%65%61%6D%21");
String.fromCharCode(0x48, 0x65, 0x6c, 0x6c, 111, 44, 32, 115, 110, 111, 114, 116, 32, 116, 101, 97, 109, 33)

\\end{verbatim}

The above obfuscation will generate the preprocessor alert with GID 120 and SID 11.

This option is turned off by default in HTTP Inspect.

\item \texttt{max\_javascript\_whitespaces $&lt;$positive integer up to 65535$&gt;$}
This option takes an integer as an argument.  The integer determines the maximum number
of consecutive whitespaces allowed within the Javascript obfuscated data in a HTTP
response body. The config option \texttt{normalize\_javascript} should be turned on before configuring
 this config option. When the whitespaces in the javascript obfuscated data is equal to or more
than this value a preprocessor alert with GID 120 and SID 10 is generated. The default value for 
this option is 200.  To enable, specify an integer argument to \texttt{max\_javascript\_spaces} of 1 to 65535.
Specifying a value of 0 is treated as disabling the alert.

\item \texttt{enable\_xff}

This option enables Snort to parse and log the original client IP present in the
X-Forwarded-For or True-Client-IP HTTP request headers along with the generated
events. The XFF/True-Client-IP Original client IP address is logged only with
unified2 output and is not logged with console (-A cmg) output.

\item \texttt{xff\_headers}

If/When the \texttt{enable\_xff} option is present, the \texttt{xff\_headers} option specifies a set of custom 'xff'
headers.  This option allows the definition of up to six custom headers in addition to the
two default (and always present) X-Forwarded-For and True-Client-IP headers.  The option
permits both the custom and default headers to be prioritized.  The headers/priority pairs
are specified as a list.  Lower numerical values imply a higher priority.  The headers do
not need to be specified in priority order.  Nor do the priorities need to be contiguous.
Priority values can range from 1 to 255.  The priority values and header names must be unique.
The header names must not collide with known http headers such as 'host', 'cookie',
'content-length', etc.

A example of the \texttt{xff\_header} syntax is:
\begin{verbatim}
xff_headers { [ x-forwarded-highest-priority 1 ] [ x-forwarded-second-highest-priority 2 ] \
              [ x-forwarded-lowest-priority-custom 3 ] }
</PRE>

<P>
The default X-Forwarded-For and True-Client-IP headers are always present.  They may be explicitly
specified in the <TT>xff_headers</TT> config in order to determine their priority.  If not specified, they
will be automatically added to the xff list as the lowest priority headers.

<P>
For example, let us say that we have the following (abbreviated) HTTP request header:

<P>
<PRE>
...
Host: www.snort.org
X-Forwarded-For: 192.168.1.1
X-Was-Originally-Forwarded-From: 10.1.1.1
...
</PRE>

<P>
With the default xff behavior (no <TT>xff_headers</TT>), the 'X-Forwarded-For' header would be used to
provide a 192.168.1.1 Original Client IP address in the unified2 log.  Custom headers are not
parsed.

<P>
With:
<PRE>
xff_headers { [ x-was-originally-forwarded-from 1 ] [ x-another-forwarding-header 2 ] \
              [ x-forwarded-for 3 ] }
</PRE>

<P>
The X-Was-Originally-Forwarded-From header is the highest priority present and its value
of 10.1.1.1 will be logged as the Original Client IP in the unified2 log.

<P>
But with:
<PRE>
xff_headers { [ x-was-originally-forwarded-from 3 ] [ x-another-forwarding-header 2 ] \
              [ x-forwarded-for 1 ] }
</PRE>

<P>
Now the X-Forwarded-For header is the highest priority and its value of 192.168.1.1 is logged.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
The original client IP from XFF/True-Client-IP in unified2 logs can be viewed using 
the tool u2spewfoo. This tool is present in the tools/u2spewfoo directory of snort 
source tree.

<P>
        
        </b></td></tr></table></p>

<P>
<TT>server_flow_depth <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This specifies the amount of server response payload to inspect. When
<TT>extended_response_inspection</TT> is turned on, it is applied to the HTTP response 
body (decompressed data when <TT>inspect_gzip</TT> is turned on) and not the HTTP headers.
When <TT>extended_response_inspection</TT> is turned off the <TT>server_flow_depth</TT> 
is applied to the entire HTTP response (including headers). Unlike <TT>client_flow_depth</TT> 
this option is applied per TCP session. This option can be used to balance the needs of 
IDS performance and level of inspection of HTTP server response data.  Snort rules are       
targeted at HTTP server response traffic and when used with a small flow_depth value 
may cause false negatives. Most of these rules target either the HTTP header, or 
the content that is likely to be in the first hundred or so bytes of non-header data.  
Headers are usually under 300 bytes long, but your mileage may vary. 
It is suggested to set the <TT>server_flow_depth</TT> to its maximum value.

<P>
This value can be set from -1 to 65535. A value of -1 causes Snort
to ignore all server side traffic for ports defined in <TT>ports</TT> when
<TT>extended_response_inspection</TT> is turned off. When the <TT>extended_response_inspection</TT>
 is turned on, value of -1 causes Snort to ignore the HTTP response body data and
 not the HTTP headers.  Inversely, a value of 0 causes Snort to inspect all HTTP server
payloads defined in "ports" (note that this will likely slow down IDS
performance).  Values above 0 tell Snort the number of bytes to
inspect of the server response (excluding the HTTP headers when <TT>extended_response_inspection</TT>
is turned on) in a given HTTP session.  Only packets payloads starting with 'HTTP' will
be considered as the first packet of a server response.  If less than flow_depth bytes
are in the payload of the HTTP response packets in a given session, the entire payload will be
inspected.  If more than flow_depth bytes are in the payload of the HTTP response packet in a session
only flow_depth bytes of the payload will be inspected for that session.  Rules that are meant to
inspect data in the payload of the HTTP response packets in a session beyond 65535 bytes will be
ineffective unless flow_depth is set to 0. The default value for <TT>server_flow_depth</TT> is 300.
Note that the 65535 byte maximum flow_depth applies to stream reassembled packets as well. 
It is suggested to set the <TT>server_flow_depth</TT> to its maximum value.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
<TT>server_flow_depth</TT> is the same as the old <TT>flow_depth</TT>
option, which will be deprecated in a future release.

<P>
        
        </b></td></tr></table></p>

<P>
<TT>client_flow_depth <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This specifies the amount of raw client request payload to inspect. This
value can be set from -1 to 1460. Unlike <TT>server_flow_depth</TT> this value is applied
to the first packet of the HTTP request. It is not a session based flow depth.
It has a default value of 300.  It primarily eliminates Snort from inspecting
larger HTTP Cookies that appear at the end of many client request Headers.

<P>
A value of -1 causes Snort to ignore all client side traffic for ports
defined in "ports." Inversely, a value of 0 causes Snort to inspect all HTTP client
 side traffic defined in "ports" (note that this will likely slow down IDS
performance).  Values above 0 tell Snort the number of bytes to
inspect in the first packet of the client request.  If less than flow_depth bytes
are in the TCP payload (HTTP request) of the first packet, the entire payload will be inspected.
If more than flow_depth bytes are in the payload of the first packet only flow_depth
bytes of the payload will be inspected.  Rules that are meant to
inspect data in the payload of the first packet of a client request beyond 1460 bytes 
will be ineffective unless flow_depth is set to 0. Note that the 1460 byte 
maximum flow_depth applies to stream reassembled packets as well. It is 
suggested to set the <TT>client_flow_depth</TT> to its maximum value.

<P>
<TT>post_depth <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This specifies the amount of data to inspect in a client post message. The
value can be set from -1 to 65495. The default value is -1. A value of -1 
causes Snort to ignore all the data in the post message. Inversely, a value 
of 0 causes Snort to inspect all the client post message. This increases    
the performance by inspecting only specified bytes in the post message.

<P>
<TT>ascii <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The <TT>ascii</TT> decode option tells us whether to decode encoded ASCII
chars, a.k.a %2f = /, %2e = ., etc.  It is normal to see ASCII encoding usage
in URLs, so it is recommended that you disable HTTP Inspect alerting for this
option.

<P>
<TT>extended_ascii_uri</TT>

<P>
This option enables the support for extended ASCII codes in the HTTP request
URI. This option is turned off by default and is not supported with any of
the profiles.

<P>
<TT>utf_8 <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The <TT>utf-8</TT> decode option tells HTTP Inspect to decode standard UTF-8
Unicode sequences that are in the URI.  This abides by the Unicode standard and
only uses % encoding.  Apache uses this standard, so for any Apache servers,
make sure you have this option turned on.  As for alerting, you may be
interested in knowing when you have a UTF-8 encoded URI, but this will be prone
to false positives as legitimate web clients use this type of encoding.  When
<TT>utf_8</TT> is enabled, ASCII decoding is also enabled to enforce correct
functioning.  

<P>
<TT>u_encode <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option emulates the IIS %u encoding scheme.  How the %u encoding scheme
works is as follows:  the encoding scheme is started by a %u followed by 4
characters, like %uxxxx.  The xxxx is a hex-encoded value that correlates to
an IIS Unicode codepoint.  This value can most definitely be ASCII.  An ASCII
character is encoded like %u002f = /, %u002e = ., etc.  If no
iis_unicode_map is specified before or after this option, the default codemap
is used.

<P>
You should alert on %u encodings, because we are not aware of any legitimate
clients that use this encoding.  So it is most likely someone trying to be
covert.

<P>
<TT>bare_byte <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
Bare byte encoding is an IIS trick that uses non-ASCII characters as valid
values when decoding UTF-8 values.  This is not in the HTTP standard, as all
non-ASCII values have to be encoded with a %.  Bare byte encoding allows the
user to emulate an IIS server and interpret non-standard encodings correctly.

<P>
The alert on this decoding should be enabled, because there are no legitimate
clients that encode UTF-8 this way since it is non-standard.

<P>
<TT>iis_unicode <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The <TT>iis_unicode</TT> option turns on the Unicode codepoint mapping.  If
there is no iis_unicode_map option specified with the server config,
<TT>iis_unicode</TT> uses the default codemap.  The <TT>iis_unicode</TT>
option handles the mapping of non-ASCII codepoints that the IIS server accepts
and decodes normal UTF-8 requests.

<P>
You should alert on the <TT>iis_unicode option</TT>, because it is seen mainly
in attacks and evasion attempts.  When <TT>iis_unicode</TT> is enabled, ASCII
and UTF-8 decoding are also enabled to enforce correct decoding.  To alert on
UTF-8 decoding, you must enable also enable <TT>utf_8 yes</TT>. 

<P>
<TT>double_decode <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The <TT>double_decode</TT> option is once again IIS-specific and emulates IIS
functionality.  How this works is that IIS does two passes through the request
URI, doing decodes in each one.  In the first pass, it seems that all types of
iis encoding is done: utf-8 unicode, ASCII, bare byte, and %u.  In the second
pass, the following encodings are done:  ASCII, bare byte, and %u.  We leave
out utf-8 because I think how this works is that the % encoded utf-8 is
decoded to the Unicode byte in the first pass, and then UTF-8 is decoded in the
second stage.  Anyway, this is really complex and adds tons of different
encodings for one character.  When <TT>double_decode</TT> is enabled, so ASCII
is also enabled to enforce correct decoding.

<P>
<TT>non_rfc_char <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>byte<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>byte ...<SPAN CLASS="MATH"><IMG
 WIDTH="29" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img10.png"
 ALT="$&gt;] \}$"></SPAN></TT>

<P>
This option lets users receive an alert if certain non-RFC chars are used in a
request URI.  For instance, a user may not want to see null bytes in the
request URI and we can alert on that.  Please use this option with care,
because you could configure it to say, alert on all `/' or something like that.
It's flexible, so be careful.

<P>
<TT>multi_slash <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option normalizes multiple slashes in a row, so something like:
&ldquo;foo/////////bar&rdquo; get normalized to &ldquo;foo/bar.&rdquo;

<P>
If you want an alert when multiple slashes are seen, then configure with a
<TT>yes</TT>; otherwise, use <TT>no</TT>.

<P>
<TT>iis_backslash <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
Normalizes backslashes to slashes.  This is again an IIS emulation.  So a
request URI of &ldquo;/foo<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img11.png"
 ALT="$\backslash$"></SPAN>bar&rdquo; gets normalized to &ldquo;/foo/bar.&rdquo;

<P>
<TT>directory <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option normalizes directory traversals and self-referential directories.

<P>
The directory:

<P>
<PRE>
    /foo/fake\_dir/../bar
</PRE>

<P>
gets normalized to:

<P>
<PRE>
    /foo/bar
</PRE>

<P>
The directory:

<P>
<PRE>
    /foo/./bar
</PRE>

<P>
gets normalized to:

<P>
<PRE>
    /foo/bar
</PRE>

<P>
If you want to configure an alert, specify <TT>yes</TT>, otherwise, specify
<TT>no</TT>.  This alert may give false positives, since some web sites refer
to files using directory traversals.

<P>
<TT>apache_whitespace <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option deals with the non-RFC standard of using tab for a space delimiter.
Apache uses this, so if the emulated web server is Apache, enable this option.
Alerts on this option may be interesting, but may also be false positive prone.

<P>
<TT>iis_delimiter <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This started out being IIS-specific, but Apache takes this non-standard
delimiter was well.  Since this is common, we always take this as standard
since the most popular web servers accept it.  But you can still get an alert
on this option.

<P>
<TT>chunk_length <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>non-zero positive integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option is an anomaly detector for abnormally large chunk sizes.  This
picks up the Apache chunk encoding exploits, and may also alert on HTTP
tunneling that uses chunk encoding.

<P>
<TT>small_chunk_length { <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chunk size<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>consecutive chunks<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> } </TT>

<P>
This option is an evasion detector for consecutive small chunk sizes when
either the client or server use <TT>Transfer-Encoding: chunked</TT>.
<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chunk size<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> specifies the maximum chunk size for which a chunk will be
considered small.  <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>consecutive chunks<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> specifies the number of consecutive
small chunks <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>= <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chunk size<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> before an event will be generated.  This option
is turned off by default.  Maximum values for each are 255 and a <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chunk size<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> of 0
disables.  Events generated are gid:119, sid:26 for client small
chunks and gid:120, sid:7 for server small chunks.

<P>
Example:
<PRE>
small_chunk_length { 10 5 }
</PRE>
Meaning alert if we see 5 consecutive chunk sizes of 10 or less.

<P>
<TT>no_pipeline_req</TT>

<P>
This option turns HTTP pipeline decoding off, and is a performance enhancement
if needed.  By default, pipeline requests are inspected for attacks, but when
this option is enabled, pipeline requests are not decoded and analyzed per HTTP
protocol field.  It is only inspected with the generic pattern matching.

<P>
<TT>non_strict</TT>

<P>
This option turns on non-strict URI parsing for the broken way in which Apache
servers will decode a URI.  Only use this option on servers that will accept
URIs like this: "get /index.html alsjdfk alsj lj aj  la jsj s<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img11.png"
 ALT="$\backslash$"></SPAN>n".
The non_strict option assumes the URI is between the first and second space
even if there is no valid HTTP identifier after the second space.

<P>
<TT>allow_proxy_use</TT>

<P>
By specifying this keyword, the user is allowing proxy use on this server.
This means that no alert will be generated if the <TT>proxy_alert</TT> global
keyword has been used.  If the proxy_alert keyword is not enabled, then this
option does nothing.  The <TT>allow_proxy_use</TT> keyword is just a way to
suppress unauthorized proxy use for an authorized server.  

<P>
<TT>no_alerts</TT>

<P>
This option turns off all alerts that are generated by the HTTP Inspect
preprocessor module.  This has no effect on HTTP rules in the rule set.  No
argument is specified.

<P>
<TT>oversize_dir_length <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>non-zero positive integer<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option takes a non-zero positive integer as an argument.  The argument
specifies the max char directory length for URL directory.  If a url directory
is larger than this argument size, an alert is generated. A good argument value
is 300 characters.  This should limit the alerts to IDS evasion type attacks,
like whisker -i 4.

<P>
<TT>inspect_uri_only</TT>

<P>
This is a performance optimization.  When enabled, only the URI portion of HTTP
requests will be inspected for attacks.  As this field usually contains 90-95%
of the web attacks, you'll catch most of the attacks.  So if you need extra
performance, enable this optimization.  It's important to note that if this
option is used without any <TT>uricontent</TT> rules, then no inspection will
take place.  This is obvious since the URI is only inspected with
<TT>uricontent</TT> rules, and if there are none available, then there is
nothing to inspect.

<P>
For example, if we have the following rule set:

<P>
<PRE>
    alert tcp any any -&gt; any 80 ( msg:"content"; content: "foo"; )
</PRE>

<P>
and the we inspect the following URI:

<P>
<PRE>
    get /foo.htm http/1.0\r\n\r\n
</PRE>

<P>
No alert will be generated when <TT>inspect_uri_only</TT> is enabled.  The
<TT>inspect_uri_only</TT> configuration turns off all forms of detection
except <TT>uricontent</TT> inspection.

<P>
<TT>max_header_length <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>positive integer up to 65535<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option takes an integer as an argument.  The integer is the maximum length
allowed for an HTTP client request header field.  Requests that exceed this
length will cause a "Long Header" alert.  This alert is off by default.  To
enable, specify an integer argument to max_header_length of 1 to 65535.
Specifying a value of 0 is treated as disabling the alert.

<P>
<TT>max_spaces <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>positive integer up to 65535<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option takes an integer as an argument.  The integer determines the maximum number
of whitespaces allowed with HTTP client request line folding. Requests headers
folded with whitespaces equal to or more than this value will cause a
"Space Saturation" alert with SID 26 and GID 119.  The default value for this
option is 200.  To enable, specify an integer argument to <TT>max_spaces</TT> of 1 to 65535.
Specifying a value of 0 is treated as disabling the alert.

<P>
<TT>webroot <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option generates an alert when a directory traversal traverses past the
web server root directory.  This generates much fewer false positives than the
directory option, because it doesn't alert on directory traversals that stay
within the web server directory structure.  It only alerts when the directory
traversals go past the web server root directory, which is associated with
certain web attacks.

<P>
<TT>tab_uri_delimiter</TT>

<P>
This option turns on the use of the tab character (0x09) as a delimiter for a
URI.  Apache accepts tab as a delimiter; IIS does not.  For IIS, a tab in the
URI should be treated as any other character.  Whether this option is on or
not, a tab is treated as whitespace if a space character (0x20) precedes it.
No argument is specified.

<P>
<TT>normalize_headers</TT>

<P>
This option turns on normalization for HTTP Header Fields, not including
Cookies (using the same configuration parameters as the URI normalization (i.e.,
multi-slash, directory, etc.).  It is useful for normalizing Referrer URIs that
may appear in the HTTP Header.

<P>
<TT>normalize_cookies</TT>

<P>
This option turns on normalization for HTTP Cookie Fields (using the same
configuration parameters as the URI normalization (i.e., multi-slash, directory,
etc.).  It is useful for normalizing data in HTTP Cookies that may be encoded.

<P>
<TT>normalize_utf</TT>

<P>
This option turns on normalization of HTTP response bodies where the Content-Type
header lists the character set as "utf-16le", "utf-16be", "utf-32le", or
"utf-32be". HTTP Inspect will attempt to normalize these back into 8-bit encoding,
generating an alert if the extra bytes are non-zero.

<P>
<TT>max_headers <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>positive integer up to 1024<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option takes an integer as an argument.  The integer is the maximum number
of HTTP client request header fields.  Requests that contain more HTTP Headers
than this value will cause a "Max Header" alert.  The alert is off by default.
To enable, specify an integer argument to max_headers of 1 to 1024.
Specifying a value of 0 is treated as disabling the alert.

<P>
<TT>http_methods <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="87" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="$\{ cmd [cmd] \}$"></SPAN> </TT> 
This specifies additional HTTP Request Methods outside of those checked by
default within the preprocessor (GET and POST). The list should be enclosed
within braces and delimited by spaces, tabs, line feed or carriage return. 
The config option, braces and methods also needs to be separated by braces.

<P>
<PRE>
    http_methods { PUT CONNECT }
</PRE>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Please note the maximum length for a method name is 256.

<P>
        
        </b></td></tr></table></p>

<P>
<TT>log_uri</TT>

<P>
This option enables HTTP Inspect preprocessor to parse the URI data from the
HTTP request and log it along with all the generated events for that session.
Stream reassembly needs to be turned on HTTP ports to enable the logging.
If there are multiple HTTP requests in the session, the URI data of the most recent
HTTP request during the alert will be logged. The maximum URI logged is 2048.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Please note, this is logged only with the unified2 output and is not logged
with console output (-A cmg). <TT>u2spewfoo</TT> can be used to read this data from
the unified2.

<P>
        
        </b></td></tr></table></p>

<P>
<TT>log_hostname</TT>

<P>
This option enables HTTP Inspect preprocessor to parse the hostname data from the
"Host" header of the HTTP request and log it along with all the generated events
for that session. Stream reassembly needs to be turned on HTTP ports to enable
the logging. If there are multiple HTTP requests in the session, the Hostname data
of the most recent HTTP request during the alert will be logged. In case of
multiple "Host" headers within one HTTP request, a preprocessor alert with sid 24 is
generated. The maximum hostname length logged is 256.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Please note, this is logged only with the unified2 output and is not logged
with console output (-A cmg). <TT>u2spewfoo</TT> can be used to read this data from
the unified2.

<P>
        
        </b></td></tr></table></p>

<P>
<PRE>
##########################################
# HTTP2 SUPPORT IS STILL EXPERIMENTAL!
# DO NOT USE IN PRODUCTION ENVIRONMENTS.
# Please send any issues to the Snort team
##########################################
</PRE>

<P>
<TT>legacy_mode</TT>
By default, HTTP2 traffic is not supported. You can use "legacy_mode no"
to enable HTTP2 support.
If http legacy mode is configured, HTTP2 inspection is disabled.

<P>
 
<P>

<H3><A NAME="SECTION003271000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">10</SPAN> Examples</A>
</H3>

<P>
<PRE>
    preprocessor http_inspect_server: \
        server 10.1.1.1 \
        ports { 80 3128 8080 } \
        server_flow_depth 0 \
        ascii no \
        double_decode yes \
        non_rfc_char { 0x00 } \
        chunk_length 500000 \
        non_strict \
        no_alerts

    preprocessor http_inspect_server: \
        server default \ 
        ports  { 80 3128 }  \
        non_strict \
        non_rfc_char  { 0x00 }  \
        server_flow_depth 300  \
        apache_whitespace yes \
        directory no \
        iis_backslash no \
        u_encode yes \
        ascii no \
        chunk_length 500000 \
        bare_byte yes \
        double_decode yes \
        iis_unicode yes \ 
        iis_delimiter yes \
        multi_slash no

    preprocessor http_inspect_server: \
        server default \
        profile all \
        ports { 80 8080 }
</PRE>

<P>

<H2><A NAME="SECTION00328000000000000000"></A>
<A NAME="SMTP"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN> SMTP Preprocessor
</H2>

<P>
The SMTP preprocessor is an SMTP decoder for user applications.  Given a data
buffer, SMTP will decode the buffer and find SMTP commands and responses.  It
will also mark the command, data header data body sections, and TLS data.

<P>
SMTP handles stateless and stateful processing.  It saves state between
individual packets.  However maintaining correct state is dependent on the
reassembly of the client side of the stream (i.e., a loss of coherent stream data
results in a loss of state).

<P>

<H3><A NAME="SECTION00328100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
SMTP has the usual configuration items, such as <TT>port</TT> and
<TT>inspection_type</TT>.  Also, SMTP command lines can be normalized to
remove extraneous spaces.  TLS-encrypted traffic can be ignored, which improves
performance.  In addition, regular mail data can be ignored for an additional
performance boost.  Since so few (none in the current snort rule set) exploits
are against mail data, this is relatively safe to do and can improve the
performance of data inspection.

<P>
The configuration options are described below:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">39</SPAN>.</B> 
<DD><TT>ports { &lt;port&gt; [&lt;port&gt;] ... }</TT>

<P>
This specifies on what ports to check for SMTP data.  Typically, this will
include 25 and possibly 465, for encrypted SMTP.

<P>
<DT> <B><SPAN CLASS="arabic">40</SPAN>.</B> 
<DD><TT>inspection_type &lt;stateful | stateless&gt;</TT>

<P>
Indicate whether to operate in stateful or stateless mode.

<P>
<DT> <B><SPAN CLASS="arabic">41</SPAN>.</B> 
<DD><TT>normalize &lt;all | none | cmds&gt;</TT>

<P>
This turns on normalization.  Normalization checks for more than one space
character after a command.  Space characters are defined as space (ASCII 0x20)
or tab (ASCII 0x09).

<P>
<TT>all</TT> checks all commands

<P>
<TT>none</TT> turns off normalization for all commands.

<P>
<TT>cmds</TT> just checks commands listed with the <TT>normalize_cmds</TT> parameter.

<P>
<DT> <B><SPAN CLASS="arabic">42</SPAN>.</B> 
<DD><TT>ignore_data</TT>

<P>
Ignore data section of mail (except for mail headers) when processing rules.

<P>
<DT> <B><SPAN CLASS="arabic">43</SPAN>.</B> 
<DD><TT>ignore_tls_data</TT>

<P>
Ignore TLS-encrypted data when processing rules.

<P>
<DT> <B><SPAN CLASS="arabic">44</SPAN>.</B> 
<DD><TT>max_command_line_len &lt;int&gt;</TT>

<P>
Alert if an SMTP command line is longer than this value.  Absence of this
option or a "0" means never alert on command line length.  RFC 2821 recommends
512 as a maximum command line length.

<P>
<DT> <B><SPAN CLASS="arabic">45</SPAN>.</B> 
<DD><TT>max_header_line_len &lt;int&gt;</TT>

<P>
Alert if an SMTP DATA header line is longer than this value.  Absence of this
option or a "0" means never alert on data header line length.  RFC 2821
recommends 1024 as a maximum data header line length.

<P>
<DT> <B><SPAN CLASS="arabic">46</SPAN>.</B> 
<DD><TT>max_response_line_len &lt;int&gt;</TT>

<P>
Alert if an SMTP response line is longer than this value.  Absence of this
option or a "0" means never alert on response line length.  RFC 2821 recommends
512 as a maximum response line length.

<P>
<DT> <B><SPAN CLASS="arabic">47</SPAN>.</B> 
<DD><TT>alt_max_command_line_len &lt;int&gt; { &lt;cmd&gt; [&lt;cmd&gt;] }</TT>

<P>
Overrides <TT>max_command_line_len</TT> for specific commands.

<P>
<DT> <B><SPAN CLASS="arabic">48</SPAN>.</B> 
<DD><TT>no_alerts</TT>

<P>
Turn off all alerts for this preprocessor.

<P>
<DT> <B><SPAN CLASS="arabic">49</SPAN>.</B> 
<DD><TT>invalid_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
Alert if this command is sent from client side.  Default is an empty list.

<P>
<DT> <B><SPAN CLASS="arabic">50</SPAN>.</B> 
<DD><TT>valid_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
List of valid commands.  We do not alert on commands in this list.  Default is
an empty list, but preprocessor has this list hard-coded:

<P>
<table width="90%"><tr><td valign="top">&nbsp;{ ATRN AUTH BDAT DATA DEBUG EHLO EMAL ESAM ESND ESOM ETRN EVFY EXPN
HELO HELP IDENT MAIL NOOP QUIT RCPT RSET SAML SOML SEND ONEX QUEU
STARTTLS TICK TIME TURN TURNME VERB VRFY X-EXPS X-LINK2STATE
XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN XUSR }
</td></tr></table>

<P>
<DT> <B><SPAN CLASS="arabic">51</SPAN>.</B> 
<DD><TT>data_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
List of commands that initiate sending of data with an end of data delimiter
the same as that of the DATA command per RFC 5321 - <TT>"&lt;CRLF&gt;.&lt;CRLF&gt;"</TT>.
Default is { DATA }.

<P>
<DT> <B><SPAN CLASS="arabic">52</SPAN>.</B> 
<DD><TT>binary_data_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
List of commands that initiate sending of data and use a length value after
the command to indicate the amount of data to be sent, similar to that of the
BDAT command per RFC 3030.  Default is { BDAT XEXCH50 }.

<P>
<DT> <B><SPAN CLASS="arabic">53</SPAN>.</B> 
<DD><TT>auth_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
List of commands that initiate an authentication exchange between client
and server.  Default is { AUTH XAUTH X-EXPS }.

<P>
<DT> <B><SPAN CLASS="arabic">54</SPAN>.</B> 
<DD><TT>alert_unknown_cmds</TT>

<P>
Alert if we don't recognize command.  Default is off.

<P>
<DT> <B><SPAN CLASS="arabic">55</SPAN>.</B> 
<DD><TT>normalize_cmds { &lt;Space-delimited list of commands&gt; }</TT>

<P>
Normalize this list of commands Default is { RCPT VRFY EXPN }.

<P>
<DT> <B><SPAN CLASS="arabic">56</SPAN>.</B> 
<DD><TT>xlink2state { enable | disable [drop] }</TT>

<P>
Enable/disable xlink2state alert.  Drop if alerted.  Default is
<TT>enable</TT>.

<P>
<DT> <B><SPAN CLASS="arabic">57</SPAN>.</B> 
<DD><TT>print_cmds</TT>

<P>
List all commands understood by the preprocessor.  This not normally printed
out with the configuration because it can print so much data.

<P>
<DT> <B><SPAN CLASS="arabic">58</SPAN>.</B> 
<DD><TT>disabled</TT>

<P>
Disables the SMTP preprocessor in a config. This is useful when specifying
the decoding depths such as <TT>b64_decode_depth</TT>, <TT>qp_decode_depth</TT>, 
<TT>uu_decode_depth</TT>, <TT>bitenc_decode_depth</TT> or the memcap used for 
decoding <TT>max_mime_mem</TT> in default config without turning on the SMTP preprocessor.

<P>
<DT> <B><SPAN CLASS="arabic">59</SPAN>.</B> 
<DD><TT>b64_decode_depth</TT>

<P>
This config option is used to turn off/on or set the base64 decoding depth used to
decode the base64 encoded MIME attachments. The value ranges from -1 to 65535.
A value of -1 turns off the base64 decoding of MIME attachments. The value of 0
sets the decoding of base64 encoded MIME attachments to unlimited. A value other
than 0 or -1 restricts the decoding of base64 MIME attachments, and applies per attachment. 
A SMTP preprocessor alert with sid 10 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection 
is turned on the base64 encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>. 
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
This option replaces the deprecated options, <TT>enable_mime_decoding</TT> and 
<TT>max_mime_depth</TT>.  It is recommended that user inputs a value that is a 
multiple of 4. When the value specified is not a multiple of 4, the SMTP preprocessor 
will round it up to the next multiple of 4.

<P>
In case of multiple configs, the value specified in the non-default config cannot
exceed the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">60</SPAN>.</B> 
<DD><TT>qp_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Quoted-Printable decoding depth
used to decode the Quoted-Printable(QP) encoded MIME attachments. The value ranges
from -1 to 65535. A value of -1 turns off the QP decoding of MIME attachments.
The value of 0 sets the decoding of QP encoded MIME attachments to unlimited. A
value other than 0 or -1 restricts the decoding of QP MIME attachments, and applies per 
attachment. A SMTP preprocessor alert with sid 11 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection 
is turned on the QP encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">61</SPAN>.</B> 
<DD><TT>bitenc_decode_depth</TT>

<P>
This config option is used to turn off/on or set the non-encoded MIME extraction
depth used to extract the non-encoded MIME attachments. The value ranges from -1 
to 65535. A value of -1 turns off the extraction of these MIME attachments. 
The value of 0 sets the extraction of these MIME attachments to unlimited.
A value other than 0 or -1 restricts the extraction of these MIME attachments, and applies 
per attachment.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection 
is turned on the non-encoded MIME attachments/data across multiple packets are extracted too.

<P>
The extracted data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">62</SPAN>.</B> 
<DD><TT>uu_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Unix-to-Unix decoding depth
used to decode the Unix-to-Unix(UU) encoded attachments. The value ranges
from -1 to 65535. A value of -1 turns off the UU decoding of SMTP attachments.
The value of 0 sets the decoding of UU encoded SMTP attachments to unlimited. A
value other than 0 or -1 restricts the decoding of UU SMTP attachments, and applies 
per attachment. A SMTP preprocessor alert with sid 13 is generated (if enabled) when the decoding fails.

<P>
Multiple UU attachments/data in one packet are pipelined. When stateful inspection
is turned on the UU encoded SMTP attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">63</SPAN>.</B> 
<DD><TT>enable_mime_decoding</TT>

<P>
Enables Base64 decoding of Mime attachments/data. Multiple base64 encoded MIME
attachments/data in one packet are pipelined. When stateful inspection is turned
on the base64 encoded MIME attachments/data across multiple packets are decoded too.
The decoding of base64 encoded attachments/data ends when either the 
<TT>max_mime_depth</TT> or maximum MIME sessions (calculated using 
<TT>max_mime_depth</TT> and <TT>max_mime_mem</TT>) is reached or when the 
encoded data ends. The decoded data is available for detection using the rule option 
<TT>file_data</TT>. See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
This option is deprecated. Use the option <TT>b64_decode_depth</TT> to turn off
or on the base64 decoding instead.

<P>
<DT> <B><SPAN CLASS="arabic">64</SPAN>.</B> 
<DD><TT>max_mime_depth &lt;int&gt;</TT>

<P>
Specifies the maximum number of base64 encoded data to decode per SMTP attachment.
The option take values ranging from 4 to 20480 bytes. The default value for this
in snort in 1460 bytes.

<P>
It is recommended that user inputs a value that is a multiple of 4. When the value 
specified is not a multiple of 4, the SMTP preprocessor will round it up to the next 
multiple of 4.

<P>
This option is deprecated. Use the option <TT>b64_decode_depth</TT> to turn off
or on the base64 decoding instead.

<P>
<DT> <B><SPAN CLASS="arabic">65</SPAN>.</B> 
<DD><TT>max_mime_mem &lt;int&gt;</TT>

<P>
This option determines (in bytes) the maximum amount of memory the SMTP preprocessor
will use for decoding base64 encoded/quoted-printable/non-encoded MIME attachments/data
or Unix-to-Unix encoded attachments. This value can be set from 3276 bytes to 100MB.

<P>
This option along with the maximum of the decoding depths will determine the SMTP
sessions that will be decoded at any given instant. The default value for this option
is 838860.

<P>
Note: It is suggested to set this value such that the max smtp session calculated as
follows is at least 1.

<P>
max smtp session = <TT>max_mime_mem</TT> /(2 * max of (<TT>b64_decode_depth</TT>, 
					<TT>uu_decode_depth</TT>, <TT>qp_decode_depth</TT>
                                        or <TT>bitenc_decode_depth</TT>))

<P>
For example, if <TT>b64_decode_depth</TT> is 0 (indicates unlimited decoding) and 
<TT>qp_decode_depth</TT> is 100, then

<P>
max smtp session = <TT>max_mime_mem</TT>/2*65535 (max value for <TT>b64_decode_depth</TT>)

<P>
In case of multiple configs, the <TT>max_mime_mem</TT> of the non-default configs will be overwritten by the
default config's value. Hence user needs to define it in the default config with the new keyword
disabled (used to disable SMTP preprocessor in a config).

<P>
<DT> <B><SPAN CLASS="arabic">66</SPAN>.</B> 
<DD><TT>log_mailfrom</TT>
This option enables SMTP preprocessor to parse and log the sender's email address extracted 
from the "MAIL FROM" command along with all the generated events for that session. The maximum
number of bytes logged for this option is 1024.

<P>
Please note, this is logged only with the unified2 output and is not logged with console output (-A cmg).
u2spewfoo can be used to read this data from the unified2.

<P>
<DT> <B><SPAN CLASS="arabic">67</SPAN>.</B> 
<DD><TT>log_rcptto</TT>
This option enables SMTP preprocessor to parse and log the recipient's email addresses 
extracted from the "RCPT TO" command along with all the generated events for that session. 
Multiple recipients are appended with commas. The maximum number of bytes logged for this option is 1024.

<P>
Please note, this is logged only with the unified2 output and is not logged with console output (-A cmg).
 u2spewfoo can be used to read this data from the unified2.

<P>
<DT> <B><SPAN CLASS="arabic">68</SPAN>.</B> 
<DD><TT>log_filename</TT>
This option enables SMTP preprocessor to parse and log the MIME attachment filenames extracted 
from the Content-Disposition header within the MIME body along with all the generated events 
for that session. Multiple filenames are appended with commas. The maximum number of bytes logged 
for this option is 1024.

<P>
Please note, this is logged only with the unified2 output and is not logged with the 
console output (-A cmg). u2spewfoo can be used to read this data from the unified2.

<P>
<DT> <B><SPAN CLASS="arabic">69</SPAN>.</B> 
<DD><TT>log_email_hdrs</TT>
This option enables SMTP preprocessor to parse and log the SMTP email headers extracted from 
SMTP data along with all generated events for that session. The number of bytes extracted and 
logged depends upon the <TT>email_hdrs_log_depth</TT>.

<P>
Please note, this is logged only with the unified2 output and is not logged with the console output (-A cmg). 
u2spewfoo can be used to read this data from the unified2.

<P>
<DT> <B><SPAN CLASS="arabic">70</SPAN>.</B> 
<DD><TT>email_hdrs_log_depth &lt;int&gt;</TT> 
This option specifies the depth for logging email headers. The allowed range for this option is 
0 - 20480. A value of 0 will disable email headers logging. The default value for this option is 1464. 

<P>
Please note, in case of multiple policies, the value specified in the default policy is used and the values 
specified in the targeted policies are overwritten by the default value. 
This option must be configured in the default policy even if the SMTP configuration is disabled.

<P>
<DT> <B><SPAN CLASS="arabic">71</SPAN>.</B> 
<DD><TT>memcap &lt;int&gt;</TT>
This option determines in bytes the maximum amount of memory the SMTP preprocessor will
use for logging of filename, MAIL FROM addresses, RCPT TO addresses and email headers. This value
along with the buffer size used to log MAIL FROM, RCPT TO, filenames and <TT>email_hdrs_log_depth</TT> 
will determine the maximum SMTP sessions that will log the email headers at any given time. When this memcap 
is reached SMTP will stop logging the filename, MAIL FROM address, RCPT TO addresses and email headers
until memory becomes available.

<P>
Max SMTP sessions logging email headers at any given time
                = memcap/(1024 + 1024 + 1024 + <TT>email_hdrs_log_depth</TT>)

<P>
The size 1024 is the maximum buffer size used for logging filename, RCPTTO and MAIL FROM addresses.

<P>
Default value for this option is 838860. The allowed range for this option is 3276 to 104857600.
The value specified in the default config is used when this option is specified in multiple configs.
This option must be configured in the default config even if the SMTP configuration is disabled.

<P>
Please note, in case of multiple policies, the value specified in the default policy is used and the values 
specified in the targeted policies are overwritten by the default value.                                                  
This option must be configured in the default policy even if the SMTP configuration is disabled.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION00328200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
</H3>

<P>
<PRE>
    preprocessor SMTP: \
        ports { 25 } \
        inspection_type stateful \
        normalize cmds \
        normalize_cmds { EXPN VRFY RCPT } \
        ignore_data \
        ignore_tls_data \
        max_command_line_len  512 \
        max_header_line_len   1024 \
        max_response_line_len 512 \
        no_alerts \
        alt_max_command_line_len 300 { RCPT } \
        invalid_cmds { } \
        valid_cmds { } \
        xlink2state { disable } \
	print_cmds \
	log_filename \
	log_email_hdrs \
	log_mailfrom \
	log_rcptto \
	email_hdrs_log_depth 2920 \
	memcap 6000

    preprocessor SMTP: \
	b64_decode_depth 0\
        max_mime_mem 4000 \
	memcap 6000 \
	email_hdrs_log_depth 2920 \
	disabled
</PRE>

<P>

<H3><A NAME="SECTION00328300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</H3>

<P>
<PRE>
    preprocessor SMTP: \
        ports { 25 } \
        inspection_type stateful \
        normalize cmds \
        normalize_cmds { EXPN VRFY RCPT } \
        alt_max_command_line_len 260 { MAIL } \
        alt_max_command_line_len 300 { RCPT } \
        alt_max_command_line_len 500 { HELP HELO ETRN } \
        alt_max_command_line_len 255 { EXPN VRFY }
</PRE>

<P>

<H3><A NAME="SECTION00328400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">4</SPAN> Note</A>
</H3>

<P>
<TT>RCPT TO:</TT> and <TT>MAIL FROM:</TT> are SMTP commands.  For the
preprocessor configuration, they are referred to as RCPT and MAIL,
respectively.  Within the code, the preprocessor actually maps RCPT and MAIL to
the correct command name.

<P>

<H2><A NAME="SECTION00329000000000000000"></A>
<A NAME="POP"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN> POP Preprocessor
</H2>

<P>
POP is an POP3 decoder for user applications. Given a data buffer,
POP will decode the buffer and find POP3 commands and responses.
It will also mark the command, data header data body sections and
extract the POP3 attachments and decode it appropriately.

<P>
POP will handle stateful processing. It saves state between individual
packets. However maintaining correct state is dependent on the reassembly
of the server side of the stream (i.e., a loss of coherent stream data results
in a loss of state).

<P>
Stream should be turned on for POP. Please ensure that the POP ports are added
 to the stream5 ports for proper reassembly.

<P>
The POP preprocessor uses GID 142 to register events.

<P>

<H3><A NAME="SECTION00329100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
The configuration options are described below:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">72</SPAN>.</B> 
<DD><TT>ports { &lt;port&gt; [&lt;port&gt;] ... }</TT>

<P>
This specifies on what ports to check for POP data.  Typically, this will
include 110. Default ports if none are specified are 110 .

<P>
<DT> <B><SPAN CLASS="arabic">73</SPAN>.</B> 
<DD><TT>disabled</TT>

<P>
Disables the POP preprocessor in a config. This is useful when specifying
the decoding depths such as <TT>b64_decode_depth</TT>, <TT>qp_decode_depth</TT>,
<TT>uu_decode_depth</TT>, <TT>bitenc_decode_depth</TT> or the memcap used for
decoding <TT>memcap</TT> in default config without turning on the POP preprocessor.

<P>
<DT> <B><SPAN CLASS="arabic">74</SPAN>.</B> 
<DD><TT>b64_decode_depth</TT>

<P>
This config option is used to turn off/on or set the base64 decoding depth used to
decode the base64 encoded MIME attachments. The value ranges from -1 to 65535.
A value of -1 turns off the base64 decoding of MIME attachments. The value of 0
sets the decoding of base64 encoded MIME attachments to unlimited. A value other
than 0 or -1 restricts the decoding of base64 MIME attachments, and applies per 
attachment. A POP preprocessor alert with sid 4 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the base64 encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
It is recommended that user inputs a value that is a multiple of 4. When the value specified 
is not a multiple of 4, the POP preprocessor will round it up to the next multiple of 4.

<P>
In case of multiple configs, the value specified in the non-default config cannot
exceed the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">75</SPAN>.</B> 
<DD><TT>qp_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Quoted-Printable decoding depth
used to decode the Quoted-Printable(QP) encoded MIME attachments. The value ranges
from -1 to 65535. A value of -1 turns off the QP decoding of MIME attachments.
The value of 0 sets the decoding of QP encoded MIME attachments to unlimited. A
value other than 0 or -1 restricts the decoding of QP MIME attachments, and applies per 
attachment. A POP preprocessor alert with sid 5 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the QP encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">76</SPAN>.</B> 
<DD><TT>bitenc_decode_depth</TT>

<P>
This config option is used to turn off/on or set the non-encoded MIME extraction
depth used to extract the non-encoded MIME attachments. The value ranges from -1 
to 65535. A value of -1 turns off the extraction of these MIME attachments. 
The value of 0 sets the extraction of these MIME attachments to unlimited.
A value other than 0 or -1 restricts the extraction of these MIME attachments, and applies 
per attachment.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the non-encoded MIME attachments/data across multiple packets are extracted too.

<P>
The extracted data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">77</SPAN>.</B> 
<DD><TT>uu_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Unix-to-Unix decoding depth
used to decode the Unix-to-Unix(UU) encoded attachments. The value ranges
from -1 to 65535. A value of -1 turns off the UU decoding of POP attachments.
The value of 0 sets the decoding of UU encoded POP attachments to unlimited. A
value other than 0 or -1 restricts the decoding of UU POP attachments, and applies per 
attachment. A POP preprocessor alert with sid 7 is generated (if enabled) when the decoding fails.

<P>
Multiple UU attachments/data in one packet are pipelined. When stateful inspection
is turned on the UU encoded POP attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">78</SPAN>.</B> 
<DD><TT>memcap &lt;int&gt;</TT>

<P>
This option determines (in bytes) the maximum amount of memory the POP preprocessor
will use for decoding base64 encoded/quoted-printable/non-encoded MIME attachments/data
or Unix-to-Unix encoded attachments. This value can be set from 3276 bytes to 100MB.

<P>
This option along with the maximum of the decoding depths will determine the POP 
sessions that will be decoded at any given instant. The default value for this option
is 838860.

<P>
Note: It is suggested to set this value such that the max pop session calculated as
follows is at least 1.

<P>
max pop session = <TT>memcap</TT> /(2 * max of (<TT>b64_decode_depth</TT>,
                                        <TT>uu_decode_depth</TT>, <TT>qp_decode_depth</TT>
                                        or <TT>bitenc_decode_depth</TT>))

<P>
For example, if <TT>b64_decode_depth</TT> is 0 (indicates unlimited decoding) and
<TT>qp_decode_depth</TT> is 100, then

<P>
max pop session = <TT>memcap</TT>/2*65535 (max value for <TT>b64_decode_depth</TT>)

<P>
In case of multiple configs, the <TT>memcap</TT> of the non-default configs will be overwritten by the
default config's value. Hence user needs to define it in the default config with the new keyword
disabled (used to disable POP preprocessor in a config).

<P>
When the memcap for decoding (<TT>memcap</TT>) is exceeded the POP preprocessor alert with sid 3 is
generated (when enabled).

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION00329200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
</H3>

<P>
<PRE>
	preprocessor pop: \
	  ports { 110 } \
	  memcap 1310700 \
	  qp_decode_depth -1 \
	  b64_decode_depth 0 \
	  bitenc_decode_depth 100


	preprocessor pop: \
	  memcap 1310700 \
	  qp_decode_depth 0 \
	  disabled
</PRE>

<P>

<H3><A NAME="SECTION00329300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</H3>

<P>
<PRE>
	preprocessor pop: \
	  ports { 110 } \
	  b64_decode_depth 1460 \
	  qp_decode_depth 1460 \
	  bitenc_decode_depth 1460 \
	  uu_decode_depth 1460
</PRE>

<P>

<H2><A NAME="SECTION003210000000000000000"></A>
<A NAME="IMAP"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN> IMAP Preprocessor
</H2>

<P>
IMAP is an IMAP4 decoder for user applications. Given a data buffer,
IMAP will decode the buffer and find IMAP4 commands and responses.
It will also mark the command, data header data body sections and
extract the IMAP4 attachments and decode it appropriately.

<P>
IMAP will handle stateful processing. It saves state between individual
packets. However maintaining correct state is dependent on the reassembly
of the server side of the stream (i.e., a loss of coherent stream data results
in a loss of state).

<P>
Stream should be turned on for IMAP. Please ensure that the IMAP ports are added
 to the stream5 ports for proper reassembly.

<P>
The IMAP preprocessor uses GID 141 to register events.

<P>

<H3><A NAME="SECTION003210100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
The configuration options are described below:

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">79</SPAN>.</B> 
<DD><TT>ports { &lt;port&gt; [&lt;port&gt;] ... }</TT>

<P>
This specifies on what ports to check for IMAP data.  Typically, this will
include 143. Default ports if none are specified are 143 .

<P>
<DT> <B><SPAN CLASS="arabic">80</SPAN>.</B> 
<DD><TT>disabled</TT>

<P>
Disables the IMAP preprocessor in a config. This is useful when specifying
the decoding depths such as <TT>b64_decode_depth</TT>, <TT>qp_decode_depth</TT>,
<TT>uu_decode_depth</TT>, <TT>bitenc_decode_depth</TT> or the memcap used for
decoding <TT>memcap</TT> in default config without turning on the IMAP preprocessor.

<P>
<DT> <B><SPAN CLASS="arabic">81</SPAN>.</B> 
<DD><TT>b64_decode_depth</TT>

<P>
This config option is used to turn off/on or set the base64 decoding depth used to
decode the base64 encoded MIME attachments. The value ranges from -1 to 65535.
A value of -1 turns off the base64 decoding of MIME attachments. The value of 0
sets the decoding of base64 encoded MIME attachments to unlimited. A value other
than 0 or -1 restricts the decoding of base64 MIME attachments, and applies per attachment. 
A IMAP preprocessor alert with sid 4 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the base64 encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
It is recommended that user inputs a value that is a multiple of 4. When the value specified 
is not a multiple of 4, the IMAP preprocessor will round it up to the next multiple of 4.

<P>
In case of multiple configs, the value specified in the non-default config cannot
exceed the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">82</SPAN>.</B> 
<DD><TT>qp_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Quoted-Printable decoding depth
used to decode the Quoted-Printable(QP) encoded MIME attachments. The value ranges
from -1 to 65535. A value of -1 turns off the QP decoding of MIME attachments.
The value of 0 sets the decoding of QP encoded MIME attachments to unlimited. A
value other than 0 or -1 restricts the decoding of QP MIME attachments, and applies per 
attachment. A IMAP preprocessor alert with sid 5 is generated (if enabled) when the decoding fails.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the QP encoded MIME attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">83</SPAN>.</B> 
<DD><TT>bitenc_decode_depth</TT>

<P>
This config option is used to turn off/on or set the non-encoded MIME extraction
depth used to extract the non-encoded MIME attachments. The
value ranges from -1 to 65535. A value of -1 turns off the extraction of these MIME
attachments. The value of 0 sets the extraction of these MIME attachments to unlimited.
A value other than 0 or -1 restricts the extraction of these MIME attachments, and applies 
per attachment.

<P>
Multiple MIME attachments/data in one packet are pipelined. When stateful inspection
is turned on the non-encoded MIME attachments/data across multiple packets are extracted too.

<P>
The extracted data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">84</SPAN>.</B> 
<DD><TT>uu_decode_depth</TT>

<P>
This config option is used to turn off/on or set the Unix-to-Unix decoding depth
used to decode the Unix-to-Unix(UU) encoded attachments. The value ranges
from -1 to 65535. A value of -1 turns off the UU decoding of IMAP attachments.
The value of 0 sets the decoding of UU encoded IMAP attachments to unlimited. A
value other than 0 or -1 restricts the decoding of UU IMAP attachments, and applies per 
attachment. A IMAP preprocessor alert with sid 7 is generated (if enabled) when the decoding fails.

<P>
Multiple UU attachments/data in one packet are pipelined. When stateful inspection
is turned on the UU encoded IMAP attachments/data across multiple packets are decoded too.

<P>
The decoded data is available for detection using the rule option <TT>file_data</TT>.
See <A HREF="node32.html#sub:file_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> rule option for more details.

<P>
In case of multiple configs, the value specified in the non-default config cannot exceed
the value specified in the default config.

<P>
<DT> <B><SPAN CLASS="arabic">85</SPAN>.</B> 
<DD><TT>memcap &lt;int&gt;</TT>

<P>
This option determines (in bytes) the maximum amount of memory the IMAP preprocessor
will use for decoding base64 encoded/quoted-printable/non-encoded MIME attachments/data
or Unix-to-Unix encoded attachments. This value can be set from 3276 bytes to 100MB.

<P>
This option along with the maximum of the decoding depths will determine the IMAP 
sessions that will be decoded at any given instant. The default value for this option
is 838860.

<P>
Note: It is suggested to set this value such that the max imap session calculated as
follows is at least 1.

<P>
max imap session = <TT>memcap</TT> /(2 * max of (<TT>b64_decode_depth</TT>,
                                        <TT>uu_decode_depth</TT>, <TT>qp_decode_depth</TT>
                                        or <TT>bitenc_decode_depth</TT>))

<P>
For example, if <TT>b64_decode_depth</TT> is 0 (indicates unlimited decoding) and
<TT>qp_decode_depth</TT> is 100, then

<P>
max imap session = <TT>memcap</TT>/2*65535 (max value for <TT>b64_decode_depth</TT>)

<P>
In case of multiple configs, the <TT>memcap</TT> of the non-default configs will be overwritten by the
default config's value. Hence user needs to define it in the default config with the new keyword
disabled (used to disable IMAP preprocessor in a config).

<P>
When the memcap for decoding (<TT>memcap</TT>) is exceeded the IMAP preprocessor alert with sid 3 is
generated (when enabled).

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION003210200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
</H3>

<P>
<PRE>
	preprocessor imap: \
	  ports { 110 } \
	  memcap 1310700 \
	  qp_decode_depth -1 \
	  b64_decode_depth 0 \
	  bitenc_decode_depth 100


	preprocessor imap: \
	  memcap 1310700 \
	  qp_decode_depth 0 \
	  disabled
</PRE>

<P>

<H3><A NAME="SECTION003210300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</H3>

<P>
<PRE>
	preprocessor imap: \
	  ports { 110 } \
	  b64_decode_depth 1460 \
	  qp_decode_depth 1460 \
	  bitenc_decode_depth 1460 \
	  uu_decode_depth 1460
</PRE>

<P>

<H2><A NAME="SECTION003211000000000000000"></A>
<A NAME="sub:ftptelnet"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP/Telnet Preprocessor
</H2>

<P>
FTP/Telnet is an improvement to the Telnet decoder and provides stateful
inspection capability for both FTP and Telnet data streams.  FTP/Telnet will
decode the stream, identifying FTP commands and responses and Telnet escape
sequences and normalize the fields.  FTP/Telnet works on both client requests
and server responses.

<P>
FTP/Telnet has the capability to handle stateless processing, meaning it only
looks for information on a packet-by-packet basis.  

<P>
The default is to run FTP/Telnet in stateful inspection mode, meaning it looks
for information and handles reassembled data correctly.

<P>
FTP/Telnet has a very &ldquo;rich&rdquo; user configuration, similar to that of HTTP
Inspect (See <A HREF="#sub:http-inspect"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>).  Users can configure individual FTP
servers and clients with a variety of options, which should allow the user to
emulate any type of FTP server or FTP Client.  Within FTP/Telnet, there are
four areas of configuration: Global, Telnet, FTP Client, and FTP Server.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
Some configuration options have an argument of <TT>yes</TT> or <TT>no</TT>.
This argument specifies whether the user wants the configuration option to
generate a ftptelnet alert or not.  The presence of the option indicates the
option itself is on, while the <TT>yes/no</TT> argument applies to the alerting
functionality associated with that option.

<P>
        
        </b></td></tr></table></p>

<P>

<H3><A NAME="SECTION003211100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
</H3>

<P>
The global configuration deals with configuration options that determine the
global functioning of FTP/Telnet.  The following example gives the generic
global configuration format:

<P>

<H3><A NAME="SECTION003211200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>

<P>
<PRE>
    preprocessor ftp_telnet: \
        global \
        inspection_type stateful \
        encrypted_traffic yes \
        check_encrypted
</PRE>

<P>
You can only have a single global configuration, you'll get an error if you try
otherwise.  The FTP/Telnet global configuration must appear before the other
three areas of configuration.

<P>

<H4><A NAME="SECTION003211210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">86</SPAN>.</B> 
<DD><TT>inspection_type</TT>

<P>
This indicates whether to operate in stateful or stateless mode.

<P>
<DT> <B><SPAN CLASS="arabic">87</SPAN>.</B> 
<DD><TT>encrypted_traffic <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option enables detection and alerting on encrypted Telnet and FTP command
channels.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>

<P>
When <TT>inspection_type</TT> is in stateless mode, checks for encrypted
traffic will occur on every packet, whereas in stateful mode, a particular
session will be noted as encrypted and not inspected any further.

<P>
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">88</SPAN>.</B> 
<DD><TT>check_encrypted</TT>

<P>
Instructs the preprocessor to continue to check an encrypted session for a
subsequent command to cease encryption.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION003211300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
</H3>

<P>
<PRE>
    preprocessor ftp_telnet: \
        global inspection_type stateful encrypted_traffic no
</PRE>

<P>

<H3><A NAME="SECTION003211400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">4</SPAN> Telnet Configuration</A>
</H3>

<P>
The telnet configuration deals with configuration options that determine the
functioning of the Telnet portion of the preprocessor.  The following example
gives the generic telnet configuration format:

<P>

<H3><A NAME="SECTION003211500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">5</SPAN> Format</A>
</H3>
<PRE>
    preprocessor ftp_telnet_protocol: \
        telnet \
        ports { 23 } \
        normalize \
        ayt_attack_thresh 6 \
        detect_anomalies
</PRE>

<P>
There should  only be a single telnet configuration, and subsequent instances
will override previously set values.

<P>

<H4><A NAME="SECTION003211510000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">89</SPAN>.</B> 
<DD><TT>ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This is how the user configures which ports to decode as telnet traffic.  SSH
tunnels cannot be decoded, so adding port 22 will only yield false positives.
Typically port 23 will be included.

<P>
<DT> <B><SPAN CLASS="arabic">90</SPAN>.</B> 
<DD><TT>normalize</TT>

<P>
This option tells the preprocessor to normalize the telnet traffic by
eliminating the telnet escape sequences.  It functions similarly to its
predecessor, the telnet_decode preprocessor.  Rules written with 'raw' content
options will ignore the normalized buffer that is created when this option is
in use.

<P>
<DT> <B><SPAN CLASS="arabic">91</SPAN>.</B> 
<DD><TT>ayt_attack_thresh <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option causes the preprocessor to alert when the number of consecutive
telnet Are You There (AYT) commands reaches the number specified.  It is only
applicable when the mode is stateful.

<P>
<DT> <B><SPAN CLASS="arabic">92</SPAN>.</B> 
<DD><TT>detect_anomalies</TT>

<P>
In order to support certain options, Telnet supports subnegotiation. Per the
Telnet RFC, subnegotiation begins with SB (subnegotiation begin) and must end
with an SE (subnegotiation end). However, certain implementations of Telnet
servers will ignore the SB without a corresponding SE. This is anomalous
behavior which could be an evasion case. Being that FTP uses the Telnet
protocol on the control connection, it is also susceptible to this behavior.
The <TT>detect_anomalies</TT> option enables alerting on Telnet SB without the
corresponding SE.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION003211600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example Telnet Configuration</A>
</H3>

<P>
<PRE>
    preprocessor ftp_telnet_protocol: \
        telnet ports { 23 } normalize ayt_attack_thresh 6
</PRE>

<P>

<H3><A NAME="SECTION003211700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">7</SPAN> FTP Server Configuration</A>
</H3>

<P>
There are two types of FTP server configurations: default and by IP address.

<P>

<H4><A NAME="SECTION003211710000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default server configuration for any FTP server
that is not individually configured.  Most of your FTP servers will most likely
end up using the default configuration.

<P>

<H3><A NAME="SECTION003211800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example Default FTP Server Configuration</A>
</H3>

<P>
<PRE>
    preprocessor ftp_telnet_protocol: \
        ftp server default ports { 21 }
</PRE>

<P>
Refer to <A HREF="node17.html#sub:default_ftp_server_config"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> for the list of options set in default ftp server configuration.

<P>

<H4><A NAME="SECTION003211810000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>

<P>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A NAME="SECTION003211900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example IP specific FTP Server Configuration</A>
</H3>

<P>
<PRE>
    preprocessor _telnet_protocol: \
        ftp server 10.1.1.1 ports { 21 } ftp_cmds { XPWD XCWD }
</PRE>

<P>

<H3><A NAME="SECTION0032111000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP Server Configuration Options</A>
</H3>

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">93</SPAN>.</B> 
<DD><TT>ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This is how the user configures which ports to decode as FTP command channel
traffic.  Typically port 21 will be included.

<P>
<DT> <B><SPAN CLASS="arabic">94</SPAN>.</B> 
<DD><TT>print_cmds</TT>

<P>
During initialization, this option causes the preprocessor to print the
configuration for each of the FTP commands for this server.  

<P>
<DT> <B><SPAN CLASS="arabic">95</SPAN>.</B> 
<DD><TT>ftp_cmds <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="87" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="$\{ cmd [cmd] \}$"></SPAN> </TT>

<P>
The preprocessor is configured to alert when it sees an FTP command that is not
allowed by the server.

<P>
This option specifies a list of additional commands allowed by this server,
outside of the default FTP command set as specified in RFC 959.  This may be
used to allow the use of the 'X' commands identified in RFC 775, as well as any
additional commands as needed.

<P>
For example:

<P>
<PRE>
    ftp_cmds { XPWD XCWD XCUP XMKD XRMD }
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">96</SPAN>.</B> 
<DD><TT>def_max_param_len <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This specifies the default maximum allowed parameter length for an FTP command.
It can be used as a basic buffer overflow detection.

<P>
<DT> <B><SPAN CLASS="arabic">97</SPAN>.</B> 
<DD><TT>alt_max_param_len <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"> <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<IMG
 WIDTH="87" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="$\{ cmd [cmd] \}$"></SPAN></TT>

<P>
This specifies the maximum allowed parameter length for the specified FTP
command(s).  It can be used as a more specific buffer overflow detection.  For
example the USER command - usernames may be no longer than 16 bytes, so the
appropriate configuration would be:

<P>
<PRE>
    alt_max_param_len 16 { USER }
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">98</SPAN>.</B> 
<DD><TT>chk_str_fmt <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="87" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="$\{ cmd [cmd] \}$"></SPAN></TT>

<P>
This option causes a check for string format attacks in the specified commands. 

<P>
<DT> <B><SPAN CLASS="arabic">99</SPAN>.</B> 
<DD><TT>cmd_validity cmd <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> fmt <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option specifies the valid format for parameters of a given command.

<P>
fmt must be enclosed in <SPAN CLASS="MATH"><IMG
 WIDTH="29" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img13.png"
 ALT="$&lt;&gt;$"></SPAN>'s and may contain the following:

<P>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Value</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=216><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">int</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be an integer</TD>
</TR>
<TR><TD ALIGN="LEFT">number</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be an integer between 1 and 255</TD>
</TR>
<TR><TD ALIGN="LEFT">char <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chars<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be a single character, one of <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>chars<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TD>
</TR>
<TR><TD ALIGN="LEFT">date <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>datefmt<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter follows format specified, where:

<P>
<TABLE CELLPADDING=3>
<TR><TD ALIGN="LEFT">n</TD>
<TD ALIGN="LEFT">Number</TD>
</TR>
<TR><TD ALIGN="LEFT">C</TD>
<TD ALIGN="LEFT">Character</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img14.png"
 ALT="$[]$"></SPAN></TD>
<TD ALIGN="LEFT">optional format enclosed</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN></TD>
<TD ALIGN="LEFT">OR</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img15.png"
 ALT="$\{\}$"></SPAN></TD>
<TD ALIGN="LEFT">choice of options</TD>
</TR>
<TR><TD ALIGN="LEFT">. + -</TD>
<TD ALIGN="LEFT">literal</TD>
</TR>
</TABLE></TD>
</TR>
<TR><TD ALIGN="LEFT">string</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter is a string (effectively unrestricted)</TD>
</TR>
<TR><TD ALIGN="LEFT">host_port</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be a host/port specified, per RFC 959</TD>
</TR>
<TR><TD ALIGN="LEFT">long_host_port</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be a long host port specified, per RFC 1639</TD>
</TR>
<TR><TD ALIGN="LEFT">extended_host_port</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>Parameter must be an extended host port specified, per RFC 2428</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img15.png"
 ALT="$\{\}$"></SPAN>, <SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>One of choices enclosed within, separated by <SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN></TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img15.png"
 ALT="$\{\}$"></SPAN>, <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img14.png"
 ALT="$[]$"></SPAN></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=216>One of the choices enclosed within <SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img15.png"
 ALT="$\{\}$"></SPAN>, optional value enclosed within <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img14.png"
 ALT="$[]$"></SPAN></TD>
</TR>
</TABLE>
</DIV>

<P>
Examples of the cmd_validity option are shown below.  These examples are the
default checks, per RFC 959 and others performed by the preprocessor.

<P>
<PRE>
    cmd_validity MODE &lt;char SBC&gt;
    cmd_validity STRU &lt;char FRP&gt;
    cmd_validity ALLO &lt; int [ char R int ] &gt;
    cmd_validity TYPE &lt; { char AE [ char NTC ] | char I | char L [ number ] } &gt;
    cmd_validity PORT &lt; host_port &gt;
</PRE>

<P>
A cmd_validity line can be used to override these defaults and/or add a check
for other commands.

<P>
<PRE>
    # This allows additional modes, including mode Z which allows for
    # zip-style compression.
    cmd_validity MODE &lt; char ASBCZ &gt;
    
    # Allow for a date in the MDTM command.
    cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string &gt;
</PRE>

<P>
MDTM is an off case that is worth discussing.  While not part of an established
standard, certain FTP servers accept MDTM commands that set the modification
time on a file.  The most common among servers that do, accept a format using
YYYYMMDDHHmmss[.uuu].  Some others accept a format using YYYYMMDDHHmmss[+|-]TZ
format.  The example above is for the first case (time format as specified in
http://www.ietf.org/internet-drafts/draft-ietf-ftpext-mlst-16.txt)

<P>
To check validity for a server that uses the TZ format, use the following:

<P>
<PRE>
    cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[{+|-}n[n]] ] string &gt;
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">100</SPAN>.</B> 
<DD><TT>telnet_cmds <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option turns on detection and alerting when telnet escape sequences are
seen on the FTP command channel.  Injection of telnet escape sequences could be
used as an evasion attempt on an FTP command channel.

<P>
<DT> <B><SPAN CLASS="arabic">101</SPAN>.</B> 
<DD><TT>ignore_telnet_erase_cmds <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option allows Snort to ignore telnet escape sequences for erase character
(TNC EAC) and erase line (TNC EAL) when normalizing FTP command channel.  Some FTP
servers do not process those telnet escape sequences.

<P>
<DT> <B><SPAN CLASS="arabic">102</SPAN>.</B> 
<DD><TT>data_chan</TT>

<P>
This option causes the rest of snort (rules, other preprocessors) to ignore FTP
data channel connections.  Using this option means that <SPAN  CLASS="textbf">NO INSPECTION</SPAN>
other than TCP state will be performed on FTP data transfers.  It can be used
to improve performance, especially with large file transfers from a trusted
source.   If your rule set includes virus-type rules, it is recommended that
this option not be used.

<P>
Use of the "data_chan" option is deprecated in favor of the
"ignore_data_chan" option. "data_chan" will be removed in a future release.

<P>
<DT> <B><SPAN CLASS="arabic">103</SPAN>.</B> 
<DD><TT>ignore_data_chan <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option causes the rest of Snort (rules, other preprocessors) to ignore FTP
data channel connections.  Setting this option to "yes" means that <SPAN  CLASS="textbf">NO
INSPECTION</SPAN> other than TCP state will be performed on FTP data transfers.  It
can be used to improve performance, especially with large file transfers from a
trusted source.  If your rule set includes virus-type rules, it is recommended
that this option not be used.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION0032111100000000000000"></A>
<A NAME="sub:default_ftp_server_config"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP Server Base Configuration Options
</H3>

<P>
The base FTP server configuration is as follows.  Options specified in the
configuration file will modify this set of options.  FTP commands are added to
the set of allowed commands.  The other options will override those in the base
configuration.

<P>
<PRE>
    def_max_param_len 100
    ftp_cmds { USER PASS ACCT CWD CDUP SMNT 
	       QUIT REIN TYPE STRU MODE RETR 
	       STOR STOU APPE ALLO REST RNFR 
	       RNTO ABOR DELE RMD MKD PWD LIST 
               NLST SITE SYST STAT HELP NOOP } 
    ftp_cmds { AUTH ADAT PROT PBSZ CONF ENC } 
    ftp_cmds { PORT PASV LPRT LPSV EPRT EPSV } 
    ftp_cmds { FEAT OPTS } 
    ftp_cmds { MDTM REST SIZE MLST MLSD } 
    alt_max_param_len 0 { CDUP QUIT REIN PASV STOU ABOR PWD SYST NOOP } 
    cmd_validity MODE &lt; char SBC &gt; 
    cmd_validity STRU &lt; char FRPO [ string ] &gt; 
    cmd_validity ALLO &lt; int [ char R int ] &gt; 
    cmd_validity TYPE &lt; { char AE [ char NTC ] | char I | char L [ number ] } &gt; 
    cmd_validity PORT &lt; host_port &gt; 
    cmd_validity LPRT &lt; long_host_port &gt; 
    cmd_validity EPRT &lt; extd_host_port &gt; 
    cmd_validity EPSV &lt; [ { '1' | '2' | 'ALL' } ] &gt;
</PRE>

<P>

<H3><A NAME="SECTION0032111200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">12</SPAN> FTP Client Configuration</A>
</H3>

<P>
Similar to the FTP Server configuration, the FTP client configurations has two
types: default, and by IP address.

<P>

<H4><A NAME="SECTION0032111210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default client configuration for any FTP client
that is not individually configured.  Most of your FTP clients will most likely
end up using the default configuration.

<P>

<H3><A NAME="SECTION0032111300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">13</SPAN> Example Default FTP Client Configuration</A>
</H3>
<PRE>
    preprocessor ftp_telnet_protocol: \
        ftp client default bounce no max_resp_len 200
</PRE>

<P>

<H4><A NAME="SECTION0032111310000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>

<P>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A NAME="SECTION0032111400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">14</SPAN> Example IP specific FTP Client Configuration</A>
</H3>

<P>
<PRE>
    preprocessor ftp_telnet_protocol: \
        ftp client 10.1.1.1 bounce yes max_resp_len 500
</PRE>

<P>

<H3><A NAME="SECTION0032111500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">15</SPAN> FTP Client Configuration Options</A>
</H3>

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">104</SPAN>.</B> 
<DD><TT>max_resp_len <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This specifies the maximum allowed response length to an FTP command accepted
by the client.  It can be used as a basic buffer overflow detection.

<P>
<DT> <B><SPAN CLASS="arabic">105</SPAN>.</B> 
<DD><TT>bounce <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option turns on detection and alerting of FTP bounce attacks.  An FTP
bounce attack occurs when the FTP PORT command is issued and the specified host
does not match the host of the client.

<P>
<DT> <B><SPAN CLASS="arabic">106</SPAN>.</B> 
<DD><TT>bounce_to <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> CIDR,[port<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>portlow,porthi] <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
When the bounce option is turned on, this allows the PORT command to use the IP
address (in CIDR format) and port (or inclusive port range) without generating
an alert.  It can be used to deal with proxied FTP connections where the FTP
data channel is different from the client.

<P>
A few examples:

<P>

<UL>
<LI>Allow bounces to 192.162.1.1 port 20020 - i.e., the use of
<TT>PORT 192,168,1,1,78,52</TT>.

<P>
<PRE>
    bounce_to { 192.168.1.1,20020 }
</PRE>

<P>
</LI>
<LI>Allow bounces to 192.162.1.1 ports 20020 through 20040 - i.e., the use of
<TT>PORT 192,168,1,1,78,xx</TT>, where xx is 52 through 72 inclusive.

<P>
<PRE>
    bounce_to { 192.168.1.1,20020,20040 }
</PRE>

<P>
</LI>
<LI>Allow bounces to 192.162.1.1 port 20020 and 192.168.1.2 port 20030.

<P>
<PRE>
    bounce_to { 192.168.1.1,20020 192.168.1.2,20030 }
</PRE>

<P>
</LI>
<LI>Allows bounces to IPv6 address fe8::5 port 59340.  

<P>
<PRE>
    bounce_to { fe8::5,59340 }
</PRE>

<P>
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">107</SPAN>.</B> 
<DD><TT>telnet_cmds <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option turns on detection and alerting when telnet escape sequences are
seen on the FTP command channel.  Injection of telnet escape sequences could be
used as an evasion attempt on an FTP command channel.

<P>
<DT> <B><SPAN CLASS="arabic">108</SPAN>.</B> 
<DD><TT>ignore_telnet_erase_cmds <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
This option allows Snort to ignore telnet escape sequences for erase character
(TNC EAC) and erase line (TNC EAL) when normalizing FTP command channel.  Some FTP
clients do not process those telnet escape sequences.

<P>
</DD>
</DL> 
<P>

<H3><A NAME="SECTION0032111600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">16</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>
<PRE>
    preprocessor ftp_telnet: \
        global \
        encrypted_traffic yes \
        inspection_type stateful

    preprocessor ftp_telnet_protocol:\
        telnet \
        normalize \
        ayt_attack_thresh 200

    # This is consistent with the FTP rules as of 18 Sept 2004.
    # Set CWD to allow parameter length of 200
    # MODE has an additional mode of Z (compressed)
    # Check for string formats in USER &amp; PASS commands
    # Check MDTM commands that set modification time on the file.

    preprocessor ftp_telnet_protocol: \
        ftp server default \
        def_max_param_len 100 \
        alt_max_param_len 200 { CWD } \
        cmd_validity MODE &lt; char ASBCZ &gt; \
        cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string &gt; \
        chk_str_fmt { USER PASS RNFR RNTO SITE MKD } \
        telnet_cmds yes \
        ignore_data_chan yes

    preprocessor ftp_telnet_protocol: \
        ftp client default \
        max_resp_len 256 \
        bounce yes \
        telnet_cmds yes
</PRE>

<P>

<H2><A NAME="SECTION003212000000000000000"></A>
<A NAME="sub:ssh"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN> SSH
</H2>

<P>
The SSH preprocessor detects the following exploits: Challenge-Response Buffer
Overflow, CRC 32, Secure CRT, and the Protocol Mismatch exploit.

<P>
Both Challenge-Response Overflow and CRC 32 attacks occur after the key
exchange, and are therefore encrypted.  Both attacks involve sending a large
payload (20kb+) to the server immediately after the authentication challenge.
To detect the attacks, the SSH preprocessor counts the number of bytes
transmitted to the server.  If those bytes exceed a predefined limit within a
predefined number of packets, an alert is generated.  Since the
Challenge-Response Overflow only effects SSHv2 and CRC 32 only effects SSHv1,
the SSH version string exchange is used to distinguish the attacks.

<P>
The Secure CRT and protocol mismatch exploits are observable before the key
exchange.

<P>

<H3><A NAME="SECTION003212100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
By default, all alerts are disabled and the preprocessor checks traffic on port
22.

<P>
The available configuration options are described below.

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">109</SPAN>.</B> 
<DD><TT>server_ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This option specifies which ports the SSH preprocessor should inspect traffic
to.

<P>
<DT> <B><SPAN CLASS="arabic">110</SPAN>.</B> 
<DD><TT>max_encrypted_packets <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The number of stream reassembled encrypted packets that Snort will inspect before ignoring a given
SSH session. The SSH vulnerabilities that Snort can detect all happen at the
very beginning of an SSH session. Once max_encrypted_packets packets have been
seen, Snort ignores the session to increase performance. The default is set to 25.
This value can be set from 0 to 65535.

<P>
<DT> <B><SPAN CLASS="arabic">111</SPAN>.</B> 
<DD><TT>max_client_bytes <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The number of unanswered bytes allowed to be transferred before alerting on
Challenge-Response Overflow or CRC 32. This number must be hit before
max_encrypted_packets packets are sent, or else Snort will ignore the traffic.
The default is set to 19600. This value can be set from 0 to 65535.

<P>
<DT> <B><SPAN CLASS="arabic">112</SPAN>.</B> 
<DD><TT>max_server_version_len <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></TT>

<P>
The maximum number of bytes allowed in the SSH server version string before
alerting on the Secure CRT server version string overflow. The default is set to
80. This value can be set from 0 to 255.

<P>
<DT> <B><SPAN CLASS="arabic">113</SPAN>.</B> 
<DD><TT>autodetect</TT>

<P>
Attempt to automatically detect SSH.

<P>
<DT> <B><SPAN CLASS="arabic">114</SPAN>.</B> 
<DD><TT>enable_respoverflow</TT>

<P>
Enables checking for the Challenge-Response Overflow exploit.

<P>
<DT> <B><SPAN CLASS="arabic">115</SPAN>.</B> 
<DD><TT>enable_ssh1crc32</TT>

<P>
Enables checking for the CRC 32 exploit.

<P>
<DT> <B><SPAN CLASS="arabic">116</SPAN>.</B> 
<DD><TT>enable_srvoverflow</TT>

<P>
Enables checking for the Secure CRT exploit.

<P>
<DT> <B><SPAN CLASS="arabic">117</SPAN>.</B> 
<DD><TT>enable_protomismatch</TT>

<P>
Enables checking for the Protocol Mismatch exploit.

<P>
<DT> <B><SPAN CLASS="arabic">118</SPAN>.</B> 
<DD><TT>enable_badmsgdir</TT>

<P>
Enable alerts for traffic flowing the wrong direction. For instance, if the
presumed server generates client traffic, or if a client generates server
traffic.

<P>
<DT> <B><SPAN CLASS="arabic">119</SPAN>.</B> 
<DD><TT>enable_paysize</TT>

<P>
Enables alerts for invalid payload sizes.

<P>
<DT> <B><SPAN CLASS="arabic">120</SPAN>.</B> 
<DD><TT>enable_recognition</TT>

<P>
Enable alerts for non-SSH traffic on SSH ports.

<P>
</DD>
</DL> 
<P>
The SSH preprocessor should work by default.  After max_encrypted_packets is
reached, the preprocessor will stop processing traffic for a given session.  If
Challenge-Response Overflow or CRC 32 false positive, try increasing the number
of required client bytes with max_client_bytes.

<P>

<H3><A NAME="SECTION003212200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration from snort.conf</A>
</H3>

<P>
Looks for attacks on SSH server port 22.  Alerts at 19600 unacknowledged bytes
within 20 encrypted packets for the Challenge-Response Overflow/CRC32 exploits.

<P>
<PRE>
    preprocessor ssh: \
        server_ports { 22 } \
        max_client_bytes 19600 \
        max_encrypted_packets 20 \
        enable_respoverflow \
        enable_ssh1crc32
</PRE>

<P>

<H2><A NAME="SECTION003213000000000000000"></A>
<A NAME="sub:dns"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN> DNS
</H2>

<P>
The DNS preprocessor decodes DNS Responses and can detect the following
exploits: DNS Client RData Overflow, Obsolete Record Types, and Experimental
Record Types.

<P>
DNS looks at DNS Response traffic over UDP and TCP and it requires Stream
preprocessor to be enabled for TCP decoding.

<P>

<H3><A NAME="SECTION003213100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
By default, all alerts are disabled and the preprocessor checks traffic on port
53.

<P>
The available configuration options are described below.

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">121</SPAN>.</B> 
<DD><TT>ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This option specifies the source ports that the DNS preprocessor should inspect
traffic.

<P>
<DT> <B><SPAN CLASS="arabic">122</SPAN>.</B> 
<DD><TT>enable_obsolete_types</TT>

<P>
Alert on Obsolete (per RFC 1035) Record Types

<P>
<DT> <B><SPAN CLASS="arabic">123</SPAN>.</B> 
<DD><TT>enable_experimental_types</TT>

<P>
Alert on Experimental (per RFC 1035) Record Types

<P>
<DT> <B><SPAN CLASS="arabic">124</SPAN>.</B> 
<DD><TT>enable_rdata_overflow</TT>

<P>
Check for DNS Client RData TXT Overflow

<P>
</DD>
</DL> 
<P>
The DNS preprocessor does nothing if none of the 3 vulnerabilities it checks
for are enabled.  It will not operate on TCP sessions picked up midstream, and
it will cease operation on a session if it loses state because of missing data
(dropped packets).

<P>

<H3><A NAME="SECTION003213200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>

<P>
Looks for traffic on DNS server port 53.  Check for the DNS Client RData
overflow vulnerability.  Do not alert on obsolete or experimental RData record
types.

<P>
<PRE>
    preprocessor dns: \
        ports { 53 } \
        enable_rdata_overflow
</PRE>

<P>

<H2><A NAME="SECTION003214000000000000000"></A>
<A NAME="sub:SSL_TLS"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN> SSL/TLS
</H2>

<P>
Encrypted traffic should be ignored by Snort for both performance reasons and
to reduce false positives.  The SSL Dynamic Preprocessor (SSLPP) decodes SSL
and TLS traffic and optionally determines if and when Snort should stop
inspection of it.

<P>
Typically, SSL is used over port 443 as HTTPS.  By enabling the SSLPP to
inspect port 443 and enabling the noinspect_encrypted option, only the SSL
handshake of each connection will be inspected.  Once the traffic is determined
to be encrypted, no further inspection of the data on the connection is made.

<P>
By default, SSLPP looks for a handshake followed by encrypted traffic traveling
to both sides.  If one side responds with an indication that something has
failed, such as the handshake, the session is not marked as encrypted.
Verifying that faultless encrypted traffic is sent from both endpoints ensures
two things: the last client-side handshake packet was not crafted to evade
Snort, and that the traffic is legitimately encrypted.

<P>
In some cases, especially when packets may be missed, the only observed
response from one endpoint will be TCP ACKs.  Therefore, if a user knows that
server-side encrypted data can be trusted to mark the session as encrypted, the
user should use the 'trustservers' option, documented below.

<P>

<H3><A NAME="SECTION003214100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>

<DL COMPACT>
<DT> <B><SPAN CLASS="arabic">125</SPAN>.</B> 
<DD><TT>ports <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="38" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></TT>

<P>
This option specifies which ports SSLPP will inspect traffic on.

<P>
By default, SSLPP watches the following ports:

<P>

<UL>
<LI><TT>443</TT>     HTTPS   
</LI>
<LI><TT>465</TT>     SMTPS   
</LI>
<LI><TT>563</TT>     NNTPS                                                                
</LI>
<LI><TT>636</TT>     LDAPS
</LI>
<LI><TT>989</TT>     FTPS
</LI>
<LI><TT>992</TT>     TelnetS  
</LI>
<LI><TT>993</TT>     IMAPS                 
</LI>
<LI><TT>994</TT>     IRCS
</LI>
<LI><TT>995</TT>     POPS
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">126</SPAN>.</B> 
<DD><TT>noinspect_encrypted</TT>

<P>
Disable inspection on traffic that is encrypted.  Default is off.

<P>
<DT> <B><SPAN CLASS="arabic">127</SPAN>.</B> 
<DD><TT>max_heartbeat_length</TT>

<P>
Maximum length of heartbeat record allowed.  This config option is 
used to detect the heartbleed attacks.  The allowed range is 0 to 65535. 
Setting the value to 0 turns off the heartbeat length checks. For heartbeat 
requests, if the payload size of the request record is greater than the 
max_heartbeat_length an alert with sid 3 and gid 137 is generated.  
For heartbeat responses, if the record size itself is greater than 
the max_heartbeat_length an alert with sid 4 and gid 137 is generated. Default
is off.

<P>
<DT> <B><SPAN CLASS="arabic">128</SPAN>.</B> 
<DD><TT>trustservers</TT>

<P>
Disables the requirement that application (encrypted) data must be observed on
both sides of the session before a session is marked encrypted.  Use this
option for slightly better performance if you trust that your servers are not
compromised.  This requires the <TT>noinspect_encrypted</TT> option to be
useful.  Default is off.   
</DD>
</DL> 
<P>

<H3><A NAME="SECTION003214200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>

<P>
Enables the SSL preprocessor and tells it to disable inspection on encrypted
traffic.

<P>
<PRE>
    preprocessor ssl: noinspect_encrypted
</PRE>

<P>

<H3><A NAME="SECTION003214300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">14</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</H3>

<P>
The following rule options are supported by enabling the <TT>ssl</TT> preprocessor:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    ssl_version
    ssl_state
</PRE></td></tr></table>

<P>
<TT>ssl_version</TT>
<A NAME="ssl:ssl_version"></A><table width="90%"><tr><td valign="top">&nbsp;The <TT>ssl_version</TT> rule option tracks the version negotiated between
the endpoints of the SSL encryption.  The list of version identifiers are below, and
more than one identifier can be specified, via a comma separated list.  Lists of
identifiers are OR'ed together.

<P>
The option will match if any one of the OR'ed versions are used in the SSL
connection.  To check for two or more SSL versions in use simultaneously, multiple
<TT>ssl_version</TT> rule options should be used.

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   ssl_version: &lt;version-list&gt;

   version-list = version | version , version-list
   version      = ["!"] "sslv2" | "sslv3" | "tls1.0" | "tls1.1" | "tls1.2"
</PRE>
<P>
<SMALL CLASS="FOOTNOTESIZE"><SPAN  CLASS="textit">Examples</SPAN>
</SMALL><PRE>
   ssl_version:sslv3;
   ssl_version:tls1.0,tls1.1,tls1.2;
   ssl_version:!sslv2;
</PRE>
<P>
<SMALL CLASS="FOOTNOTESIZE"></td></tr></table>
</SMALL>

<P>
<TT>ssl_state</TT>
<A NAME="ssl:ssl_state"></A><table width="90%"><tr><td valign="top">&nbsp;The <TT>ssl_state</TT> rule option tracks the state of the SSL encryption
during the process of hello and key exchange.  The list of states are below.  More than
one state can be specified, via a comma separated list, and are OR'ed together.

<P>
The option will match if the connection is currently in any one of the OR'ed states.
To ensure the connection has reached each of a set of states, multiple rules using
the <TT>ssl_state</TT> rule option should be used.

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   ssl_state: &lt;state-list&gt;

   state-list = state | state , state-list
   state      = ["!"] "client_hello" | "server_hello" | "client_keyx" | "server_keyx" | "unknown"
</PRE>
<P>
<SMALL CLASS="FOOTNOTESIZE"><SPAN  CLASS="textit">Examples</SPAN>
</SMALL><PRE>
   ssl_state:client_hello;
   ssl_state:client_keyx,server_keyx;
   ssl_state:!server_hello;
</PRE>
<P>
<SMALL CLASS="FOOTNOTESIZE"></td></tr></table>
</SMALL>

<P>

<H2><A NAME="SECTION003215000000000000000"></A>
<A NAME="sub:arpspoof"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN> ARP Spoof Preprocessor
</H2>

<P>
The ARP spoof preprocessor decodes ARP packets and detects ARP attacks, unicast
ARP requests, and inconsistent Ethernet to IP mapping.

<P>
When no arguments are specified to arpspoof, the preprocessor inspects Ethernet
addresses and the addresses in the ARP packets. When inconsistency occurs, an
alert with GID 112 and SID 2 or 3 is generated.

<P>
When "<TT>-unicast</TT>" is specified as the argument of arpspoof, the
preprocessor checks for unicast ARP requests. An alert with GID 112 and SID 1
will be generated if a unicast ARP request is detected.

<P>
Specify a pair of IP and hardware address as the argument to
<TT>arpspoof_detect_host</TT>.  The host with the IP address should be on the
same layer 2 segment as Snort is.  Specify one host IP MAC combo per line. The
preprocessor will use this list when detecting ARP cache overwrite attacks.
Alert SID 4 is used in this case.

<P>

<H3><A NAME="SECTION003215100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>

<P>
<PRE>
    preprocessor arpspoof[: -unicast]
    preprocessor arpspoof_detect_host: ip mac
</PRE>

<P>
<BR>
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1" ALIGN="CENTER">
<TR><TH ALIGN="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><TT>ip</TT></TD>
<TD ALIGN="LEFT">IP address.</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>mac</TT></TD>
<TD ALIGN="LEFT">The Ethernet address corresponding to the preceding IP.</TD>
</TR>
</TABLE>
</DIV>
<BR>

<P>

<H3><A NAME="SECTION003215200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">15</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration</A>
</H3>

<P>
The first example configuration does neither unicast detection nor ARP mapping
monitoring. The preprocessor merely looks for Ethernet address inconsistencies.

<P>
<PRE>
    preprocessor arpspoof
</PRE>

<P>
The next example configuration does not do unicast detection but monitors ARP
mapping for hosts 192.168.40.1 and 192.168.40.2.

<P>
<PRE>
    preprocessor arpspoof
    preprocessor arpspoof_detect_host: 192.168.40.1 f0:0f:00:f0:0f:00
    preprocessor arpspoof_detect_host: 192.168.40.2 f0:0f:00:f0:0f:01
</PRE>

<P>
The third example configuration has unicast detection enabled.

<P>
<PRE>
    preprocessor arpspoof: -unicast
    preprocessor arpspoof_detect_host: 192.168.40.1 f0:0f:00:f0:0f:00
    preprocessor arpspoof_detect_host: 192.168.40.2 f0:0f:00:f0:0f:01
</PRE>

<P>

<H2><A NAME="SECTION003216000000000000000"></A>
<A NAME="sub:dcerpc2"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN> DCE/RPC 2 Preprocessor
</H2>

<P>
The main purpose of the preprocessor is to perform SMB desegmentation and
DCE/RPC defragmentation to avoid rule evasion using these techniques.  SMB
desegmentation is performed for the following commands that can be used to
transport DCE/RPC requests and responses: <TT>Write</TT>, <TT>Write Block
Raw</TT>, <TT>Write and Close</TT>, <TT>Write AndX</TT>, <TT>Transaction</TT>,
<TT>Transaction Secondary</TT>, <TT>Read</TT>, <TT>Read Block Raw</TT> and
<TT>Read AndX</TT>.  The following transports are supported for DCE/RPC: SMB,
TCP, UDP and RPC over HTTP v.1 proxy and server.  New rule options have been
implemented to improve performance, reduce false positives and reduce the count
and complexity of DCE/RPC based rules.

<P>

<H3><A NAME="SECTION003216100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<P>

<UL>
<LI>Stream session tracking must be enabled, i.e. <TT>stream5</TT>.  The
preprocessor requires a session tracker to keep its data.

<P>
</LI>
<LI>Stream reassembly must be performed for TCP sessions. If it is decided
that a session is SMB or DCE/RPC, either through configured ports, servers or
autodetecting, the <TT>dcerpc2</TT> preprocessor will enable stream reassembly
for that session if necessary.

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the <TT>frag3</TT>
preprocessor should be enabled and configured.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003216200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target Based</A>
</H3>

<P>
There are enough important differences between Windows and Samba versions that
a target based approach has been implemented. Some important differences:
<BR>
<P>
<SPAN  CLASS="textit">Named pipe instance tracking</SPAN>

<P>
<table width="90%"><tr><td valign="top">&nbsp;A combination of valid login handle or UID, share handle or TID and
file/named pipe handle or FID must be used to write data to a named pipe.  The
binding between these is dependent on OS/software version.

<P>
<table width="90%"><tr><td valign="top">&nbsp;Samba 3.0.22 and earlier

<P>
<table width="90%"><tr><td valign="top">&nbsp;Any valid UID and TID, along with a valid FID can be used to make a
request, however, if the TID used in creating the FID is deleted (via a tree
disconnect), the FID that was created using this TID becomes invalid, i.e. no
more requests can be written to that named pipe instance.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Samba greater than 3.0.22

<P>
<table width="90%"><tr><td valign="top">&nbsp;Any valid TID, along with a valid FID can be used to make a request.
However, only the UID used in opening the named pipe can be used to make a
request using the FID handle to the named pipe instance. If the TID used to
create the FID is deleted (via a tree disconnect), the FID that was created
using this TID becomes invalid, i.e. no more requests can be written to that
named pipe instance. If the UID used to create the named pipe instance is
deleted (via a <TT>Logoff AndX</TT>), since it is necessary in making a request
to the named pipe, the FID becomes invalid.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Windows 2003</td></tr>
<tr><td valign="top">&nbsp;Windows XP</td></tr>
<tr><td valign="top">&nbsp;Windows Vista

<P>
<table width="90%"><tr><td valign="top">&nbsp;These Windows versions require strict binding between the UID, TID and
FID used to make a request to a named pipe instance. Both the UID and TID used
to open the named pipe instance must be used when writing data to the same
named pipe instance. Therefore, deleting either the UID or TID invalidates the
FID.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Windows 2000

<P>
<table width="90%"><tr><td valign="top">&nbsp;Windows 2000 is interesting in that the first request to a named pipe
must use the same binding as that of the other Windows versions. However,
requests after that follow the same binding as Samba 3.0.22 and earlier, i.e.
no binding. It also follows Samba greater than 3.0.22 in that deleting the UID
or TID used to create the named pipe instance also invalidates it.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Accepted SMB commands</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;Samba in particular does not recognize certain commands under an
<TT>IPC$</TT> tree.
<table width="90%"><tr><td valign="top">&nbsp;Samba (all versions)
<table width="90%"><tr><td valign="top">&nbsp;Under an <TT>IPC$</TT> tree, does not accept:
<table width="90%"><tr><td valign="top">&nbsp;<TT>Open</TT></td></tr>
<tr><td valign="top">&nbsp;<TT>Write And Close</TT></td></tr>
<tr><td valign="top">&nbsp;<TT>Read</TT></td></tr>
<tr><td valign="top">&nbsp;<TT>Read Block Raw</TT></td></tr>
<tr><td valign="top">&nbsp;<TT>Write Block Raw</TT>
</td></tr></table>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Windows (all versions)
<table width="90%"><tr><td valign="top">&nbsp;Accepts all of the above commands under an <TT>IPC$</TT> tree.
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">AndX command chaining</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;Windows is very strict in what command combinations it allows to be
chained. Samba, on the other hand, is very lax and allows some nonsensical
combinations, e.g. multiple logins and tree connects (only one place to return
handles for these), login/logoff and tree connect/tree disconnect.  Ultimately,
we don't want to keep track of data that the server won't accept. An evasion
possibility would be accepting a fragment in a request that the server won't
accept that gets sandwiched between an exploit.

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Transaction tracking</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;The differences between a <TT>Transaction</TT> request and using one of
the <TT>Write*</TT> commands to write data to a named pipe are that (1) a
<TT>Transaction</TT> performs the operations of a write and a read from the
named pipe, whereas in using the <TT>Write*</TT> commands, the client has to
explicitly send one of the <TT>Read*</TT> requests to tell the server to send
the response and (2) a <TT>Transaction</TT> request is not written to the named
pipe until all of the data is received (via potential <TT>Transaction
Secondary</TT> requests) whereas with the <TT>Write*</TT> commands, data is written
to the named pipe as it is received by the server. Multiple Transaction
requests can be made simultaneously to the same named pipe. These requests can
also be segmented with <TT>Transaction Secondary</TT> commands. What
distinguishes them (when the same named pipe is being written to, i.e. having
the same FID) are fields in the SMB header representing a process id (PID) and
multiplex id (MID).  The PID represents the process this request is a part of.
An MID represents different sub-processes within a process (or under a PID).
Segments for each "thread" are stored separately and written to the named pipe
when all segments are received. It is necessary to track this so as not to
munge these requests together (which would be a potential evasion opportunity).

<P>
<table width="90%"><tr><td valign="top">&nbsp;Windows (all versions)
<table width="90%"><tr><td valign="top">&nbsp;Uses a combination of PID and MID to define a "thread".
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;Samba (all versions)
<table width="90%"><tr><td valign="top">&nbsp;Uses just the MID to define a "thread".
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Multiple Bind Requests</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;A <TT>Bind</TT> request is the first request that must be made in a
connection-oriented DCE/RPC session in order to specify the
interface/interfaces that one wants to communicate with.

<P>
<table width="90%"><tr><td valign="top">&nbsp;Windows (all versions)
<table width="90%"><tr><td valign="top">&nbsp;For all of the Windows versions, only one <TT>Bind</TT> can ever be
made on a session whether or not it succeeds or fails. Any binding after that
must use the <TT>Alter Context</TT> request.  If another <TT>Bind</TT> is made,
all previous interface bindings are invalidated.

<P>
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;Samba 3.0.20 and earlier
<table width="90%"><tr><td valign="top">&nbsp;Any amount of <TT>Bind</TT> requests can be made.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;Samba later than 3.0.20
<table width="90%"><tr><td valign="top">&nbsp;Another <TT>Bind</TT> request can be made if the first failed and no
interfaces were successfully bound to. If a <TT>Bind</TT> after a successful
<TT>Bind</TT> is made, all previous interface bindings are invalidated.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">DCE/RPC Fragmented requests - Context ID</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;Each fragment in a fragmented request carries the context id of the
bound interface it wants to make the request to.

<P>
<table width="90%"><tr><td valign="top">&nbsp;Windows (all versions)
<table width="90%"><tr><td valign="top">&nbsp;The context id that is ultimately used for the request is contained in
the first fragment.  The context id field in any other fragment can contain any
value.

<P>
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;Samba (all versions)
<table width="90%"><tr><td valign="top">&nbsp;The context id that is ultimately used for the request is contained in
the last fragment.  The context id field in any other fragment can contain any
value.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">DCE/RPC Fragmented requests - Operation number</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;Each fragment in a fragmented request carries an operation number
(opnum) which is more or less a handle to a function offered by the interface.

<P>
<table width="90%"><tr><td valign="top">&nbsp;Samba (all versions)</td></tr>
<tr><td valign="top">&nbsp;Windows 2000</td></tr>
<tr><td valign="top">&nbsp;Windows 2003</td></tr>
<tr><td valign="top">&nbsp;Windows XP
<table width="90%"><tr><td valign="top">&nbsp;The opnum that is ultimately used for the request is contained in the
last fragment.  The opnum field in any other fragment can contain any value.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Windows Vista
<table width="90%"><tr><td valign="top">&nbsp;The opnum that is ultimately used for the request is contained in the
first fragment.  The opnum field in any other fragment can contain any value.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">DCE/RPC Stub data byte order</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;The byte order of the stub data is determined differently for Windows
and Samba.

<P>
<table width="90%"><tr><td valign="top">&nbsp;Windows (all versions)
<table width="90%"><tr><td valign="top">&nbsp;The byte order of the stub data is that which was used in the
<TT>Bind</TT> request.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;Samba (all versions)

<P>
<table width="90%"><tr><td valign="top">&nbsp;The byte order of the stub data is that which is used in the request
carrying the stub data.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P>

<H3><A NAME="SECTION003216300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">3</SPAN> Configuration</A>
</H3>

<P>
The <TT>dcerpc2</TT> preprocessor has a global configuration and one or more
server configurations.  The global preprocessor configuration name is
<TT>dcerpc2</TT> and the server preprocessor configuration name is
<TT>dcerpc2_server</TT>.
<BR>
<P>
<SPAN ID="txt2020">Global Configuration</SPAN>

<P>
<PRE>
    preprocessor dcerpc2
</PRE>

<P>
The global <TT>dcerpc2</TT> configuration is required.  Only one global
<TT>dcerpc2</TT> configuration can be specified.
<BR>
<P>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>memcap</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;memcap&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>memcap 102400</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>disable_defrag</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_frag_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max-frag-len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>events</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;events&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>reassemble_threshold</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;re-thresh&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>disabled</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>smb_fingerprint_policy</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;fp-policy&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>smb_legacy_mode</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
</TABLE></td></tr></table>

<P>
<PRE>
    memcap           = 1024-4194303 (kilobytes)
    max-frag-len     = 1514-65535
    events           = pseudo-event | event | '[' event-list ']'
    pseudo-event     = "none" | "all"
    event-list       = event | event ',' event-list
    event            = "memcap" | "smb" | "co" | "cl"
    re-thresh        = 0-65535
    fp-policy        = "server" | "client" | "both"
</PRE>
<P>
<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>memcap</TT>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the maximum amount of run-time memory that can be allocated.
Run-time memory includes any memory allocated after configuration.  Default is
100 MB.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>disabled</TT>
<table width="90%"><tr><td valign="top">&nbsp;Disables the preprocessor. By default this value is turned off. When the 
preprocessor is disabled only the memcap option is applied when specified 
with the configuration.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>disable_defrag</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Tells the preprocessor not to do DCE/RPC defragmentation.  Default is
to do defragmentation.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_frag_len</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the maximum fragment size that will be added to the
defragmentation module. If a fragment is greater than this size, it is truncated
before being added to the defragmentation module.  The allowed range for this
option is 1514 - 65535.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>events</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the classes of events to enable.  (See Events section for an
enumeration and explanation of events.)

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>memcap</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Only one event. If the memcap is reached or exceeded, alert.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>smb</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Alert on events related to SMB processing.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>co</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Stands for connection-oriented DCE/RPC. Alert on events related to
connection-oriented DCE/RPC processing.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>cl</TT>
<table width="90%"><tr><td valign="top">&nbsp;Stands for connectionless DCE/RPC. Alert on events related to
connectionless DCE/RPC processing.

<P>
</td></tr></table>
</td></tr></table>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>reassemble_threshold</TT>
<table width="90%"><tr><td valign="top">&nbsp;Specifies a minimum number of bytes in the DCE/RPC desegmentation and
defragmentation buffers before creating a reassembly packet to send to the
detection engine. This option is useful in inline mode so as to potentially
catch an exploit early before full defragmentation is done.  A value of 0
supplied as an argument to this option will, in effect, disable this option.
Default is disabled.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>smb_fingerprint_policy</TT>
<table width="90%"><tr><td valign="top">&nbsp;By default, SMBv1, SMBv2, and SMBv3 files are inspected. 
        If legacy mode is configured, only SMBv1 file inspection is enabled. 

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>legacy_mode</TT>
<table width="90%"><tr><td valign="top">&nbsp;In the initial phase of an SMB session, the client needs to authenticate
with a SessionSetupAndX.  Both the request and response to this command
contain OS and version information that can allow the preprocessor to
dynamically set the policy for a session which allows for better
protection against Windows and Samba specific evasions.

<P>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Option examples</SPAN>
<PRE>
    memcap 30000
    max_frag_len 16840
    events none
    events all
    events smb
    events co
    events [co]
    events [smb, co]
    events [memcap, smb, co, cl]
    reassemble_threshold 500
    smb_fingerprint_policy both
    smb_fingerprint_policy client
    smb_legacy_mode
</PRE>
<P>
<SPAN  CLASS="textit">Configuration examples</SPAN>
<PRE>
    preprocessor dcerpc2
    preprocessor dcerpc2: memcap 500000
    preprocessor dcerpc2: max_frag_len 16840, memcap 300000, events smb
    preprocessor dcerpc2: memcap 50000, events [memcap, smb, co, cl], max_frag_len 14440
    preprocessor dcerpc2: disable_defrag, events [memcap, smb]
    preprocessor dcerpc2: reassemble_threshold 500
    preprocessor dcerpc2: memcap 50000, events [memcap, smb, co, cl], max_frag_len 14440, smb_fingerprint_policy both
</PRE>
<P>
<SPAN  CLASS="textit">Default global configuration</SPAN>
<PRE>
    preprocessor dcerpc2: memcap 102400
</PRE>
<P>
<SPAN ID="txt2097">Server Configuration</SPAN>

<P>
<PRE>
    preprocessor dcerpc2_server
</PRE>

<P>
The <TT>dcerpc2_server</TT> configuration is optional.  A
<TT>dcerpc2_server</TT> configuration must start with <TT>default</TT> or
<TT>net</TT> options.  The <TT>default</TT> and <TT>net</TT> options are
mutually exclusive.  At most one default configuration can be specified. If no
<TT>default</TT> configuration is specified, default values will be used for
the <TT>default</TT> configuration.  Zero or more <TT>net</TT> configurations
can be specified.  For any <TT>dcerpc2_server</TT> configuration, if
non-required options are not specified, the defaults will be used.  When
processing DCE/RPC traffic, the <TT>default</TT> configuration is used if no
net configurations match.  If a <TT>net</TT> configuration matches, it will
override the <TT>default</TT> configuration. A <TT>net</TT> configuration
matches if the packet's server IP address matches an IP address or net
specified in the <TT>net</TT> configuration.  The <TT>net</TT> option supports
IPv6 addresses.  Note that port and ip variables defined in <TT>snort.conf</TT>
<SMALL>CANNOT</SMALL> be used.

<P>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>default</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">YES</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>NONE</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>net</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;net&gt;</TT></TD>
<TD ALIGN="CENTER">YES</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>NONE</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>policy</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;policy&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>policy WinXP</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>detect</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;detect&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>detect [smb [139,445], tcp
135, udp 135, rpc-over-http-server 593]</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>autodetect</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;detect&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>autodetect [tcp
1025:, udp 1025:, rpc-over-http-server 1025:]</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>no_autodetect_http_proxy_ports</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>DISABLED (The
preprocessor autodetects on all proxy ports by default)</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>smb_invalid_shares</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;shares&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>NONE</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>smb_max_chain</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max-chain&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>smb_max_chain 3</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>smb_file_inspection</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;file-inspect&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>smb_file_inspection off</TT></TD>
</TR>
</TABLE></td></tr></table>

<P>
<PRE>
    net          = ip | '[' ip-list ']'
    ip-list      = ip | ip ',' ip-list
    ip           = ip-addr | ip-addr '/' prefix | ip4-addr '/' netmask
    ip-addr      = ip4-addr | ip6-addr
    ip4-addr     = a valid IPv4 address
    ip6-addr     = a valid IPv6 address (can be compressed)
    prefix       = a valid CIDR
    netmask      = a valid netmask
    policy       = "Win2000" | "Win2003" | "WinXP" | "WinVista" |
                   "Samba" | "Samba-3.0.22" | "Samba-3.0.20"
    detect       = "none" | detect-opt | '[' detect-list ']'
    detect-list  = detect-opt | detect-opt ',' detect-list
    detect-opt   = transport | transport port-item | 
                   transport '[' port-list ']'
    transport    = "smb" | "tcp" | "udp" | "rpc-over-http-proxy" | 
                   "rpc-over-http-server"
    port-list    = port-item | port-item ',' port-list
    port-item    = port | port-range
    port-range   = ':' port | port ':' | port ':' port
    port         = 0-65535
    shares       = share | '[' share-list ']'
    share-list   = share | share ',' share-list
    share        = word | '"' word '"' | '"' var-word '"'
    word         = graphical ASCII characters except ',' '"' ']' '[' '$'
    var-word     = graphical ASCII characters except ',' '"' ']' '['
    max-chain    = 0-255
    file-inspect = file-arg | '[' file-list ']'
    file-arg     = "off" | "on" | "only"
    file-list    = file-arg [ ',' "file-depth" &lt;int64_t&gt; ]
</PRE>
<P>
<table width="90%"><tr><td valign="top">&nbsp;Because the Snort main parser treats '$' as the start of a variable
and tries to expand it, shares with '$' must be enclosed quotes.

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Option explanations</SPAN>

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>default</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies that this configuration is for the default server
configuration.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>net</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies that this configuration is an IP or net specific
configuration. The configuration will only apply to the IP addresses and nets
supplied as an argument.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>policy</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the target-based policy to use when processing.  Default is
"WinXP".

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>detect</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the DCE/RPC transport and server ports that should be
detected on for the transport.  Defaults are ports 139 and 445 for SMB, 135 for
TCP and UDP, 593 for RPC over HTTP server and 80 for RPC over HTTP proxy. 

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>autodetect</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the DCE/RPC transport and server ports that the preprocessor
should attempt to autodetect on for the transport. The autodetect ports are
only queried if no detect transport/ports match the packet. The order in which
the preprocessor will attempt to autodetect will be - TCP/UDP, RPC over HTTP
server, RPC over HTTP proxy and lastly SMB.  Note that most dynamic DCE/RPC
ports are above 1024 and ride directly over TCP or UDP.  It would be very
uncommon to see SMB on anything other than ports 139 and 445.  Defaults are
1025-65535 for TCP, UDP and RPC over HTTP server.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>no_autodetect_http_proxy_ports</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;By default, the preprocessor will always attempt to autodetect for
ports specified in the detect configuration for rpc-over-http-proxy.  This is
because the proxy is likely a web server and the preprocessor should not look
at all web traffic. This option is useful if the RPC over HTTP proxy configured
with the detect option is only used to proxy DCE/RPC traffic.  Default is to
autodetect on RPC over HTTP proxy detect ports.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>smb_invalid_shares</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies SMB shares that the preprocessor should alert on if an
attempt is made to connect to them via a <TT>Tree Connect</TT> or <TT>Tree
Connect AndX</TT>.  Default is empty.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>smb_max_chain</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Specifies the maximum amount of AndX command chaining that is allowed
before an alert is generated.  Default maximum is 3 chained commands.  A value
of 0 disables this option. This value can be set from 0 to 255.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>smb_file_inspection</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;Instructs the preprocessor to do inspection of normal SMB file
transfers.  This includes doing file type and signature through
the file API as well as setting a pointer for the <TT>file_data</TT>
rule option.  Note that the <TT>file-depth</TT> option only applies to the
maximum amount of file data for which it will set the pointer for the
<TT>file_data</TT> rule option.  For file type and signature it will use the
value configured for the file API.  If <TT>only</TT> is specified, the
preprocessor will only do SMB file inspection, i.e. it will not do any DCE/RPC
tracking or inspection.  If <TT>on</TT> is specified with no
arguments, the default file depth is 16384 bytes.  An argument of -1 to
<TT>file-depth</TT> disables setting the pointer for <TT>file_data</TT>, effectively
disabling SMB file inspection in rules.  An argument of 0 to
<TT>file-depth</TT> means unlimited.  Default is <TT>off</TT>, i.e. no SMB file
inspection is done in the preprocessor. SMBv1, SMBv2, and SMBv3 are
 supported.

<P>
</td></tr></table>

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Option examples</SPAN>
<PRE>
    net 192.168.0.10
    net 192.168.0.0/24
    net [192.168.0.0/24]
    net 192.168.0.0/255.255.255.0
    net feab:45b3:ab92:8ac4:d322:007f:e5aa:7845
    net feab:45b3:ab92:8ac4:d322:007f:e5aa:7845/128
    net feab:45b3::/32
    net [192.168.0.10, feab:45b3::/32]
    net [192.168.0.0/24, feab:45b3:ab92:8ac4:d322:007f:e5aa:7845]
    policy Win2000
    policy Samba-3.0.22
    detect none
    detect smb
    detect [smb]
    detect smb 445
    detect [smb 445]
    detect smb [139,445]
    detect [smb [139,445]]
    detect [smb, tcp]
    detect [smb 139, tcp [135,2103]]
    detect [smb [139,445], tcp 135, udp 135, rpc-over-http-server [593,6002:6004]]
    autodetect none
    autodetect tcp
    autodetect [tcp]
    autodetect tcp 2025:
    autodetect [tcp 2025:]
    autodetect tcp [2025:3001,3003:]
    autodetect [tcp [2025:3001,3003:]]
    autodetect [tcp, udp]
    autodetect [tcp 2025:, udp 2025:]
    autodetect [tcp 2025:, udp, rpc-over-http-server [1025:6001,6005:]]
    smb_invalid_shares private
    smb_invalid_shares "private"
    smb_invalid_shares "C$"
    smb_invalid_shares [private, "C$"]
    smb_invalid_shares ["private", "C$"]
    smb_max_chain 1
    smb_file_inspection on
    smb_file_inspection off
    smb_file_inspection [ on, file-depth -1 ]
    smb_file_inspection [ on, file-depth 0 ]
    smb_file_inspection [ on, file-depth 4294967296 ]
    smb_file_inspection [ only, file-depth -1 ]
</PRE>
<P>
<SPAN  CLASS="textit">Configuration examples</SPAN>
<PRE>
    preprocessor dcerpc2_server: \
        default

    preprocessor dcerpc2_server: \
        default, policy Win2000

    preprocessor dcerpc2_server: \
        default, policy Win2000, detect [smb, tcp], autodetect tcp 1025:, \
        smb_invalid_shares ["C$", "D$", "ADMIN$"]

    preprocessor dcerpc2_server: net 10.4.10.0/24, policy Win2000

    preprocessor dcerpc2_server: \
        net [10.4.10.0/24,feab:45b3::/126], policy WinVista, smb_max_chain 1

    preprocessor dcerpc2_server: \
        net [10.4.10.0/24,feab:45b3::/126], policy WinVista, \
        detect [smb, tcp, rpc-over-http-proxy 8081], 
        autodetect [tcp, rpc-over-http-proxy [1025:6001,6005:]], \
        smb_invalid_shares ["C$", "ADMIN$"], no_autodetect_http_proxy_ports

    preprocessor dcerpc2_server: \
        net [10.4.11.56,10.4.11.57], policy Samba, detect smb, autodetect none

    preprocessor dcerpc2_server: default, policy WinXP, \
        smb_file_inspection [ on, file-depth 0 ]
</PRE>
<P>
<SPAN  CLASS="textit">Default server configuration</SPAN>
<PRE>
    preprocessor dcerpc2_server: default, policy WinXP, \
        detect [smb [139,445], tcp 135, udp 135, rpc-over-http-server 593], \
        autodetect [tcp 1025:, udp 1025:, rpc-over-http-server 1025:], \
        smb_max_chain 3, smb_file_inspection off
</PRE>
<P>
<SPAN ID="txt6166">Complete <TT>dcerpc2</TT> default configuration</SPAN>
<PRE>
    preprocessor dcerpc2: memcap 102400

    preprocessor dcerpc2_server: \
        default, policy WinXP, \
        detect [smb [139,445], tcp 135, udp 135, rpc-over-http-server 593], \
        autodetect [tcp 1025:, udp 1025:, rpc-over-http-server 1025:], \
        smb_max_chain 3, smb_file_inspection off
</PRE>
<P>

<H3><A NAME="SECTION003216400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">4</SPAN> Events</A>
</H3>
The preprocessor uses GID 133 to register events.
<BR>
<P>
<SPAN  CLASS="textit">Memcap events</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383><P>
If the memory cap is reached and the preprocessor is configured to alert.</TD>
</TR>
</TABLE></td></tr></table>

<P>
<SPAN  CLASS="textit">SMB events</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>An invalid NetBIOS Session Service type was specified in the header.
      Valid types are: <TT>Message</TT>, <TT>Request</TT> (only from client),
      <TT>Positive Response</TT> (only from server), <TT>Negative Response</TT>
      (only from server), <TT>Retarget Response</TT> (only from server) and
      <TT>Keep Alive</TT>.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>An SMB message type was specified in the header. Either a request was
      made by the server or a response was given by the client.</TD>
</TR>
<TR><TD ALIGN="RIGHT">4</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The SMB id does not equal <TT>&#92;xffSMB</TT> or
      <TT>&#92;xfeSMB</TT>.</TD>
</TR>
<TR><TD ALIGN="RIGHT">5</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The word count of the command header is invalid. SMB commands have
      pretty specific word counts and if the preprocessor sees a command with
      a word count that doesn't jive with that command, the preprocessor will
      alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">6</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Some commands require a minimum number of bytes after the command
      header. If a command requires this and the byte count is less than the
      minimum required byte count for that command, the preprocessor will
      alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">7</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Some commands, especially the commands from the SMB Core implementation
      require a data format field that specifies the kind of data that will be
      coming next. Some commands require a specific format for the data. The
      preprocessor will alert if the format is not that which is expected for
      that command.</TD>
</TR>
<TR><TD ALIGN="RIGHT">8</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Many SMB commands have a field containing an offset from the beginning
      of the SMB header to where the data the command is carrying starts. If
      this offset puts us before data that has already been processed or after
      the end of payload, the preprocessor will alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">9</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Some SMB commands, such as <TT>Transaction</TT>, have a field containing
      the total amount of data to be transmitted. If this field is zero, the
      preprocessor will alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">10</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the NetBIOS Session Service length field
      contains a value less than the size of an SMB header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">11</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the remaining NetBIOS packet length is
      less than the size of the SMB command header to be decoded.</TD>
</TR>
<TR><TD ALIGN="RIGHT">12</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the remaining NetBIOS packet length is
      less than the size of the SMB command byte count specified in the
      command header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">13</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the remaining NetBIOS packet length is
      less than the size of the SMB command data size specified in the command
      header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">14</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the total data count specified in the
      SMB command header is less than the data size specified in the SMB
      command header. (Total data count must always be greater than or equal
      to current data size.)</TD>
</TR>
<TR><TD ALIGN="RIGHT">15</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the total amount of data sent in a
      transaction is greater than the total data count specified in the SMB
      command header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">16</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the byte count specified in the SMB
      command header is less than the data size specified in the SMB command.
      (The byte count must always be greater than or equal to the data size.)</TD>
</TR>
<TR><TD ALIGN="RIGHT">17</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Some of the Core Protocol commands (from the initial SMB implementation)
      require that the byte count be some value greater than the data size
      exactly. The preprocessor will alert if the byte count minus a
      predetermined amount based on the SMB command is not equal to the data
      size.</TD>
</TR>
<TR><TD ALIGN="RIGHT">18</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>For the <TT>Tree Connect</TT> command (and not the
      <TT>Tree Connect AndX</TT> command), the preprocessor has to queue
      the requests up and wait for a server response to determine whether or
      not an IPC share was successfully connected to (which is what the
      preprocessor is interested in). Unlike the <TT>Tree Connect AndX</TT>
      response, there is no indication in the <TT>Tree Connect</TT> response
      as to whether the share is IPC or not. There should be under normal
      circumstances no more than a few pending tree connects at a time and
      the preprocessor will alert if this number is excessive.</TD>
</TR>
<TR><TD ALIGN="RIGHT">19</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>After a client is done writing data using the <TT>Write*</TT> commands,
      it issues a <TT>Read*</TT> command to the server to tell it to send a
      response to the data it has written. In this case the preprocessor is
      concerned with the server response. The <TT>Read*</TT> request contains
      the file id associated with a named pipe instance that the preprocessor
      will ultimately send the data to. The server response, however, does not
      contain this file id, so it need to be queued with the request and
      dequeued with the response. If multiple <TT>Read*</TT> requests are sent
      to the server, they are responded to in the order they were sent. There
      should be under normal circumstances no more than a few pending
      <TT>Read*</TT> requests at a time and the preprocessor will alert if this
      number is excessive.</TD>
</TR>
<TR><TD ALIGN="RIGHT">20</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the number of chained commands in a
      single request is greater than or equal to the configured amount
      (default is 3).</TD>
</TR>
<TR><TD ALIGN="RIGHT">21</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>With <TT>AndX</TT> command chaining it is possible to chain multiple
      <TT>Session Setup AndX</TT> commands within the same request. There is,
      however, only one place in the SMB header to return a login handle
      (or Uid).  Windows does not allow this behavior, however Samba does. This
      is anomalous behavior and the preprocessor will alert if it happens.</TD>
</TR>
<TR><TD ALIGN="RIGHT">22</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>With <TT>AndX</TT> command chaining it is possible to chain multiple
      <TT>Tree Connect AndX</TT> commands within the same request. There is,
      however, only one place in the SMB header to return a tree handle
      (or Tid).  Windows does not allow this behavior, however Samba does. This
      is anomalous behavior and the preprocessor will alert if it happens.</TD>
</TR>
<TR><TD ALIGN="RIGHT">23</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>When a <TT>Session Setup AndX</TT> request is sent to the server, the
      server responds (if the client successfully authenticates) which a user
      id or login handle. This is used by the client in subsequent requests to
      indicate that it has authenticated. A <TT>Logoff AndX</TT> request is
      sent by the client to indicate it wants to end the session and invalidate
      the login handle. With commands that are chained after a
      <TT>Session Setup AndX</TT> request, the login handle returned by the
      server is used for the subsequent chained commands. The combination of a
      <TT>Session Setup AndX</TT> command with a chained <TT>Logoff AndX</TT>
      command, essentially logins in and logs off in the same request and is
      anomalous behavior. The preprocessor will alert if it sees this.</TD>
</TR>
<TR><TD ALIGN="RIGHT">24</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A <TT>Tree Connect AndX</TT> command is used to connect to a share. The
      <TT>Tree Disconnect</TT> command is used to disconnect from that share.
      The combination of a <TT>Tree Connect AndX</TT> command with a chained
      <TT>Tree Disconnect</TT> command, essentially connects to a share and
      disconnects from the same share in the same request and is anomalous
      behavior. The preprocessor will alert if it sees this.</TD>
</TR>
<TR><TD ALIGN="RIGHT">25</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>An <TT>Open AndX</TT> or <TT>Nt Create AndX</TT> command is used to
      open/create a file or named pipe. (The preprocessor is only interested in
      named pipes as this is where DCE/RPC requests are written to.) The
      <TT>Close</TT> command is used to close that file or named pipe. The
      combination of a <TT>Open AndX</TT> or <TT>Nt Create AndX</TT> command
      with a chained <TT>Close</TT> command, essentially opens and closes the
      named pipe in the same request and is anomalous behavior.  The
      preprocessor will alert if it sees this.</TD>
</TR>
<TR><TD ALIGN="RIGHT">26</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if it sees any of the invalid SMB shares
      configured. It looks for a <TT>Tree Connect</TT> or
      <TT>Tree Connect AndX</TT> to the share.</TD>
</TR>
<TR><TD ALIGN="RIGHT">48</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if a data count for a Core dialect write
      command is zero.</TD>
</TR>
<TR><TD ALIGN="RIGHT">49</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>For some of the Core dialect commands such as <TT>Write</TT> and
      <TT>Read</TT>, there are two data count fields, one in the main command
      header and one in the data format section.  If these aren't the same, the
      preprocessor will alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">50</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>In the initial negotiation phase of an SMB session, the server in a
      <TT>Negotiate</TT> response and the client in a <TT>SessionSetupAndX</TT>
      request will advertise the maximum number of outstanding requests
      supported.  The preprocessor will alert if the lesser of the two is
      exceeded.</TD>
</TR>
<TR><TD ALIGN="RIGHT">51</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>When a client sends a request it uses a value called the MID (multiplex
      id) to match a response, which the server is supposed to echo, to a
      request.  If there are multiple outstanding requests with the same
      MID, the preprocessor will alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">52</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>In the <TT>Negotiate</TT> request a client gives a list of SMB dialects it
      supports, normally in order from least desirable to most desirable
      and the server responds with the index of the dialect to be used on
      the SMB session.  Anything less than "NT LM 0.12" would be very odd
      these days (even Windows 98 supports it) and the preprocessor will
      alert if the client doesn't offer it as a supported dialect or the
      server chooses a lesser dialect.</TD>
</TR>
<TR><TD ALIGN="RIGHT">53</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>There are a number of commands that are considered deprecated and/or
       obsolete by Microsoft (see MS-CIFS and MS-SMB).  If the preprocessor
       detects the use of a deprecated/obsolete command used it will alert.</TD>
</TR>
<TR><TD ALIGN="RIGHT">54</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>There are some commands that can be used that can be considered unusual
      in the context they are used.  These include some of the transaction
      commands such as:
      <TT>SMB_COM_TRANSACTION / TRANS_READ_NMPIPE</TT>
      <TT>SMB_COM_TRANSACTION / TRANS_WRITE_NMPIPE</TT>
      <TT>SMB_COM_TRANSACTION2 / TRANS2_OPEN2</TT>
      <TT>SMB_COM_NT_TRANSACT / NT_TRANSACT_CREATE</TT>
      The preprocessor will alert if it detects unusual use of a command.</TD>
</TR>
<TR><TD ALIGN="RIGHT">55</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Transaction commands have a setup count field that indicates the
      number of 16bit words in the transaction setup.  The preprocessor
      will alert if the setup count is invalid for the transaction
      command / sub command.</TD>
</TR>
<TR><TD ALIGN="RIGHT">56</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>There can be only one Negotiate transaction per session and it is the
      first thing a client and server do to determine the SMB dialect each
      supports.  The preprocessor will alert if the client attempts multiple
      dialect negotiations.</TD>
</TR>
<TR><TD ALIGN="RIGHT">57</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Malware will often set a file's attributes to ReadOnly/Hidden/System if
      it is successful in installing itself as a Windows service or is able to
      write an autorun.inf file since it doesn't want the user to see the file
      and the default folder options in Windows is not to display Hidden files.
      The preprocessor will alert if it detects a client attempt to set a
      file's attributes to ReadOnly/Hidden/System.</TD>
</TR>
<TR><TD ALIGN="RIGHT">58</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>File offset provided is greater than file size specified. This is applied
      to read / write requests for file.</TD>
</TR>
<TR><TD ALIGN="RIGHT">59</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Nextcommand specified in SMBv2 or SMBv3 header is beyond payload boundary.</TD>
</TR>
</TABLE></td></tr></table>

<P>
<SPAN  CLASS="textit">Connection-oriented DCE/RPC events</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">27</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the connection-oriented DCE/RPC major
      version contained in the header is not equal to 5.</TD>
</TR>
<TR><TD ALIGN="RIGHT">28</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the connection-oriented DCE/RPC minor
      version contained in the header is not equal to 0.</TD>
</TR>
<TR><TD ALIGN="RIGHT">29</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the connection-oriented DCE/RPC PDU type
      contained in the header is not a valid PDU type.</TD>
</TR>
<TR><TD ALIGN="RIGHT">30</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the fragment length defined in the header
      is less than the size of the header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">31</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the remaining fragment length is less
      than the remaining packet size.</TD>
</TR>
<TR><TD ALIGN="RIGHT">32</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if in a <TT>Bind</TT> or
      <TT>Alter Context</TT> request, there are no context items specified.</TD>
</TR>
<TR><TD ALIGN="RIGHT">33</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if in a <TT>Bind</TT> or
      <TT>Alter Context</TT> request, there are no transfer syntaxes to go with
      the requested interface.</TD>
</TR>
<TR><TD ALIGN="RIGHT">34</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if a non-last fragment is less than the size
      of the negotiated maximum fragment length. Most evasion techniques try
      to fragment the data as much as possible and usually each fragment comes
      well below the negotiated transmit size.</TD>
</TR>
<TR><TD ALIGN="RIGHT">35</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if a fragment is larger than the maximum
      negotiated fragment length.</TD>
</TR>
<TR><TD ALIGN="RIGHT">36</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The byte order of the request data is determined by the Bind in
      connection-oriented DCE/RPC for Windows.  It is anomalous behavior
      to attempt to change the byte order mid-session.</TD>
</TR>
<TR><TD ALIGN="RIGHT">37</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The call id for a set of fragments in a fragmented request should stay
      the same (it is incremented for each complete request). The preprocessor
      will alert if it changes in a fragment mid-request.</TD>
</TR>
<TR><TD ALIGN="RIGHT">38</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The operation number specifies which function the request is calling on
      the bound interface. If a request is fragmented, this number should stay
      the same for all fragments.  The preprocessor will alert if the opnum
      changes in a fragment mid-request.</TD>
</TR>
<TR><TD ALIGN="RIGHT">39</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The context id is a handle to a interface that was bound to. If a
      request if fragmented, this number should stay the same for all
      fragments. The preprocessor will alert if the context id changes in a
      fragment mid-request.</TD>
</TR>
</TABLE></td></tr></table>

<P>
<SPAN  CLASS="textit">Connectionless DCE/RPC events</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">40</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the connectionless DCE/RPC major version
      is not equal to 4.</TD>
</TR>
<TR><TD ALIGN="RIGHT">41</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the connectionless DCE/RPC PDU type is
      not a valid PDU type.</TD>
</TR>
<TR><TD ALIGN="RIGHT">42</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the packet data length is less than the
      size of the connectionless header.</TD>
</TR>
<TR><TD ALIGN="RIGHT">43</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The preprocessor will alert if the sequence number uses in a request is
      the same or less than a previously used sequence number on the session.
      In testing, wrapping the sequence number space produces strange behavior
      from the server, so this should be considered anomalous behavior.</TD>
</TR>
</TABLE></td></tr></table>

<P>

<H3><A NAME="SECTION003216500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">16</SPAN>.<SPAN CLASS="arabic">5</SPAN> Rule Options</A>
</H3>

<P>
New rule options are supported by enabling the <TT>dcerpc2</TT> preprocessor:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    dce_iface
    dce_opnum
    dce_stub_data
</PRE></td></tr></table>

<P>
New modifiers to existing <TT>byte_test</TT> and <TT>byte_jump</TT> rule
options:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    byte_test:dce
    byte_jump:dce
</PRE></td></tr></table>

<P>
<TT>dce_iface</TT>
<A NAME="dcerpc2:dce_iface"></A><table width="90%"><tr><td valign="top">&nbsp;For DCE/RPC based rules it has been necessary to set flow-bits based on
a client bind to a service to avoid false positives.  It is necessary for a
client to bind to a service before being able to make a call to it. When a
client sends a bind request to the server, it can, however, specify one or more
service interfaces to bind to. Each interface is represented by a UUID. Each
interface UUID is paired with a unique index (or context id) that future
requests can use to reference the service that the client is making a call to.
The server will respond with the interface UUIDs it accepts as valid and will
allow the client to make requests to those services.  When a client makes a
request, it will specify the context id so the server knows what service the
client is making a request to. Instead of using flow-bits, a rule can simply
ask the preprocessor, using this rule option, whether or not the client has
bound to a specific interface UUID and whether or not this client request is
making a request to it. This can eliminate false positives where more than one
service is bound to successfully since the preprocessor can correlate the bind
UUID to the context id used in the request.  A DCE/RPC request can specify
whether numbers are represented as big endian or little endian. The
representation of the interface UUID is different depending on the endianness
specified in the DCE/RPC previously requiring two rules - one for big endian
and one for little endian.  The preprocessor eliminates the need for two rules
by normalizing the UUID.  An interface contains a version. Some versions of an
interface may not be vulnerable to a certain exploit.  Also, a DCE/RPC request
can be broken up into 1 or more fragments. Flags (and a field in the
connectionless header) are set in the DCE/RPC header to indicate whether the
fragment is the first, a middle or the last fragment. Many checks for data in
the DCE/RPC request are only relevant if the DCE/RPC request is a first
fragment (or full request), since subsequent fragments will contain data deeper
into the DCE/RPC request. A rule which is looking for data, say 5 bytes into
the request (maybe it's a length field), will be looking at the wrong data on a
fragment other than the first, since the beginning of subsequent fragments are
already offset some length from the beginning of the request. This can be a
source of false positives in fragmented DCE/RPC traffic. By default it is
reasonable to only evaluate if the request is a first fragment (or full
request).  However, if the <TT>any_frag</TT> option is used to specify
evaluating on all fragments.
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dce_iface:&lt;uuid&gt;[, &lt;operator&gt;&lt;version&gt;][, any_frag];

    uuid       = hexlong '-' hexshort '-' hexshort '-' 2hexbyte '-' 6hexbyte
    hexlong    = 4hexbyte
    hexshort   = 2hexbyte
    hexbyte    = 2HEXDIGIT
    operator   = '&lt;' | '&gt;' | '=' | '!'
    version    = 0-65535
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    dce_iface:4b324fc8-1670-01d3-1278-5a47bf6ee188;
    dce_iface:4b324fc8-1670-01d3-1278-5a47bf6ee188, &lt;2;
    dce_iface:4b324fc8-1670-01d3-1278-5a47bf6ee188, any_frag;
    dce_iface:4b324fc8-1670-01d3-1278-5a47bf6ee188, =1, any_frag;
</PRE>
<P>
This option is used to specify an interface UUID. Optional arguments are an
interface version and operator to specify that the version be less than
('&lt;'), greater than ('&gt;'), equal to ('=') or not equal to
('!') the version specified.  Also, by default the rule will only be evaluated
for a first fragment (or full request, i.e. not a fragment) since most rules
are written to start at the beginning of a request. The <TT>any_frag</TT>
argument says to evaluate for middle and last fragments as well.  This option
requires tracking client <TT>Bind</TT> and <TT>Alter Context</TT> requests as
well as server <TT>Bind Ack</TT> and <TT>Alter Context</TT> responses for
connection-oriented DCE/RPC in the preprocessor. For each <TT>Bind</TT> and
<TT>Alter Context</TT> request, the client specifies a list of interface UUIDs
along with a handle (or context id) for each interface UUID that will be used
during the DCE/RPC session to reference the interface.  The server response
indicates which interfaces it will allow the client to make requests to - it
either accepts or rejects the client's wish to bind to a certain interface.
This tracking is required so that when a request is processed, the context id
used in the request can be correlated with the interface UUID it is a handle
for.

<P>
<TT>hexlong</TT> and <TT>hexshort</TT> will be specified and interpreted to be
in big endian order (this is usually the default way an interface UUID will be
seen and represented). As an example, the following Messenger interface UUID as
taken off the wire from a little endian <TT>Bind</TT> request:

<P>
<PRE>
    |f8 91 7b 5a 00 ff d0 11 a9 b2 00 c0 4f b6 e6 fc|
</PRE>

<P>
must be written as:

<P>
<PRE>
    5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc
</PRE>

<P>
The same UUID taken off the wire from a big endian <TT>Bind</TT> request:

<P>
<PRE>
    |5a 7b 91 f8 ff 00 11 d0 a9 b2 00 c0 4f b6 e6 fc|
</PRE>

<P>
must be written the same way:

<P>
<PRE>
    5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc
</PRE>

<P>
This option matches if the specified interface UUID matches the interface UUID
(as referred to by the context id) of the DCE/RPC request and if supplied, the
version operation is true. This option will not match if the fragment is not a
first fragment (or full request) unless the <TT>any_frag</TT> option is
supplied in which case only the interface UUID and version need match.  Note
that a defragmented DCE/RPC request will be considered a full request.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Using this rule option will automatically insert fast pattern contents into
the fast pattern matcher.  For UDP rules, the interface UUID, in both big and
little endian format will be inserted into the fast pattern matcher.  For TCP
rules, (1) if the rule option <TT>flow:to_server|from_client</TT> is used, <SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>05 00 00<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>
will be inserted into the fast pattern matcher, (2) if the rule option
<TT>flow:from_server|to_client</TT> is used, <SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>05 00 02<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN> will be inserted into the
fast pattern matcher and (3) if the flow isn't known, <SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN>05 00<SPAN CLASS="MATH"><IMG
 WIDTH="9" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\vert$"></SPAN> will be inserted
into the fast pattern matcher.  Note that if the rule already has content rule
options in it, the best (meaning longest) pattern will be used.  If a content
in the rule uses the <TT>fast_pattern</TT> rule option, it will unequivocally be used
over the above mentioned patterns.
        
        </b></td></tr></table></p>

<P>
</td></tr></table>

<P>
<TT>dce_opnum</TT>
<A NAME="dcerpc2:dce_opnum"></A><table width="90%"><tr><td valign="top">&nbsp;The opnum represents a specific function call to an interface. After is
has been determined that a client has bound to a specific interface and is
making a request to it (see above - <TT>dce_iface</TT>) usually we want to
know what function call it is making to that service. It is likely that an
exploit lies in the particular DCE/RPC function call.
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dce_opnum:&lt;opnum-list&gt;;

    opnum-list   = opnum-item | opnum-item ',' opnum-list
    opnum-item   = opnum | opnum-range
    opnum-range  = opnum '-' opnum
    opnum        = 0-65535
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    dce_opnum:15;
    dce_opnum:15-18;
    dce_opnum:15, 18-20;
    dce_opnum:15, 17, 20-22;
</PRE>
<P>
This option is used to specify an opnum (or operation number), opnum range or
list containing either or both opnum and/or opnum-range. The opnum of a DCE/RPC
request will be matched against the opnums specified with this option.  This
option matches if any one of the opnums specified match the opnum of the
DCE/RPC request.

<P>
</td></tr></table>

<P>
<TT>dce_stub_data</TT>
<A NAME="dcerpc2:dce_stub_data"></A><table width="90%"><tr><td valign="top">&nbsp;Since most netbios rules were doing protocol decoding only to get to
the DCE/RPC stub data, i.e. the remote procedure call or function call data,
this option will alleviate this need and place the cursor at the beginning of
the DCE/RPC stub data. This reduces the number of rule option checks and the
complexity of the rule.

<P>
This option takes no arguments.
<BR>
<P>
<SPAN  CLASS="textit">Example</SPAN>
<PRE>
    dce_stub_data;
</PRE>
<P>
This option is used to place the cursor (used to walk the packet payload in
rules processing) at the beginning of the DCE/RPC stub data, regardless of
preceding rule options. There are no arguments to this option.  This option
matches if there is DCE/RPC stub data.

<P>
The cursor is moved to the beginning of the stub data.  All ensuing rule
options will be considered "sticky" to this buffer.  The first rule option
following <TT>dce_stub_data</TT> should use absolute location modifiers if it is
position-dependent.  Subsequent rule options should use a relative modifier if
they are meant to be relative to a previous rule option match in the stub data
buffer.  Any rule option that does not specify a relative modifier will be
evaluated from the start of the stub data buffer.  To leave the stub data buffer
and return to the main payload buffer, use the <TT>pkt_data</TT> rule option -
see section <A HREF="node32.html#sub:pkt_data"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> for details).

<P>
</td></tr></table>

<TT>byte_test</TT> and <TT>byte_jump</TT> with <TT>dce</TT><A NAME="dcerpc2:byte_test_jump"></A><table width="90%"><tr><td valign="top">&nbsp;A DCE/RPC request can specify whether numbers are represented in big or
little endian. These rule options will take as a new argument <TT>dce</TT> and
will work basically the same as the normal
<TT>byte_test</TT>/<TT>byte_jump</TT>, but since the DCE/RPC preprocessor
will know the endianness of the request, it will be able to do the correct
conversion.

<P>
<TT>byte_test</TT>
<table width="90%"><tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    byte_test:&lt;convert&gt;, [!]&lt;operator&gt;, &lt;value&gt;, &lt;offset&gt; [, relative], dce;

    convert    = 1 | 2 | 4 (only with option "dce")
    operator   = '&lt;' | '=' | '&gt;' | '&lt;=' | '&gt;=' | '&amp;' | '^'
    value      = 0 - 4294967295
    offset     = -65535 to 65535
</PRE>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    byte_test:4, &gt;, 35000, 0, relative, dce;
    byte_test:2, !=, 2280, -10, relative, dce;
</PRE>
<P>
When using the <TT>dce</TT> argument to a <TT>byte_test</TT>, the following
normal <TT>byte_test</TT> arguments will not be allowed: <TT>big</TT>,
<TT>little</TT>, <TT>string</TT>, <TT>hex</TT>, <TT>dec</TT> and <TT>oct</TT>.
</td></tr></table>

<P>
<TT>byte_jump</TT>
<table width="90%"><tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    byte_jump:&lt;convert&gt;, &lt;offset&gt;[, relative][, multiplier &lt;mult_value&gt;] \
        [, align][, post_offset &lt;adjustment_value&gt;], dce;

    convert           = 1 | 2 | 4 (only with option "dce")
    offset            = -65535 to 65535
    mult_value        = 0 - 65535
    adjustment_value  = -65535 to 65535
</PRE>
<P>
<SPAN  CLASS="textit">Example</SPAN>
<PRE>
    byte_jump:4,-4,relative,align,multiplier 2,post_offset -4,dce;
</PRE>
<P>
When using the <TT>dce</TT> argument to a <TT>byte_jump</TT>, the following
normal <TT>byte_jump</TT> arguments will not be allowed: <TT>big</TT>,
<TT>little</TT>, <TT>string</TT>, <TT>hex</TT>, <TT>dec</TT>, <TT>oct</TT> and
<TT>from_beginning</TT>.

<P>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Example of rule complexity reduction</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;The following two rules using the new rule options replace 64 (set and
isset flowbit) rules that are necessary if the new rule options are not used:

<P>
<PRE>
    alert tcp $EXTERNAL_NET any -&gt; $HOME_NET [135,139,445,593,1024:] \
        (msg:"dns R_Dnssrv funcs2 overflow attempt"; flow:established,to_server; \
        dce_iface:50abc2a4-574d-40b3-9d66-ee4fd5fba076; dce_opnum:0-11; dce_stub_data; \
        pcre:"/^.{12}(\x00\x00\x00\x00|.{12})/s"; byte_jump:4,-4,relative,align,dce; \
        byte_test:4,&gt;,256,4,relative,dce; reference:bugtraq,23470; reference:cve,2007-1748; \
        classtype:attempted-admin; sid:1000068;)

    alert udp $EXTERNAL_NET any -&gt; $HOME_NET [135,1024:] \
        (msg:"dns R_Dnssrv funcs2 overflow attempt"; flow:established,to_server; \
        dce_iface:50abc2a4-574d-40b3-9d66-ee4fd5fba076; dce_opnum:0-11; dce_stub_data; \
        pcre:"/^.{12}(\x00\x00\x00\x00|.{12})/s"; byte_jump:4,-4,relative,align,dce; \
        byte_test:4,&gt;,256,4,relative,dce; reference:bugtraq,23470; reference:cve,2007-1748; \
        classtype:attempted-admin; sid:1000069;)
</PRE></td></tr></table>

<P>

<H2><A NAME="SECTION003217000000000000000"></A>
<A NAME="sub:sensitive_data"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN> Sensitive Data Preprocessor
</H2>

<P>
The Sensitive Data preprocessor is a Snort module that performs detection and
filtering of Personally Identifiable Information (PII). This information
includes credit card numbers, U.S. Social Security numbers, and email addresses.
A limited regular expression syntax is also included for defining your own PII.

<P>

<H3><A NAME="SECTION003217100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependencies</A>
</H3>

<P>
The Stream preprocessor must be enabled for the Sensitive Data preprocessor
to work.

<P>

<H3><A NAME="SECTION003217200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
</H3>

<P>
Sensitive Data configuration is split into two parts: the preprocessor config,
and the rule options. The preprocessor config starts with:

<P>
<PRE>
preprocessor sensitive_data:
</PRE>

<P>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>alert_threshold</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;number&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>alert_threshold 25</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>mask_output</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ssn_file</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;filename&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
</TABLE></td></tr></table>

<P>
<PRE>
    alert_threshold     =  1 - 65535
</PRE>
<P>
<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>alert_threshold</TT>
<table width="90%"><tr><td valign="top">&nbsp;The preprocessor will alert when any combination of PII are detected
in a session. This option specifies how many need to be detected before
alerting.
This should be set higher than the highest individual count in your
"sd_pattern" rules.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>mask_output</TT>
<table width="90%"><tr><td valign="top">&nbsp;This option replaces all but the last 4 digits of a detected PII with
"X"s. This is only done on credit card &amp; Social Security numbers, where
an organization's regulations may prevent them from seeing unencrypted
numbers.

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>ssn_file</TT>
<table width="90%"><tr><td valign="top">&nbsp;A Social Security number is broken up into 3 sections:
Area (3 digits), Group (2 digits), and Serial (4 digits).
On a monthly basis, the Social Security Administration publishes a list
of which Group numbers are in use for each Area.
These numbers can be updated in Snort by supplying a CSV file with the
new maximum Group numbers to use.
By default, Snort recognizes Social Security numbers issued up through
November 2009.

<P>
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Example preprocessor config</SPAN>
<PRE>
preprocessor sensitive_data: alert_threshold 25 \
                             mask_output \
                             ssn_file ssn_groups_Jan10.csv
</PRE>

<P>

<H3><A NAME="SECTION003217300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">17</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</H3>

<P>
Snort rules are used to specify which PII the preprocessor should look for.
A new rule option is provided by the preprocessor:

<P>
<PRE>
sd_pattern
</PRE>

<P>
This rule option specifies what type of PII a rule should detect.

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    sd_pattern:&lt;count&gt;, &lt;pattern&gt;;
</PRE>
<PRE>
    count   = 1 - 255
    pattern = any string
</PRE>
<P>
<SPAN  CLASS="textit">Option Explanations</SPAN>

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>count</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;This dictates how many times a PII pattern must be matched for an alert
to be generated. The count is tracked across all packets in a session.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>pattern</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;This is where the pattern of the PII gets specified. There are a few
built-in patterns to choose from:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>credit_card</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;The "credit_card" pattern matches 15- and 16-digit credit card
numbers. These numbers may have spaces, dashes, or nothing in
between groups. This covers Visa, Mastercard, Discover, and
American Express.
Credit card numbers matched this way have their check digits
verified using the Luhn algorithm.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>us_social</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;This pattern matches against 9-digit U.S. Social Security numbers.
The SSNs are expected to have dashes between the Area, Group, and
Serial sections.

<P>
SSNs have no check digits, but the preprocessor will check matches
against the list of currently allocated group numbers.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>us_social_nodashes</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;This pattern matches U.S. Social Security numbers without dashes
separating the Area, Group, and Serial sections.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>email</TT>

<P>
<table width="90%"><tr><td valign="top">&nbsp;This pattern matches against email addresses.
</td></tr></table>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;If the pattern specified is not one of the above built-in patterns,
then it is the definition of a custom PII pattern. Custom PII types
are defined using a limited regex-style syntax. The following
special characters and escape sequences are supported:

<P></td></tr>
<tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="CENTER"><TT>&#92;d</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any digit</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;D</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any non-digit</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;l</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any letter</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;L</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any non-letter</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;w</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any alphanumeric character</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;W</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches any non-alphanumeric character</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>{num}</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>used to repeat a character or escape sequence "num" times.
example:  "{3}" matches 3 digits.</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>?</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>makes the previous character or escape sequence optional.
example:  " ?" matches an optional space.
This behaves in a greedy manner.</TD>
</TR>
<TR><TD ALIGN="CENTER"><TT>&#92;&#92;</TT></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches a backslash</TD>
</TR>
<TR><TD ALIGN="CENTER">&#92;{, &#92;}</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches { and }</TD>
</TR>
<TR><TD ALIGN="CENTER">&#92;?</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=283>matches a question mark.</TD>
</TR>
</TABLE>

<P></td></tr>
<tr><td valign="top">&nbsp;Other characters in the pattern will be matched literally.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Unlike PCRE, <TT>&#92;w</TT> in this rule option does NOT match underscores.
        
        </b></td></tr></table></p>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    sd_pattern: 2,us_social;
</PRE>
    Alerts when 2 social security numbers (with dashes) appear in a session.

<P>
<PRE>
    sd_pattern: 5,(\d{3})\d{3}-\d{4};
</PRE>
    Alerts on 5 U.S. phone numbers, following the format (123)456-7890

<P>
Whole rule example:

<P>
<PRE>
    alert tcp $HOME_NET $HIGH_PORTS -&gt; $EXTERNAL_NET $SMTP_PORTS \
    (msg:"Credit Card numbers sent over email"; gid:138; sid:1000; rev:1; \
    sd_pattern:4,credit_card; metadata:service smtp;)
</PRE>

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Caveats</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>sd_pattern</TT> is not compatible with other rule options. Trying to use
other rule options with <TT>sd_pattern</TT> will result in an error message.

<P>
Rules using <TT>sd_pattern</TT> must use GID 138.
</td></tr></table>
</td></tr></table>

<P>

<H2><A NAME="SECTION003218000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN> Normalizer</A>
</H2>

<P>
When operating Snort in inline mode, it is helpful to normalize packets to help
minimize the chances of evasion.

<P>
To enable the normalizer, use the following when configuring Snort:

<P>
<PRE>
    ./configure --enable-normalizer
</PRE>

<P>
The normalize preprocessor is activated via the conf as outlined below.  There
are also many new preprocessor and decoder rules to alert on or drop packets
with "abnormal" encodings.

<P>
Note that in the following, fields are cleared only if they are non-zero.
Also, normalizations will only be enabled if the selected DAQ supports packet
replacement and is operating in inline mode.

<P>
If a policy is configured for <TT>inline_test</TT> or passive mode, any
normalization statements in the policy config are ignored.

<P>

<H3><A NAME="SECTION003218100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">1</SPAN> IP4 Normalizations</A>
</H3>

<P>
IP4 normalizations are enabled with:

<P>
<PRE>
    preprocessor normalize_ip4: [df], [rf], [tos], [trim]
</PRE>

<P>
Base normalizations enabled with "preprocessor <TT>normalize_ip4</TT>" include:

<P>

<UL>
<LI>TTL normalization if enabled (explained below).

<P>
</LI>
<LI>Clear the differentiated services field (formerly TOS).

<P>
</LI>
<LI>NOP all options octets.
</LI>
</UL> 

<P>
Optional normalizations include:

<P>

<UL>
<LI><TT>df</TT> 
don't fragment:  clear this bit on incoming packets.

<P>
</LI>
<LI><TT>rf</TT> 
reserved flag:  clear this bit on incoming packets.

<P>
</LI>
<LI><TT>tos</TT> 
type of service (differentiated services): clear this byte.

<P>
</LI>
<LI><TT>trim</TT> 
truncate packets with excess payload to the datagram length specified in the
IP header + the layer 2 header (e.g. ethernet), but don't truncate below minimum
frame length.  This is automatically disabled if the DAQ can't inject packets.
</LI>
</UL> 

<P>

<H3><A NAME="SECTION003218200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">2</SPAN> IP6 Normalizations</A>
</H3>

<P>
IP6 normalizations are enabled with:

<P>
<PRE>
    preprocessor normalize_ip6
</PRE>

<P>
Base normalizations enabled with "preprocessor <TT>normalize_ip6</TT>" include:

<P>

<UL>
<LI>Hop limit normalization if enabled (explained below).

<P>
</LI>
<LI>NOP all options octets in hop-by-hop and destination options extension headers.
</LI>
</UL> 

<P>

<H3><A NAME="SECTION003218300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">3</SPAN> ICMP4/6 Normalizations</A>
</H3>

<P>
ICMP4 and ICMP6 normalizations are enabled with:

<P>
<PRE>
    preprocessor normalize_icmp4
    preprocessor normalize_icmp6
</PRE>

<P>
Base normalizations enabled with the above include:

<P>

<UL>
<LI>Clear the code field in echo requests and replies.
</LI>
</UL> 

<P>

<H3><A NAME="SECTION003218400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">4</SPAN> TCP Normalizations</A>
</H3>

<P>
TCP normalizations are enabled with:

<P>
<PRE>
    preprocessor normalize_tcp: \
        [block], [rsv], [pad], \
        [req_urg], [req_pay], [req_urp], \
        [ips], [urp], [trim], \
        [trim_syn], [trim_rst], \
        [trim_win], [trim_mss], \
        [ecn &lt;ecn_type&gt;], \
        [opts [allow &lt;allowed_opt&gt;+]]

    &lt;ecn_type&gt; ::= stream | packet

    &lt;allowed_opt&gt; ::= \
        sack | echo | partial_order | conn_count | alt_checksum | md5 | &lt;num&gt;

    &lt;sack&gt; ::= { 4, 5 }
    &lt;echo&gt; ::= { 6, 7 }
    &lt;partial_order&gt; ::= { 9, 10 }
    &lt;conn_count&gt; ::= { 11, 12, 13 }
    &lt;alt_checksum&gt; ::= { 14, 15 }
    &lt;md5&gt; ::= { 19 }
    &lt;num&gt; ::= (3..255)
</PRE>

<P>
Normalizations include:

<P>

<UL>
<LI><TT>block</TT>
allow packet drops during TCP normalization.

<P>
</LI>
<LI><TT>rsv</TT>
clear the reserved bits in the TCP header.

<P>
</LI>
<LI><TT>pad</TT>
clear any option padding bytes.

<P>
</LI>
<LI><TT>req_urg</TT>
clear the urgent pointer if the urgent flag is not set.

<P>
</LI>
<LI><TT>req_pay</TT>
clear the urgent pointer and the urgent flag if there is no payload.

<P>
</LI>
<LI><TT>req_urp</TT> 
clear the urgent flag if the urgent pointer is not set.

<P>
</LI>
<LI><TT>ips</TT> 
ensure consistency in retransmitted data (also forces reassembly policy to
"first").  Any segments that can't be properly reassembled will be dropped.

<P>
</LI>
<LI><TT>trim_syn</TT> 
remove data on SYN.

<P>
</LI>
<LI><TT>trim_rst</TT> 
remove any data from RST packet.

<P>
</LI>
<LI><TT>trim_win</TT> 
trim data to window.

<P>
</LI>
<LI><TT>trim_mss</TT> 
trim data to MSS.

<P>
</LI>
<LI><TT>trim</TT> 
enable all of the above trim options.

<P>
</LI>
<LI><TT>ecn packet</TT> 

<P>
clear ECN flags on a per packet basis (regardless of negotiation).

<P>
</LI>
<LI><TT>ecn stream</TT> 

<P>
clear ECN flags if usage wasn't negotiated.  Should also enable <TT>require_3whs</TT>.

<P>
</LI>
<LI><TT>opts</TT> 

<P>
NOP all option bytes other than maximum segment size, window scaling,
timestamp, and any explicitly allowed with the allow keyword.  You can allow
options to pass by name or number.

<P>
</LI>
<LI><TT>opts</TT> 

<P>
if timestamp is present but invalid, or valid but not negotiated, NOP the
timestamp octets.

<P>
</LI>
<LI><TT>opts</TT> 

<P>
if timestamp was negotiated but not present, block the packet.

<P>
</LI>
<LI><TT>opts</TT> 

<P>
clear TS ECR if ACK flag is not set.

<P>
</LI>
<LI><TT>opts</TT> 

<P>
MSS and window scale options are NOP'd if SYN flag is not set.

<P>
</LI>
</UL> 

<P>

<H3><A NAME="SECTION003218500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">5</SPAN> TTL Normalization</A>
</H3>

<P>
TTL normalization pertains to both IP4 TTL (time-to-live) and IP6 (hop limit)
and is only performed if both the relevant base normalization is enabled (as
described above) and the minimum and new TTL values are configured, as follows:

<P>
<PRE>
    config min_ttl: &lt;min_ttl&gt;
    config new_ttl: &lt;new_ttl&gt;

    &lt;min_ttl&gt; ::= (1..255)
    &lt;new_ttl&gt; ::= (&lt;min_ttl&gt;+1..255)
</PRE>

<P>
If <TT>new_ttl </TT><SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> <TT>min_ttl</TT>, then if a packet is received with a
TTL <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN> <TT>min_ttl</TT>, the TTL will be set to <TT>new_ttl</TT>.

<P>
Note that this configuration item was deprecated in 2.8.6:

<P>
<PRE>
    preprocessor stream5_tcp: min_ttl &lt;#&gt;
</PRE>

<P>
By default <TT>min_ttl</TT> = 1 (TTL normalization is disabled). 
When TTL normalization is turned on the <TT>new_ttl</TT> is set
to 5 by default.

<P>

<H2><A NAME="SECTION003219000000000000000"></A>
<A NAME="sub:sip"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN> SIP Preprocessor
</H2>
Session Initiation Protocol (SIP) is an application-layer control (signaling)
protocol for creating,   modifying, and terminating sessions with one or more 
participants.  These sessions include Internet telephone calls, multimedia 
distribution, and multimedia conferences. SIP Preprocessor provides ways to 
tackle Common Vulnerabilities and Exposures (CVEs) related with SIP found over 
the past few years. It also makes detecting new attacks easier.

<P>

<H3><A NAME="SECTION003219100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<P>

<UL>
<LI>Stream session tracking must be enabled, i.e. stream5. Both TCP and UDP must be
      enabled in stream5. The preprocessor requires a session tracker to keep its 
      data. In addition, Stream API is able to provide correct support for ignoring 
      audio/video data channel.

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the frag3 preprocessor should be
      enabled and configured.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003219200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">2</SPAN> Configuration</A>
</H3>
The preprocessor configuration name is <TT>sip</TT>.
<BR><PRE>
    preprocessor sip
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>disabled</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_sessions</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_sessions&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_sessions 10000</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_dialogs</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_dialogs&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_dialogs 4</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ports</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;ports&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>ports { 5060 5061 } </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>methods</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;methods&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>methods { invite cancel ack bye 
                                                          register options } </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_uri_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_uri_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_uri_len 256 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_call_id_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_call_id_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_call_id_len 256 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_requestName_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_requestName_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_requestName_len 20 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_from_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_from_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_from_len 256 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_to_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_to_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_to_len 256 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_via_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_via_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_via_len 1024 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_contact_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_contact_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_contact_len 256 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>max_content_len</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;max_content_len&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>max_content_len 1024 </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ignore_call_channel</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
</TABLE></td></tr></table>

<PRE>
     max_sessions        = 1024-4194303
     max_dialogs         = 1-4194303
     methods             = "invite"|"cancel"|"ack"|"bye"|"register"| "options"\
                           |"refer" |"subscribe"|"update"|"join"|"info"|"message"\                
                           |"notify"|"prack"
     max_uri_len         = 0-65535
     max_call_id_len     = 0-65535
     max_requestName_len = 0-65535
     max_from_len        = 0-65535
     max_to_len          = 0-65535
     max_via_len         = 0-65535
     max_contact_len     = 0-65535
     max_content_len     = 0-65535
</PRE><SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>disabled</TT>
<table width="90%"><tr><td valign="top">&nbsp;SIP dynamic preprocessor can be enabled/disabled through configuration. 
      By default this value is turned off. When the preprocessor is disabled, 
      only the max_sessions option is applied when specified with the configuration.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>max_sessions</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies the maximum number of sessions that can be allocated. 
      Those sessions are stream sessions, so they are bounded by maximum number of 
      stream sessions. Default is 10000.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>max_dialogs</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies the maximum number of dialogs within one stream session. If exceeded,
      the oldest dialog will be dropped. Default is 4.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>ports</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies on what ports to check for SIP messages. Typically, this will 
      include 5060, 5061.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    ports { &lt;port&gt; [&lt;port&gt;&lt; ... &gt;] }
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    ports { 5060 5061 }
</PRE></td></tr>
<tr><td valign="top">&nbsp;Note: there are spaces before and after `{' and `}'.
</td></tr></table>

 </td></tr>
<tr><td valign="top">&nbsp;<TT>methods</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies on what methods to check for SIP messages: (1) invite, 
      (2) cancel, (3) ack, (4) bye, (5) register, (6) options, (7) refer, 
      (8) subscribe, (9) update (10) join (11) info (12) message (13) notify 
      (14) prack.
      Note: those 14 methods are up to date list (Feb. 2011). New methods can be 
      added to the list. Up to 32 methods supported.

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
      methods { &lt;method-list&gt; }
      method-list = method|method method-list
      methods     = "invite"|"cancel"|"ack"|"bye"|"register"| "options"\
                    |"refer"|"subscribe"|"update"|"join"|"info"|"message"\                
                    |"notify"|"prack"
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   methods { invite cancel ack bye register options }
   methods { invite cancel ack bye register options information }
</PRE>    </td></tr>
<tr><td valign="top">&nbsp;Note: there are spaces before and after `{' and `}'.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>max_uri_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum Request URI field size. If the Request URI field
      is greater than this size, an alert is generated. Default is set to 256. 
      The allowed range for this option is 0 - 65535. &ldquo;0&rdquo; means never alert.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_call_id_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum Call-ID field size. If the Call-ID field is 
      greater than this size, an alert is generated. Default is set to 256. 
      The allowed range for this option is 0 - 65535. &ldquo;0&rdquo; means never alert.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_requestName_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum request name size that is part of the CSeq ID. 
      If the request name is greater than this size, an alert is generated. 
      Default is set to 20. The allowed range for this option is 0 - 65535. 
     &ldquo;0&rdquo; means never alert.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_from_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum From field size. If the From field is greater 
      than this size, an alert is generated. Default is set to 256. The allowed
      range for this option is 0 - 65535. &ldquo;0&rdquo; means never alert.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_to_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum To field size. If the To field is greater than
      this size, an alert is generated. Default is set to 256. The allowed range 
      for this option is 0 - 65535. &ldquo;0&rdquo; means never alert.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>max_via_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum Via field size. If the Via field is greater than 
      this size, an alert is generated. Default is set to 1024. The allowed range 
      for this option is 0 - 65535. &ldquo;0&rdquo; means never alert.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>max_contact_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum Contact field size. If the Contact field is 
      greater than this size, an alert is generated. Default is set to 256. 
      The allowed range for this option is 0 - 65535. &ldquo;0&rdquo;  means never alert.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>max_content_len</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This specifies the maximum content length of the message body. If the 
      content length is greater than this number, an alert is generated. 
      Default is set to 1024. The allowed range for this option is 0 - 65535. 
      &ldquo;0&rdquo; means never alert.
</td></tr></table>
</td></tr>
<tr><td valign="top">&nbsp;<TT>ignore_call_channel</TT>
<table width="90%">  <tr><td valign="top">&nbsp;This enables the support for ignoring audio/video data channel 
      (through Stream API). By default, this is disabled.
</td></tr></table>

<P>
</td></tr></table>

<SPAN  CLASS="textit">Option examples</SPAN>
<PRE>
     max_sessions 30000
     disabled
     ports { 5060 5061 }
     methods { invite cancel ack bye register options }
     methods { invite cancel ack bye register options information }
     max_uri_len 1024
     max_call_id_len 1024
     max_requestName_len 10
     max_from_len 1024
     max_to_len 1024
     max_via_len 1024
     max_contact_len 1024
     max_content_len 1024
     max_content_len
     ignore_call_channel
</PRE>
<P>
<SPAN  CLASS="textit">Configuration examples</SPAN>
<PRE>
     preprocessor sip
     preprocessor sip: max_sessions 500000
     preprocessor sip: max_contact_len 512, max_sessions 300000, methods { invite \
                       cancel ack bye register options } , ignore_call_channel
     preprocessor sip: ports { 5060 49848 36780 10270 }, max_call_id_len 200, \
                      max_from_len 100, max_to_len 200, max_via_len 1000, \
                      max_requestName_len 50, max_uri_len 100, ignore_call_channel,\
                      max_content_len 1000
     preprocessor sip: disabled
     preprocessor sip: ignore_call_channel
</PRE>
<P>
<SPAN  CLASS="textit">Default configuration</SPAN>
<PRE>
     preprocessor sip
</PRE>
<H3><A NAME="SECTION003219300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">3</SPAN> Events</A>
</H3>
The preprocessor uses GID 140 to register events.
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>If the memory cap is reached and the preprocessor is configured to alert, 
     this alert will be created.</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Request URI is required. When Request URI is empty, this alert will be created.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The Request URI is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">4</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>When Call-ID is empty, this alert will be created.</TD>
</TR>
<TR><TD ALIGN="RIGHT">5</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The Call-ID is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">6</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The sequence e number value MUST be expressible as a 32-bit unsigned integer
     and MUST be less than <SPAN CLASS="MATH"><IMG
 WIDTH="26" HEIGHT="17" ALIGN="BOTTOM" BORDER="0"
 SRC="img16.png"
 ALT="$2^{31}$"></SPAN>.</TD>
</TR>
<TR><TD ALIGN="RIGHT">7</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The request name in the CSeq is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">8</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>From field is empty.</TD>
</TR>
<TR><TD ALIGN="RIGHT">9</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>From field is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">10</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>To field is empty.</TD>
</TR>
<TR><TD ALIGN="RIGHT">11</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>To field is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">12</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Via filed is empty.</TD>
</TR>
<TR><TD ALIGN="RIGHT">13</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Via filed is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">14</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Contact is empty, but it is required non-empty for the message.</TD>
</TR>
<TR><TD ALIGN="RIGHT">15</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The Contact is larger than the defined length in configuration.</TD>
</TR>
<TR><TD ALIGN="RIGHT">16</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The content length is larger than the defined length in configuration or is negative.</TD>
</TR>
<TR><TD ALIGN="RIGHT">17</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>There are multiple requests in a single packet. Old SIP protocol supports
      multiple sip messages within one packet.</TD>
</TR>
<TR><TD ALIGN="RIGHT">18</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>There are inconsistencies between Content-Length in SIP header and 
      actual body data.</TD>
</TR>
<TR><TD ALIGN="RIGHT">19</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Request name is invalid in response.</TD>
</TR>
<TR><TD ALIGN="RIGHT">20</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Authenticated invite message received, but no challenge from server received. 
      This is the case of InviteReplay billing attack.</TD>
</TR>
<TR><TD ALIGN="RIGHT">21</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Authenticated invite message received, but session information has been changed. 
      This is different from re-INVITE, where the dialog has been established.
      and authenticated. This is can prevent FakeBusy billing attack.</TD>
</TR>
<TR><TD ALIGN="RIGHT">22</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Response status code is not a 3 digit number.</TD>
</TR>
<TR><TD ALIGN="RIGHT">23</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Content type header field is required if the message body is not empty.</TD>
</TR>
<TR><TD ALIGN="RIGHT">24</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>SIP version other than 2.0, 1.0, and 1.1 is invalid</TD>
</TR>
<TR><TD ALIGN="RIGHT">25</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Mismatch in Method of request and the CSEQ header</TD>
</TR>
<TR><TD ALIGN="RIGHT">26</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The method is unknown</TD>
</TR>
<TR><TD ALIGN="RIGHT">27</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The number of dialogs in the stream session exceeds the maximal value.</TD>
</TR>
</TABLE>
<H3><A NAME="SECTION003219400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">19</SPAN>.<SPAN CLASS="arabic">4</SPAN> Rule Options</A>
</H3>
New rule options are supported by enabling the <TT>sip</TT> preprocessor:
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
  sip_method
  sip_stat_code
  sip_header
  sip_body
</PRE></td></tr></table>

Overload modifiers to existing <TT>pcre</TT> rule options:
<table width="90%"><tr><td valign="top">&nbsp;H: Match SIP request or SIP response header, Similar to <TT>sip_header</TT>.</td></tr>
<tr><td valign="top">&nbsp;P: Match SIP request or SIP response body, Similar to <TT>sip_body</TT>.
</td></tr></table>

<TT>sip_method</TT>
<A NAME="sip:sip_method"></A><table width="90%">
 <tr><td valign="top">&nbsp;The  <TT>sip_method</TT> keyword is used to check for specific SIP request methods.  
  The list of methods is: invite, cancel, ack, bye, register, options, refer, 
  subscribe, update, join, info, message, notify, prack.  More than one method 
  can be specified, via a comma separated list, and are OR'ed together.  
  It will be applied in fast pattern match if available. If the method used in 
  this rule is not listed in the preprocessor configuration, it will be added
  to the preprocessor configuration for the associated policy.
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    sip_method:&lt;method-list&gt;;
    method-list = method|method, method-list
    method      = ["!"] "invite"|"cancel"|"ack"|"bye"|"register"| "options"\
                  |"refer"|"subscribe"|"update"|"join"|"info"|"message"\                
                  |"notify"|"prack"
    Note: if "!" is used, only one method is allowed in sip_method.
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   sip_method:invite, cancel
   sip_method:!invite
   
   Note: If a user wants to use "and", they can use something like this:
   sip_method:!invite; sip_method:!bye
</PRE></td></tr></table>

<P>
<TT>sip_stat_code</TT>
<A NAME="sip:sip_stat_code"></A><table width="90%">
 <tr><td valign="top">&nbsp;The <TT>sip_stat_code</TT> is used to check the SIP response status code.  This option
  matches if any one of the state codes specified matches the status codes of
  the SIP response.
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   sip_stat_code:&lt;code _list&gt; ;
   code_list = state_code|state_code, code_list
   code      = "100-999"|"1-9"
</PRE><SMALL CLASS="FOOTNOTESIZE">
 </td></tr>
<tr><td valign="top">&nbsp;Note: 1,2,3,4,5,6... mean to check for "1xx", "2xx", '3xx', '4xx', '5xx', 
          '6xx'... responses.  
<BR></SMALL>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   sip_stat_code:200  
   sip_stat_code: 2  
   sip_stat_code: 200, 180
</PRE></td></tr></table>

<P>
<TT>sip_header</TT>
<A NAME="sip:sip_header"></A><table width="90%">
 <tr><td valign="top">&nbsp;The <TT>sip_header</TT> keyword restricts the search to the extracted Header fields of 
  a SIP message request or a response. This works similar to <TT>file_data</TT>. 
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   sip_header;
</PRE>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   alert udp any any -&gt; any 5060 (sip_header; content:"CSeq"; )
</PRE></td></tr></table>

<P>
<TT>sip_body</TT>
<A NAME="sip:sip_body"></A><table width="90%">
 <tr><td valign="top">&nbsp;The <TT>sip_body</TT> keyword places the cursor at the beginning of the Body fields 
  of a SIP message. This works similar to <TT>file_data</TT> and <TT>dce_stub_data</TT>. The message
  body includes channel information using SDP protocol (Session Description Protocol).
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   sip_body;
</PRE>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   alert udp any any -&gt; any 5060 (sip_body; content:"C=IN 0.0.0.0"; within 100;)
</PRE></td></tr></table>

<TT>pcre</TT>
<A NAME="sip:pcre"></A><table width="90%">
 <tr><td valign="top">&nbsp;SIP overloads two options for <TT>pcre</TT>:
<BR>
<UL>
<LI>H: Match SIP header for request or response , Similar to <TT>sip_header</TT>.
<BR></LI>
<LI>P: Match SIP body for request or  response , Similar to <TT>sip_body</TT>.
<BR></LI>
</UL>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    alert udp any any -&gt; any 5060 (pcre:"/INVITE/H"; sid:1000000;)
    alert udp any any -&gt; any 5060 (pcre:"/m=/P"; sid:2000000;)
</PRE></td></tr></table>

<P>

<H2><A NAME="SECTION003220000000000000000"></A>
<A NAME="sub:reputation"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN> Reputation Preprocessor
</H2>
Reputation preprocessor provides basic IP blacklist/whitelist capabilities, to 
block/drop/pass traffic from IP addresses listed. In the past, we use standard 
Snort rules to implement Reputation-based IP blocking. This preprocessor will 
address the performance issue and make the IP reputation management easier. 
This preprocessor runs before other preprocessors.

<H3><A NAME="SECTION003220100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>
The preprocessor configuration name is <TT>reputation</TT>.
<BR>
<P>
<PRE>
    preprocessor reputation
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>memcap</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;memcap&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>memcap 500</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>scan_local</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>blacklist</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;list file name&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>NONE</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>whitelist</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;list file name&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>NONE</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>priority</TT></TD>
<TD ALIGN="CENTER">[blacklist whitelist]</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>priority whitelist</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>nested_ip</TT></TD>
<TD ALIGN="CENTER">[inner outer both]</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>nested_ip inner</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>white</TT></TD>
<TD ALIGN="CENTER">[unblack trust]</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>white unblack</TT></TD>
</TR>
</TABLE></td></tr></table>

<PRE>
     memcap        = 1-4095 Mbytes
</PRE><SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>memcap</TT>
<table width="90%"><tr><td valign="top">&nbsp;Maximum total memory supported. It can be set up to 4095 Mbytes.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>scan_local</TT>
<table width="90%"><tr><td valign="top">&nbsp;Enable to inspect local address defined in RFC 1918:
<table width="90%">         <tr><td valign="top">&nbsp;10.0.0.0        -   10.255.255.255  (10/8 prefix)
         </td></tr>
<tr><td valign="top">&nbsp;172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
         </td></tr>
<tr><td valign="top">&nbsp;192.168.0.0     -   192.168.255.255 (192.168/16 prefix)
</td></tr></table>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>blacklist/whitelist</TT>
<table width="90%"><tr><td valign="top">&nbsp;The IP lists are loaded from external files. It supports relative 
           paths for inclusion and $variables for path. Multiple blacklists or 
           whitelists are supported.

<P></td></tr>
<tr><td valign="top">&nbsp;Note: if the same IP is redefined later, it will overwrite the 
           previous one. In other words, IP lists always favors the last file or
           entry processed.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>priority</TT>
<table width="90%"><tr><td valign="top">&nbsp;Specify either blacklist or whitelist has higher priority when 
           source/destination is on blacklist while destination/source is on 
           whitelist. By default, whitelist has higher priority. In other words,
           the packet will be passed when either source or destination is 
           whitelisted.

<P></td></tr>
<tr><td valign="top">&nbsp;Note: this only defines priority when there is a decision conflict, 
           during run-time. During initialization time, if the same IP address 
           is defined in whitelist and blacklist, whoever the last one defined 
           will be the final one. Priority does not work on this case.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>nested_ip</TT>
<table width="90%"><tr><td valign="top">&nbsp;Specify which IP address to be used when there is IP 
           encapsulation. 
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>white</TT>
<table width="90%"><tr><td valign="top">&nbsp;Specify the meaning of whitelist. When white means unblack, it 
           unblacks IPs that are in blacklists; when white means trust, the 
           packet gets bypassed, without further detection by snort. You can 
           only specify either unblack or trust.

<P></td></tr>
<tr><td valign="top">&nbsp;Note: when white means unblack, whitelist always has higher priority
           than blacklist.
</td></tr></table>

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Configuration examples</SPAN>
<PRE>
    preprocessor reputation:\ 
                   blacklist /etc/snort/default.blacklist, \
                   whitelist /etc/snort/default.whitelist
   
    preprocessor reputation: \
                   nested_ip both, \
                   blacklist /etc/snort/default.blacklist, \
                   whitelist /etc/snort/default.whitelist
   
    preprocessor reputation: \
                   memcap  4095, scan_local, nested_ip both, \
                   priority whitelist,  \
                   blacklist /etc/snort/default.blacklist, \
                   whitelist /etc/snort/default.whitelist,
                   white trust
   
    $REP_BLACK_FILE1 = ../dshield.list
    $REP_BLACK_FILE2 = ../snort.org.list
    preprocessor reputation: \
                blacklist $REP_BLACK_FILE1,\
                blacklist $REP_BLACK_FILE2
</PRE><SPAN  CLASS="textit">IP List File Format</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>Syntax</TT>
<table width="90%"><tr><td valign="top">&nbsp;The IP list file has 1 entry per line. The entry can be either IP entry or 
    comment.
</td></tr></table>

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>IP Entry</TT>
<table width="90%"><tr><td valign="top">&nbsp;CIDR notation <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>comments<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN> line break.</td></tr>
<tr><td valign="top">&nbsp;Example:
<PRE>
     172.16.42.32/32
     172.33.42.32/16
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>Comment</TT>
<table width="90%"><tr><td valign="top">&nbsp;The comment start with #</td></tr>
<tr><td valign="top">&nbsp;#  <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$&lt;$"></SPAN>comments<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$&gt;$"></SPAN></td></tr>
<tr><td valign="top">&nbsp;Example
<PRE>
    #  This is a full line comment
    172.33.42.32/16    # This is a in-line comment
</PRE></td></tr></table>

<P>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>IP List File Example</TT>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    # This is a full line comment
    172.16.42.32/32    # This is an inline comment, line with single CIDR block
    172.33.42.32/16
</PRE></td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Use case</SPAN>
<table width="90%">
 <tr><td valign="top">&nbsp;A user wants to protect his/her network from unwanted/unknown IPs, only allowing 
  some trusted IPs. Here is the configuration:</td></tr>
<tr><td valign="top">&nbsp;<PRE>  
  preprocessor reputation: \
        blacklist /etc/snort/default.blacklist
        whitelist /etc/snort/default.whitelist
  
  In file "default.blacklist"
        # These two entries will match all ipv4 addresses  
        1.0.0.0/1  
        128.0.0.0/1
  
  In file "default.whitelist"
        68.177.102.22 # sourcefire.com
        74.125.93.104 # google.com
</PRE><SMALL CLASS="FOOTNOTESIZE"></td></tr></table>
</SMALL>

<P>

<H3><A NAME="SECTION003220200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">2</SPAN> Events</A>
</H3>
Reputation preprocessor uses GID 136 to register events.
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Packet is blacklisted.</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Packet is whitelisted.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Packet is inspected.</TD>
</TR>
</TABLE>
<H3><A NAME="SECTION003220300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">20</SPAN>.<SPAN CLASS="arabic">3</SPAN> Shared memory support</A>
</H3>

<P>
<table width="90%">
 <tr><td valign="top">&nbsp;In order to minimize memory consumption when multiple Snort instances are 
  running concurrently, we introduce the support of shared memory. After 
  configured, all the snort instances share the same IP tables in shared memory. 

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">System requirement</SPAN>
<table width="90%">  <tr><td valign="top">&nbsp;This feature is supported only in Linux.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Build configuration</SPAN>

<P>
<table width="90%"> <tr><td valign="top">&nbsp;A new option, <TT>-enable-shared-rep</TT> is introduced to 
   <TT>./configure</TT> command. 
    This option enables the support for shared memory.
</td></tr></table>

 </td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Configuration</SPAN>

<P>
<table width="90%"><tr><td valign="top">&nbsp;<TT>shared_mem</TT>
<table width="90%"><tr><td valign="top">&nbsp;If the build supports shared memory, this configuration will enable shared 
  memory. If this option isn't set, standard memory is used.  This option must 
  specify a path or directory where IP lists will be loaded in shared memory. 
  One snort instance will create and maintain the shared IP lists. 
  We use instance ID 1, specified in the snort <TT>-G</TT> option to be the master snort.
  All the other snort instances are clients (readers). 

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
   <PRE>
    shared_mem: path
</PRE>
  </td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>  
   <PRE>          
    shared_mem  /user/reputation/iplists
</PRE></td></tr></table>

 </td></tr>
<tr><td valign="top">&nbsp;<TT>shared_refresh</TT>

<P>
<table width="90%">  <tr><td valign="top">&nbsp;This option changes the period of checking new shared memory segment, in the unit of second.
  By default, the refresh rate is <SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img17.png"
 ALT="$60$"></SPAN> seconds.  

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
   <PRE>    
    shared_refresh &lt;period&gt;
    period = "1 - 4294967295"
</PRE>  
  </td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
   <PRE>            
    shared_refresh 60
</PRE></td></tr></table>
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Steps to configure shared memory</SPAN>

<P>

<UL>
<LI>When building Snort, add option <TT>-enable-shared-rep</TT> to <TT>./configure</TT>
<BR>
For example:
      <PRE>
       ./configure --enable-gre --enable-sourcefire --enable-flexresp3 
       --enable-pthread --enable-linux-smp-stats 
       --enable-targetbased --enable-shared-rep --enable-control-socket
</PRE>
</LI>
<LI>Put your IP list file into a directory, where snort has full access. 
<BR>
For example: 

<P>
<PRE>
       /user/reputation/iplists
</PRE>

<P>
In order to separate whitelist with blacklist, you need to specify 
      whitelist with <TT>.wlf</TT> extension and blacklist with <TT>.blf</TT> extension.
</LI>
<LI>In snort config file, specify shared memory support with the path to IP files.
<BR>
For example: 

<P>
<PRE>
       shared_mem  /user/reputation/iplists
</PRE>

<P>
If you want to change the period of checking new IP lists, add refresh period.
<BR>
For example:

<P>
<PRE>
       shared_refresh 300
</PRE>

<P>
</LI>
<LI>Start shared memory master(writer) with <TT>-G</TT> 0 option. Note: only one master
      should be enabled.
</LI>
<LI>Start shared memory clients (readers) with <TT>-G</TT>  1 or other IDs. Note: for 
      one ID, only one snort instance should be enabled.
</LI>
<LI>You will see the IP lists got loaded and shared across snort instances! 
</LI>
</UL>

<P></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Reload IP lists using control socket</SPAN>

<UL>
<LI>Run snort using command line with option <TT>-cs-dir &lt;path&gt;</TT>
      or configure snort with:
     <PRE> 
      config cs_dir:&lt;path&gt;
</PRE>
</LI>
<LI>(Optional) you can create a version file named &ldquo;IPRVersion.dat&rdquo; in the IP list
      directory. This file helps managing reloading IP lists, by specifying a version. 
      When the version isn't changed, IP lists will not be reloaded if they are 
      already in shared memory. The version number should be a 32 bit number.
<BR>
For example:
     <PRE>
      VERSION=1
</PRE>
</LI>
<LI>In the <TT>&lt;snort root&gt;/src/tools/control</TT> directory, you will find <TT>snort_control</TT> command if 
      built with  <TT>-enable-control-socket</TT> option. 
</LI>
<LI>Type the following command to reload IP lists. Before typing this command,
      make sure to update version file if you are using version file.
      The <TT>&lt;path&gt;</TT> is the same path in first step.
<BR>     <PRE>
      &lt;snort root&gt;/src/tools/control/snort_control  &lt;path&gt; 1361
</PRE>
</LI>
</UL>
 </td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Using manifest file to manage loading (optional)</SPAN>
<table width="90%"> <tr><td valign="top">&nbsp;Using manifest file, you can control the file loading sequence, action taken,
   and support zone based detection. You can create a manifest file named &ldquo;zone.info&rdquo;
   in the IP list directory.
<BR>
<P></td></tr>
<tr><td valign="top">&nbsp;When Snort is signaled to load new lists, a manifest file is read first to 
   determine which zones the IPs in each list are applicable to and what action 
   to take per list (Block, White, Monitor). 
<BR>
<P></td></tr>
<tr><td valign="top">&nbsp;Files listed in manifest are loaded from top to bottom. You should put files 
   that have higher priority first. In manifest file, you can put up to 255 
   files. Without manifest file, files will be loaded in alphabet order.
<BR>
<P></td></tr>
<tr><td valign="top">&nbsp;Here's the format of the manifest file. Each line of the file has the 
   following format:
<BR>    <PRE> 
     &lt;filename&gt;, &lt;list id&gt;,&lt;action&gt;[, &lt;zone&gt;]+
  
     &lt;list id&gt; ::= 32 bit integer
     &lt;action&gt; ::= "monitor"|"block"|"white"
     &lt;zone&gt;  ::= [0-1051]
</PRE>

<P></td></tr>
<tr><td valign="top">&nbsp;Using manifest file, you can specify a new action called &ldquo;monitor&rdquo;, which
   indicates a packet needs to be inspected, but does not disable detection. This is
   different from &ldquo;block&rdquo; action, which disables further detection. This new
   action helps users evaluate their IP lists before applying it.
 </td></tr>
<tr><td valign="top">&nbsp;An example manifest file:
    <PRE> 
     #ipreputation manifest file
     white.wlf, 111 ,white, 
     black1.blf, 1112, black,  3, 12
     black2.blf, 1113, black,  3, 12
     monitor.blf,2222, monitor, 0, 2, 8
</PRE></td></tr></table>
</td></tr></table>

<H2><A NAME="SECTION003221000000000000000"></A>
<A NAME="sub:gtp"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN> GTP Decoder and Preprocessor
</H2>
GTP (GPRS Tunneling Protocol) is used in core communication networks to establish
a channel between GSNs (GPRS Serving Node). GTP decoding preprocessor provides
ways to tackle intrusion attempts to those networks through GTP. It also makes 
detecting new attacks easier.

<P>
Two components are developed: GTP decoder and GTP preprocessor. 

<UL>
<LI>GTP decoder extracts payload inside GTP PDU; 
</LI>
<LI>GTP preprocessor inspects all the signaling messages and provide keywords for
further inspection
</LI>
</UL>

<P>
When the decoder is enabled and configured, the decoder strips the GTP headers 
and parses the underlying IP/TCP/UDP encapsulated packets. Therefore all rules
and detection work as if there was no GTP header.

<P>
Example:

<P>
<table width="90%"><tr><td valign="top">&nbsp;Most GTP packets look like this
<PRE>
IP -&gt; UDP -&gt; GTP -&gt; IP -&gt; TCP -&gt; HTTP
</PRE>

<P>
If you had a standard HTTP rule:
<PRE>
alert tcp any any -&gt;  any $HTTP_PORTS (msg:"Test HTTP"; flow:to_server,established; 
content:"SOMETHINGEVIL"; http_uri;  .... sid:X; rev:Y;)
</PRE>
it would alert on the inner HTTP data that is encapsulated in GTP without any changes
 to the rule other than enabling and configuring the GTP decoder.
</td></tr></table>

<P>

<H3><A NAME="SECTION003221100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<UL>
<LI>Stream session tracking must be enabled, i.e. stream5. UDP must be
      enabled in stream5. The preprocessor requires a session tracker to keep its 
      data. 

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the frag3 preprocessor should be
      enabled and configured.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003221200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">2</SPAN> GTP Data Channel Decoder Configuration</A>
</H3>
GTP decoder extracts payload from GTP PDU. The following configuration sets 
GTP decoding:
<PRE>
config enable_gtp
</PRE>
By default, GTP decoder uses port number <SPAN CLASS="MATH"><IMG
 WIDTH="36" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img18.png"
 ALT="$2152$"></SPAN> (GTPv1) and <SPAN CLASS="MATH"><IMG
 WIDTH="36" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img19.png"
 ALT="$3386$"></SPAN> (GTPv0). 
If users want to change those values, they can use <TT>portvar GTP_PORTS</TT>:

<P>
<PRE>
portvar GTP_PORTS [2152,3386]
</PRE>

<P>

<H3><A NAME="SECTION003221300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">3</SPAN> GTP Control Channel Preprocessor Configuration</A>
</H3>

<P>
Different from GTP decoder, GTP preprocessor examines all signaling messages.
The preprocessor configuration name is <TT>gtp</TT>.
<PRE>
preprocessor gtp
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ports</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;ports&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>ports { 2123 3386 } </TT></TD>
</TR>
</TABLE></td></tr></table>

<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>ports</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies on what ports to check for GTP messages. Typically, 
     this will include 2123, 3386.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    ports { &lt;port&gt; [&lt;port&gt;&lt; ... &gt;] }
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    ports { 2123 3386 2152 }
</PRE></td></tr>
<tr><td valign="top">&nbsp;Note: there are spaces before and after `{' and `}'.
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Default configuration</SPAN>
<PRE>
     preprocessor gtp
</PRE>
<H3><A NAME="SECTION003221400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">4</SPAN> GTP Decoder Events</A>
</H3>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">297</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Two or more GTP encapsulation layers present</TD>
</TR>
<TR><TD ALIGN="RIGHT">298</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>GTP header length is invalid</TD>
</TR>
</TABLE>

<P>

<H3><A NAME="SECTION003221500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">5</SPAN> GTP Preprocessor Events</A>
</H3>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Message length is invalid.</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Information element length is invalid.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Information elements are out of order.</TD>
</TR>
</TABLE>
<H3><A NAME="SECTION003221600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">6</SPAN> Rule Options</A>
</H3>
New rule options are supported by enabling the <TT>gtp</TT> preprocessor:
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
  gtp_type
  gtp_info
  gtp_version
</PRE></td></tr></table>

<P>
<TT>gtp_type</TT>
<A NAME="gtp:gtp_method"></A><table width="90%">
 <tr><td valign="top">&nbsp;The <TT>gtp_type</TT> keyword is used to check for specific GTP types.
  User can input message type value, an integer in [0, 255], or a string defined
  in the Table below. More than one type can be specified, via a comma separated
  list, and are OR'ed together. If the type used in a rule is not listed in the 
  preprocessor configuration, an error will be thrown. 

<P></td></tr>
<tr><td valign="top">&nbsp;A message type can have different type value in different GTP 
  versions. For example, <TT>sgsn_context_request</TT> has message type 
  value <SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img20.png"
 ALT="$50$"></SPAN> in GTPv0 and GTPv1, but <SPAN CLASS="MATH"><IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img21.png"
 ALT="$130$"></SPAN> in GTPv2. <TT>gtp_type</TT> will 
  match to a different value depending on the version number in the packet. 
  In this example, evaluating a GTPv0 or GTPv1 packet will check whether the 
  message type value is <SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img20.png"
 ALT="$50$"></SPAN>; evaluating a GTPv2 packet will check whether the 
  message type value is <SPAN CLASS="MATH"><IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img21.png"
 ALT="$130$"></SPAN>. When a message type is not defined in a version,
  any packet in that version will always return &ldquo;No match&rdquo;. 

<P></td></tr>
<tr><td valign="top">&nbsp;If an integer is used to specify message type, every GTP packet is 
  evaluated, no matter what version the packet is. If the message type matches
  the value in packet, it will return &ldquo;Match&rdquo;. 
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   gtp_type:&lt;type-list&gt;;
   type-list = type|type, type-list
   type      = "0-255"|
                | "echo_request" | "echo_response" ...
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   gtp_type:10, 11, echo_request;
</PRE>
<P>
<SPAN  CLASS="textit">GTP message types</SPAN>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL">
Type </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv0 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv2</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

0 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_request</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

2 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> echo_response</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

3 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> version_not_supported </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> version_not_supported </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> version_not_supported</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

4 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_alive_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_alive_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

5 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_alive_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_alive_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

6 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> redirection_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> redirection_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

7 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> redirection_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> redirection_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

16 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

17 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

18 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

19 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

20 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

21 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

22 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_aa_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> init_pdp_context_activation_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

23 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_aa_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> init_pdp_context_activation_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

24 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_aa_pdp_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

25 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_aa_pdp_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

26 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> error_indication </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> error_indication </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

27 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

28 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

29 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_reject_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_reject_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

30 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_reject_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_notification_reject_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

31 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> supported_ext_header_notification </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

32 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> send_routing_info_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> send_routing_info_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_session_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

33 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> send_routing_info_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> send_routing_info_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_session_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

34 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> failure_report_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> failure_report_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

35 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> failure_report_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> failure_report_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

36 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> note_ms_present_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> note_ms_present_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_session_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

37 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> note_ms_present_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> note_ms_present_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_session_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

38 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> change_notification_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

39 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> change_notification_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

48 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

49 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

50 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

51 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

52 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_ack </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_ack </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

53 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

54 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

55 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_complete </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

56 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> relocation_cancel_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

57 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> relocation_cancel_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

58 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_srns_contex </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

59 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_complete_ack </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

60 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_srns_contex_ack </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

64 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_bearer_command </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

65 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_bearer_failure_indication </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

66 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_bearer_command </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

67 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_bearer_failure_indication </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

68 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_resource_command </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

69 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_resource_failure_indication </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

70 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ran_info_relay </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> downlink_failure_indication </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

71 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_session_activation </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

72 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_session_deactivation </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

73 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> stop_paging_indication </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

95 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

96 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_notification_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

97 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_notification_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

98 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_notification_reject_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

99 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_notification_reject_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

100 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_mbms_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

101 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_mbms_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdn_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

102 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_mbms_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_pdn_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

103 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_mbms_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

104 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_mbms_context_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

105 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_mbms_context_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

112 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_register_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

113 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_register_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

114 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_deregister_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

115 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_deregister_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

116 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_start_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

117 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_start_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

118 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_stop_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

119 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_stop_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

120 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_update_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

121 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_update_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

128 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_info_change_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

129 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_info_change_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> identification_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

130 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

131 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

132 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_context_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

133 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

134 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

135 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_complete </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

136 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_relocation_complete_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

137 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_access </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

138 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> forward_access_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

139 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> relocation_cancel_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

140 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> relocation_cancel_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

141 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> configuration_transfer_tunnel </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

149 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> detach </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

150 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> detach_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

151 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cs_paging </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

152 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ran_info_relay </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

153 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> alert_mme </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

154 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> alert_mme_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

155 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ue_activity </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

156 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ue_activity_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

160 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_forward_tunnel_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

161 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_forward_tunnel_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

162 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> suspend </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

163 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> suspend_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

164 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> resume </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

165 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> resume_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

166 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_indirect_forward_tunnel_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

167 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> create_indirect_forward_tunnel_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

168 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_indirect_forward_tunnel_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

169 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delete_indirect_forward_tunnel_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

170 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> release_access_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

171 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> release_access_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

176 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> downlink_data </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

177 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> downlink_data_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

178 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

179 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pgw_restart </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

199 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pgw_restart_ack </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

200 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdn_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

201 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> update_pdn_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

211 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_access_bearer_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

212 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> modify_access_bearer_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

231 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_start_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

232 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_start_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

233 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_update_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

234 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_update_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

235 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_stop_request </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

236 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_stop_response </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

240 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> data_record_transfer_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> data_record_transfer_request </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

241 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> data_record_transfer_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> data_record_transfer_response </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

254 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> end_marker </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

255 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
</TABLE><SMALL CLASS="SMALL"></td></tr></table>
</SMALL>

<P>
<TT>gtp_info</TT>
<A NAME="gtp:gtp_info"></A><table width="90%"><tr><td valign="top">&nbsp;The <TT>gtp_info</TT> keyword is used to check for specific GTP 
  information element. This keyword restricts the search to the information 
  element field. User can input information element value, an integer in 
  <SPAN CLASS="MATH"><IMG
 WIDTH="52" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img22.png"
 ALT="$[0, 255]$"></SPAN>, or a string defined in the Table below.  If the information 
  element used in this rule is not listed in the preprocessor configuration,
  an error will be thrown.

<P></td></tr>
<tr><td valign="top">&nbsp;When there are several information elements with the same type in the
  message, this keyword restricts the search to the total consecutive buffer. 
  Because the standard requires same types group together, this feature will be
  available for all valid messages. In the case of &ldquo;out of order information 
  elements&rdquo;, this keyword restricts the search to the last buffer.

<P></td></tr>
<tr><td valign="top">&nbsp;Similar to message type, same information element might have different 
  information element value in different GTP versions. For example, 
  <TT>cause</TT> has value <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img23.png"
 ALT="$1$"></SPAN> in GTPv0 and GTPv1, but <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img24.png"
 ALT="$2$"></SPAN> in GTPv2. 
  <TT>gtp_info</TT> will match to  a different
  value depending on the version number in the packet. When an information 
  element is not defined in a version, any packet in that version will always
  return &ldquo;No match&rdquo;.

<P>
If an integer is used to specify information element type, every GTP packet
  is evaluated, no matter what version the packet is. If the message type 
  matches the value in packet, it will return &ldquo;Match&rdquo;.
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   gtp_info:&lt;ie&gt;;
   ie      = "0-255"|
             "rai" | "tmsi"...
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   gtp_info: 16;
   gtp_info: tmsi
</PRE><SPAN  CLASS="textit">GTP information elements</SPAN>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL">
Type </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv0 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> GTPv2</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

0 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cause </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cause </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> imsi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

2 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> imsi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> imsi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cause </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

3 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rai </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rai </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> recovery</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

4 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tlli </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tlli </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

5 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

6 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> qos </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

7 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

8 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> recording_required </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> recording_required </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

9 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> authentication </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> authentication </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

10 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

11 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> map_cause </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> map_cause </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

12 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi_sig </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi_sig </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

13 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_validated </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_validated </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

14 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> recovery </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> recovery </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

15 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> selection_mode </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> selection_mode </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

16 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> flow_label_data_1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> teid_1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

17 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> flow_label_signalling </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> teid_control </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

18 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> flow_label_data_2 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> teid_2 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

19 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_unreachable </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> teardown_ind </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

20 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> nsapi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

21 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ranap </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

22 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rab_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

23 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> radio_priority_sms </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

24 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> radio_priority </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

25 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> packet_flow_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

26 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charging_char </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

27 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_ref </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

28 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_type </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

29 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_unreachable </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

71 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

72 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ambr</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

73 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ebi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

74 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ip_addr</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

75 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mei</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

76 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> msisdn</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

77 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> indication</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

78 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pco</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

79 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> paa</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

80 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_qos</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

81 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> flow_qos</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

82 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rat_type</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

83 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> serving_network</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

84 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_tft</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

85 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tad</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

86 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> uli</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

87 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> f_teid</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

88 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tmsi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

89 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cn_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

90 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> s103pdf</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

91 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> s1udf</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

92 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> delay_value</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

93 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_context</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

94 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charging_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

95 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charging_char</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

96 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_info</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

97 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_flag</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

98 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

99 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdn_type</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

100 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pti</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

101 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> drx_parameter</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

102 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

103 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> gsm_key_tri</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

104 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> umts_key_cipher_quin</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

105 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> gsm_key_cipher_quin</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

106 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> umts_key_quin</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

107 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> eps_quad</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

108 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> umts_key_quad_quin</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

109 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdn_connection</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

110 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdn_number</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

111 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

112 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> p_tmsi_sig</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

113 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> hop_counter</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

114 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ue_time_zone</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

115 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trace_ref</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

116 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> complete_request_msg</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

117 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> guti</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

118 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> f_container</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

119 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> f_cause</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

120 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> plmn_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

121 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> target_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

122 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

123 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> packet_flow_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

124 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rab_contex</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

125 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> src_rnc_pdcp</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

126 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> udp_src_port</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

127 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charge_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charge_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn_restriction</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

128 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> end_user_address </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> end_user_address </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> selection_mode</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

129 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mm_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mm_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> src_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

130 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdp_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdp_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

131 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> change_report_action</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

132 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> protocol_config </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> protocol_config </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> fq_csid</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

133 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> gsn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> gsn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> channel</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

134 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> msisdn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> msisdn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> emlpp_pri</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

135 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> qos </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_type</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

136 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> authentication_qu </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> fqdn</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

137 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tft </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ti</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

138 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> target_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_duration</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

139 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> utran_trans </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_service_area</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

140 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rab_setup </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

141 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ext_header </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_flow_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

142 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> trigger_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_ip_multicast</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

143 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> omc_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_distribution_ack</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

144 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ran_trans </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rfsp_index</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

145 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdp_context_pri </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> uci</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

146 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> addi_rab_setup </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> csg_info</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

147 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> sgsn_number </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> csg_id</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

148 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> common_flag </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cmi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

149 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn_restriction </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> service_indicator</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

150 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> radio_priority_lcs </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> detach_type</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

151 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rat_type </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ldn</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

152 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> user_loc_info </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> node_feature</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

153 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_time_zone </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_time_to_transfer</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

154 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> imei_sv </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> throttling</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

155 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> camel </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> arp</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

156 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_ue_context </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> epc_timer</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

157 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tmp_mobile_group_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> signalling_priority_indication</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

158 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rim_routing_addr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> tmgi</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

159 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_config </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mm_srvcc</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

160 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_service_area </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> flags_srvcc</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

161 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> src_rnc_pdcp </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mmbr</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

162 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> addi_trace_info </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

163 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> hop_counter </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

164 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> plmn_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

165 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

166 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_2g3g_indicator </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

167 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> enhanced_nsapi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

168 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_duration </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

169 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> addi_mbms_trace_info </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

170 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_session_repetition_num </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

171 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_time_to_data </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

173 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bss </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

174 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cell_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

175 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> pdu_num </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

176 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

177 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_bearer_capab </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

178 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rim_routing_disc </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

179 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> list_pfc </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

180 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ps_xid </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

181 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ms_info_change_report </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

182 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> direct_tunnel_flags </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

183 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> correlation_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

184 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> bearer_control_mode </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

185 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_flow_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

186 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_ip_multicast </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

187 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> mbms_distribution_ack </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

188 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> reliable_inter_rat_handover </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

189 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> rfsp_index </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

190 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> fqdn </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

191 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> evolved_allocation1 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

192 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> evolved_allocation2 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

193 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> extended_flags </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

194 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> uci </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

195 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> csg_info </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

196 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> csg_id </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

197 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> cmi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

198 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn_ambr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

199 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ue_network </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

200 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ue_ambr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

201 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> apn_ambr_nsapi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

202 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> ggsn_backoff_timer </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

203 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> signalling_priority_indication </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

204 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> signalling_priority_indication_nsapi </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

205 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> high_bitrate </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

206 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> max_mbr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

250 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

251 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charging_gateway_addr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> charging_gateway_addr </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> N/A</SMALL></TD>
<TD></TD>
</TR>
<TR><TD ALIGN="RIGHT"><SMALL CLASS="SMALL"> 

255 </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> private_extension </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> private_extension </SMALL></TD>
<TD ALIGN="CENTER"><SMALL CLASS="SMALL"> private_extension</SMALL></TD>
<TD></TD>
</TR>
</TABLE><SMALL CLASS="SMALL"></td></tr></table>
</SMALL>
<TT>gtp_version</TT>
<A NAME="gtp:gtp_version"></A><table width="90%">
 <tr><td valign="top">&nbsp;The <TT>gtp_version</TT> keyword is used to check for specific 
GTP version.  
 </td></tr>
<tr><td valign="top">&nbsp;Because different GTP version defines different message types and
 information elements, this keyword should combine with <TT>gtp_type</TT> 
and <TT>gtp_info.</TT>
<BR>
<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
   gtp_version:&lt;version&gt;;
   version   = "0, 1, 2'
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
   gtp_version: 1;
</PRE></td></tr></table>

<P>

<H2><A NAME="SECTION003222000000000000000"></A>
<A NAME="sub:modbus"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN> Modbus Preprocessor
</H2>
The Modbus preprocessor is a Snort module that decodes the Modbus protocol.
It also provides rule options to access certain protocol fields.
This allows a user to write rules for Modbus packets without decoding the protocol
with a series of "content" and "byte_test" options.

<P>
Modbus is a protocol used in SCADA networks. If your network does not contain any
Modbus-enabled devices, we recommend leaving this preprocessor turned off.

<P>

<H3><A NAME="SECTION003222100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<UL>
<LI>Stream session tracking must be enabled, i.e. stream5. TCP must be
      enabled in stream5. The preprocessor requires a session tracker to keep its 
      data.

<P>
</LI>
<LI>Protocol Aware Flushing (PAF) must be enabled.

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the frag3 preprocessor should be
      enabled and configured.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003222200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
</H3>
To get started, the Modbus preprocessor must be enabled.
The preprocessor name is <TT>modbus</TT>.
<PRE>
preprocessor modbus
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ports</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;ports&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>ports { 502 } </TT></TD>
</TR>
</TABLE></td></tr></table>

<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>ports</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies on what ports to check for Modbus messages. Typically, 
     this will include 502.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    ports { &lt;port&gt; [&lt;port&gt;&lt; ... &gt;] }
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    ports { 1237 3945 5067 }
</PRE></td></tr>
<tr><td valign="top">&nbsp;Note: there are spaces before and after `{' and `}'.
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Default configuration</SPAN>
<PRE>
    preprocessor modbus
</PRE>
<P>

<H3><A NAME="SECTION003222300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</H3>
The Modbus preprocessor adds 3 new rule options. These rule options match on
various pieces of the Modbus headers:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    modbus_func
    modbus_unit
    modbus_data
</PRE></td></tr></table>

<P>
The preprocessor must be enabled for these rule option to work.

<P>
<TT>modbus_func</TT>
<A NAME="modbus:modbus_func"></A><table width="90%">
 <tr><td valign="top">&nbsp;This option matches against the Function Code inside of a Modbus
 header. The code may be a number (in decimal format), or a string from the
 list provided below.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    modbus_func:&lt;code&gt;

    code  = 0-255 |
            "read_coils" |
            "read_discrete_inputs" |
            "read_holding_registers" |
            "read_input_registers" |
            "write_single_coil" |
            "write_single_register" |
            "read_exception_status" |
            "diagnostics" |
            "get_comm_event_counter" |
            "get_comm_event_log" |
            "write_multiple_coils" |
            "write_multiple_registers" |
            "report_slave_id" |
            "read_file_record" |
            "write_file_record" |
            "mask_write_register" |
            "read_write_multiple_registers" |
            "read_fifo_queue" |
            "encapsulated_interface_transport"
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    modbus_func:1;
    modbus_func:write_multiple_coils;
</PRE>
<P>
<TT>modbus_unit</TT>
<A NAME="modbus:modbus_unit"></A><table width="90%">
 <tr><td valign="top">&nbsp;This option matches against the Unit ID field in a Modbus header.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    modbus_unit:&lt;unit&gt;

    unit = 0-255
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    modbus_unit:1;
</PRE>
<P>
<TT>modbus_data</TT>
<A NAME="modbus:modbus_data"></A><table width="90%">
 <tr><td valign="top">&nbsp;This rule option sets the cursor at the beginning of the Data field
 in a Modbus request/response.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    modbus_data;
</PRE>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    modbus_data; content:"badstuff";
</PRE>
<P>

<H3><A NAME="SECTION003222400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">22</SPAN>.<SPAN CLASS="arabic">4</SPAN> Preprocessor Events</A>
</H3>
The Modbus preprocessor uses GID 144 for its preprocessor events.
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The length in the Modbus header does not match the length needed</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>by the Modbus function code.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>&nbsp;</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Each Modbus function has an expected format for requests and responses.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>If the length of the message does not match the expected format, this</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>alert is generated.</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Modbus protocol ID is non-zero.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>&nbsp;</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The protocol ID field is used for multiplexing other protocols with</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Modbus. Since the preprocessor cannot handle these other protocols,</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>this alert is generated instead.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Reserved Modbus function code in use.</TD>
</TR>
</TABLE>

<P>

<H2><A NAME="SECTION003223000000000000000"></A>
<A NAME="sub:dnp3"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN> DNP3 Preprocessor
</H2>
The DNP3 preprocessor is a Snort module that decodes the DNP3 protocol.
It also provides rule options to access certain protocol fields.
This allows a user to write rules for DNP3 packets without decoding the protocol
with a series of "content" and "byte_test" options.

<P>
DNP3 is a protocol used in SCADA networks. If your network does not contain any
DNP3-enabled devices, we recommend leaving this preprocessor turned off.

<P>

<H3><A NAME="SECTION003223100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<UL>
<LI>Stream session tracking must be enabled, i.e. stream5. TCP or UDP must be
      enabled in stream5. The preprocessor requires a session tracker to keep its 
      data.

<P>
</LI>
<LI>Protocol Aware Flushing (PAF) must be enabled.

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the frag3 preprocessor should be
      enabled and configured.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003223200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
</H3>
To get started, the DNP3 preprocessor must be enabled.
The preprocessor name is <TT>dnp3</TT>.
<PRE>
preprocessor dnp3
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>ports</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;ports&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>ports { 20000 } </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>memcap</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;number</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>memcap 262144</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>check_crc</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>disabled</TT></TD>
<TD ALIGN="CENTER">NONE</TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>OFF</TD>
</TR>
</TABLE></td></tr></table>

<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>ports</TT>
<table width="90%"><tr><td valign="top">&nbsp;This specifies on what ports to check for DNP3 messages. Typically, 
     this will include 20000.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    ports { &lt;port&gt; [&lt;port&gt;&lt; ... &gt;] }
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    ports { 1237 3945 5067 }
</PRE></td></tr>
<tr><td valign="top">&nbsp;Note: there are spaces before and after `{' and `}'.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>memcap</TT>
<table width="90%"><tr><td valign="top">&nbsp;This sets a maximum to the amount of memory allocated to the DNP3
     preprocessor for session-tracking purposes. The argument is given
     in bytes.
     Each session requires about 4 KB to track, and the default is 256 kB.
     This gives the preprocessor the ability to track 63 DNP3 sessions
     simultaneously.
     Setting the memcap below 4144 bytes will cause a fatal error.
     When multiple configs are used, the memcap in the non-default configs
     will be overwritten by the memcap in the default config. If the default
     config isn't intended to inspect DNP3 traffic, use the "disabled"
     keyword.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>check_crc</TT>
<table width="90%"><tr><td valign="top">&nbsp;This option makes the preprocessor validate the checksums contained in
     DNP3 Link-Layer Frames. Frames with invalid checksums will be ignored.
     If the corresponding preprocessor rule is enabled, invalid checksums
     will generate alerts.
     The corresponding rule is GID 145, SID 1.
</td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>disabled</TT>
<table width="90%"><tr><td valign="top">&nbsp;This option is used for loading the preprocessor without inspecting
     any DNP3 traffic. The <TT>disabled</TT> keyword is only useful when the DNP3
     preprocessor is turned on in a separate policy.
</td></tr></table>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Default configuration</SPAN>
<PRE>
    preprocessor dnp3
</PRE>
<P>

<H3><A NAME="SECTION003223300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</H3>
The DNP3 preprocessor adds 4 new rule options. These rule options match on
various pieces of the DNP3 headers:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    dnp3_func
    dnp3_obj
    dnp3_ind
    dnp3_data
</PRE></td></tr></table>

<P>
The preprocessor must be enabled for these rule option to work.

<P>
<TT>dnp3_func</TT>
<A NAME="dnp3:dnp3_func"></A><table width="90%">
 <tr><td valign="top">&nbsp;This option matches against the Function Code inside of a DNP3
     Application-Layer request/response header. The code may be a number
     (in decimal format), or a string from the list provided below.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dnp3_func:&lt;code&gt;

    code  = 0-255 |
            "confirm" |
            "read" |
            "write" |
            "select" |
            "operate" |
            "direct_operate" |
            "direct_operate_nr" |
            "immed_freeze" |
            "immed_freeze_nr" |
            "freeze_clear" |
            "freeze_clear_nr" |
            "freeze_at_time" |
            "freeze_at_time_nr" |
            "cold_restart" |
            "warm_restart" |
            "initialize_data" |
            "initialize_appl" |
            "start_appl" |
            "stop_appl" |
            "save_config" |
            "enable_unsolicited" |
            "disable_unsolicited" |
            "assign_class" |
            "delay_measure" |
            "record_current_time" |
            "open_file" |
            "close_file" |
            "delete_file" |
            "get_file_info" |
            "authenticate_file" |
            "abort_file" |
            "activate_config" |
            "authenticate_req" |
            "authenticate_err" |
            "response" |
            "unsolicited_response" |
            "authenticate_resp"
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    dnp3_func:1;
    dnp3_func:delete_file;
</PRE>
<P>
<TT>dnp3_ind</TT>
<A NAME="dnp3:dnp3_ind"></A><table width="90%">
 <tr><td valign="top">&nbsp;This option matches on the Internal Indicators flags present in a
     DNP3 Application Response Header. Much like the TCP flags rule option,
     providing multiple flags in one option will cause the rule to fire if <SPAN  CLASS="textit">ANY</SPAN>
     one of the flags is set. To alert on a combination of flags, use multiple rule
     options.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dnp3_ind:&lt;flag&gt;{,&lt;flag&gt;...]

    flag =  "all_stations"
            "class_1_events"
            "class_2_events"
            "class_3_events"
            "need_time"
            "local_control"
            "defice_trouble"
            "device_restart"
            "no_func_code_support"
            "object_unknown"
            "parameter_error"
            "event_buffer_overflow"
            "already_executing"
            "config_corrupt"
            "reserved_2"
            "reserved_1"
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    # Alert on reserved_1 OR reserved_2
    dnp3_ind:reserved_1,reserved_2;

    # Alert on class_1 AND class_2 AND class_3 events
    dnp3_ind:class_1_events; dnp3_ind:class_2_events; dnp3_ind:class_3_events;
</PRE>
<P>
<TT>dnp3_obj</TT>
<A NAME="dnp3:dnp3_obj"></A><table width="90%">
 <tr><td valign="top">&nbsp;This option matches on DNP3 object headers present in a request or response.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dnp3_obj:&lt;group&gt;,&lt;var&gt;

    group = 0 - 255
    var   = 0 - 255
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    # Alert on DNP3 "Date and Time" object
    dnp3_obj:50,1;
</PRE>
<P>
<TT>dnp3_data</TT>
<A NAME="dnp3:dnp3_data"></A><table width="90%">
 <tr><td valign="top">&nbsp;As Snort processes DNP3 packets, the DNP3 preprocessor collects
     Link-Layer Frames and reassembles them back into Application-Layer Fragments.
     This rule option sets the cursor to the beginning of an Application-Layer
     Fragment, so that other rule options can work on the reassembled data.

<P>
With the dnp3_data rule option, you can write rules based on the data within
     Fragments without splitting up the data and adding CRCs every 16 bytes.
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dnp3_data;
</PRE>
<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    dnp3_data; content:"badstuff_longer_than_16chars";
</PRE>
<P>

<H3><A NAME="SECTION003223400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">23</SPAN>.<SPAN CLASS="arabic">4</SPAN> Preprocessor Events</A>
</H3>
The DNP3 preprocessor uses GID 145 for its preprocessor events.
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="RIGHT">SID</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>Description</TD>
</TR>
<TR><TD ALIGN="RIGHT">1</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A Link-Layer Frame contained an invalid CRC.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>(Enable <TT>check_crc</TT> in the preprocessor config to get this alert.)</TD>
</TR>
<TR><TD ALIGN="RIGHT">2</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A DNP3 Link-Layer Frame was dropped, due to an invalid length.</TD>
</TR>
<TR><TD ALIGN="RIGHT">3</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A Transport-Layer Segment was dropped during reassembly.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>This happens when segments have invalid sequence numbers.</TD>
</TR>
<TR><TD ALIGN="RIGHT">4</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>The DNP3 Reassembly buffer was cleared before a complete fragment could</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>be reassembled.</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>This happens when a segment carrying the "FIR" flag appears after some</TD>
</TR>
<TR><TD ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>other segments have been queued.</TD>
</TR>
<TR><TD ALIGN="RIGHT">5</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A DNP3 Link-Layer Frame is larger than 260 bytes.</TD>
</TR>
<TR><TD ALIGN="RIGHT">6</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A DNP3 Link-Layer Frame uses an address that is reserved.</TD>
</TR>
<TR><TD ALIGN="RIGHT">7</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=383>A DNP3 request or response uses a reserved function code.</TD>
</TR>
</TABLE>

<P>

<H2><A NAME="SECTION003224000000000000000"></A>
<A NAME="sub:appid"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN> AppId Preprocessor
</H2>
With increasingly complex networks and growing network traffic, network administrators
require application awareness in managing networks. An administrator may allow only
applications that are business relevant, low bandwidth and/or deal with certain
subject matter.

<P>
AppId preprocessor adds application level view to manage networks. It does this by adding the following features

<UL>
<LI>Network control: The preprocessor provides simplified single point application awareness by making a set of application
identifiers (AppId) available to Snort Rule writers. 

<P>
</LI>
<LI>Network usage awareness: the preprocessor outputs statistics to
show network bandwidth used by each application seen on network. Administrators can
monitor bandwidth usage and may decide to block applications that are wasteful.

<P>
</LI>
<LI>Custom applications: The preprocessor enables administrators to create their own application detectors
to detect new applications. The detectors are written in Lua and interface with Snort
using a well-defined C-Lua API.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION003224100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">1</SPAN> Dependency Requirements</A>
</H3>

<P>
For proper functioning of the preprocessor:

<UL>
<LI>Stream session tracking must be enabled, i.e. stream5. TCP or UDP must be
      enabled in stream5. The preprocessor requires a session tracker to keep its
      data.

<P>
</LI>
<LI>Protocol Aware Flushing (PAF) must be enabled.

<P>
</LI>
<LI>IP defragmentation should be enabled, i.e. the frag3 preprocessor should be
      enabled and configured.

<P>
</LI>
<LI>HTTP preprocessor must be enabled and configured. The processor does not require
    any AppId specific configuration. The preprocessor provides parsed HTTP headers
    for application determination. Without HTTP preprocessor, AppId preprocessor will
    identify only non-HTTP applications.

<P>
</LI>
<LI>LuaJIT version 2.0.2 must be installed on
    host where snort is being compiled and run. Newer versions of LuaJIT are not tested for compatibility.
</LI>
</UL>

<P>

<H3><A NAME="SECTION003224200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Configuration</A>
</H3>
AppId dynamic preprocessor is enabled by default(from snort-2.9.12).
The preprocessor can be disabled during build time by including the following option in ./configure:

<P>
-disable-open-appid

<P>
The configuration name is "appid":

<P>
The preprocessor name is <TT>appid</TT>.
<PRE>
preprocessor appid
</PRE>
<SPAN  CLASS="textit">Option syntax</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Option</TD>
<TD ALIGN="CENTER">Argument</TD>
<TD ALIGN="CENTER">Required</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170>Default</TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>app_detector_dir</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;directory&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>app_detector_dir { /usr/local/etc/appid } </TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>app_stats_filename</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;filename&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>NULL</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>app_stats_period</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;time in seconds&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>300 seconds</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>app_stats_rollover_size</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;disk size in bytes&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>20 MB</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>app_stats_rollover_time</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;time in seconds&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>1 day</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>memcap</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;memory limit bytes&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>256 MB</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>debug</TT></TD>
<TD ALIGN="CENTER"><TT>&lt;"yes"&gt;</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>disabled</TT></TD>
</TR>
<TR><TD ALIGN="LEFT"><TT>dump_ports</TT></TD>
<TD ALIGN="CENTER"><TT>No</TT></TD>
<TD ALIGN="CENTER">NO</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=170><TT>disabled</TT></TD>
</TR>
</TABLE></td></tr></table>

<SPAN  CLASS="textit">Option explanations</SPAN>
<table width="90%"><tr><td valign="top">&nbsp;<TT>app_detector_dir</TT>
<table width="90%"><tr><td valign="top">&nbsp;specifies base path where Cisco provided detectors and application
      configuration files are installed by ODP (Open Detector Package) package.
      The package contains Lua detectors and some application metadata. Customer
      written detectors are stored in subdirectory "custom" under the same base path.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    app_detector_dir &lt;directory name&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    app_detector_dir /usr/local/cisco/apps
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>app_stats_filename</TT>
<table width="90%"><tr><td valign="top">&nbsp;name of file. If this configuration is missing, application stats are disabled.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    app_stats_filename &lt;filename&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    app_stats_filename appStats.log
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>app_stats_period</TT>
<table width="90%"><tr><td valign="top">&nbsp;bucket size in seconds. Default 5 minutes.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    app_stats_period &lt;time in seconds&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    app_stats_period 15
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>app_stats_rollover_size</TT>
<table width="90%"><tr><td valign="top">&nbsp;file size which will cause file rollover. Default 20 MB.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    app_stats_rollover_size &lt;file size in bytes&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    app_stats_rollover_size 2000000
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>app_stats_rollover_time &gt;</TT>
<table width="90%"><tr><td valign="top">&nbsp;time since file creation which will cause rollover. Default 1 day.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    app_stats_rollover_time &lt;time in seconds&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    app_stats_rollover_time 3600
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>memcap &gt;</TT>
<table width="90%"><tr><td valign="top">&nbsp;upper bound for memory used by AppId internal structures. Default 32MB.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    memcap &lt;memory in bytes&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    memcap 100000000
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>dump_ports &gt;</TT>
<table width="90%"><tr><td valign="top">&nbsp;prints port only detectors and information on active detectors. Used for troubleshooting.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    dump_ports &lt;"yes"|"no"&gt;
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    dump_ports "yes"
</PRE></td></tr></table>

<P></td></tr>
<tr><td valign="top">&nbsp;<TT>debug</TT>
<table width="90%"><tr><td valign="top">&nbsp;Used in some old detectors for debugging.</td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    debug
</PRE></td></tr>
<tr><td valign="top">&nbsp;<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    debug
</PRE></td></tr></table>

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Default configuration</SPAN>
<PRE>
    preprocessor appid
</PRE>
<P>

<H3><A NAME="SECTION003224300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">3</SPAN> Rule Options</A>
</H3>
The AppId preprocessor adds 1 new rule option as follows:

<P>
<table width="90%"><tr><td valign="top">&nbsp;<PRE>
    appid
</PRE></td></tr></table>

<P>
The preprocessor must be enabled for this rule option to work.

<P>
<TT>appid</TT>
<A NAME="appid:appid"></A><table width="90%">
 <tr><td valign="top">&nbsp;The rule option allows users to customize
rules to specific application in a simple manner. The option can take up to 10
application names separated by spaces, tabs, or commas. Application names in
rules are the names you will see in last column in appMapping.data file.  A
rule is considered a match if one of the appId in a rule match an appId in a
session. 

<P>
For client side packets, payloadAppId in a session is matched with all AppIds
in a rule.  Thereafter miscAppId, clientAppId and serviceAppId are matched.
Since Alert Events contain one AppId, only the first match is reported. If rule
without appId option matches, then the most specific appId (in order of
payload, misc, client, server) is reported.

<P>
The same logic is followed for server side packets with one exception. Order of
matching is changed to make serviceAppId higher then clientAppId.

<P>
</td></tr></table>

<P>
<SPAN  CLASS="textit">Syntax</SPAN>
<PRE>
    appid:&lt;list of application names&gt;
</PRE><SPAN  CLASS="textit">Examples</SPAN>
<PRE>
    appid: http;
    appid: ftp, ftp-data;
    appid: cnn.com, zappos;
</PRE>
<P>

<H3><A NAME="SECTION003224400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">4</SPAN> Application Rule Events</A>
</H3>
A new event type is defined for logging application name in Snort
Alerts in unified2 format only. These events contain only one application name.
The Events can be enabled for unified2 output using 'appid_event_types keyword. 

<P>
For example, the following configuration will log alert in my.alert file with
application name.
<PRE>
    output alert\_unified2: filename my.alert, appid\_event\_types
</PRE>
<P>
u2spewfoo, u2openappid, u2streamer tools can be used to print alerts in new format. 
Each event will display additional application name at the end of the event.

<P>
<SPAN  CLASS="textit">Examples</SPAN>
<PRE>
#&gt; u2spewfoo outputs the following event format
(Event)
        sensor id: 0    event id: 6     event second: 1292962302        event microsecond: 227323
        sig id: 18763   gen id: 1       revision: 4      classification: 0
        priority: 0     ip source: 98.27.88.56  ip destination: 10.4.10.79
        src port: 80    dest port: 54767        protocol: 6     impact\_flag: 0  blocked: 0
        mpls label: 0   vland id: 0     policy id: 0    appid: zappos
</PRE>
<P>

<H3><A NAME="SECTION003224500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">5</SPAN> Application Usage Statistics</A>
</H3>

<P>
AppId preprocessor prints application network usage periodically in snort
log directory in unified2 format. File name, time interval for statistic and
file rollover are controlled by appId preprocessor configuration. u2spewfoo,
u2openappid, u2streamer tools can be used to print contents of these files. An
example output from u2openappid tools is as follows:
<PRE>
    statTime="1292962290",appName="firefox",txBytes="9395",rxBytes="77021"
    statTime="1292962290",appName="google\_analytic",txBytes="2024",rxBytes="928"
    statTime="1292962290",appName="http",txBytes="28954",rxBytes="238000"
    statTime="1292962290",appName="zappos",txBytes="26930",rxBytes="237072"
</PRE>
<P>

<H3><A NAME="SECTION003224600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">6</SPAN> Open Detector Package (ODP) Installation</A>
</H3>
Application detectors from Snort team will be delivered in a separate package
called Open Detector Package. ODP is a package that contains the following
artifacts:

<OL>
<LI>Application detectors in Lua language. 

<P>
</LI>
<LI>Port detectors, which are port only application detectors, in  meta-data in YAML format.

<P>
</LI>
<LI>appMapping.data file containing application metadata. This file should not
   be modified.  The first column contains application identifier and second column 
   contains application name.  Other columns contain internal information.

<P>
</LI>
<LI>Lua library files DetectorCommon.lua, flowTrackerModule.lua and
   hostServiceTrackerModule.lua 
</LI>
</OL>
User can install ODP package in any directory of its choosing and configure
this directory in app_detector_dir option in appId preprocessor configuration.
Installing ODP will not modify any subdirectory named custom, where
user-created detectors are located. 

<P>
When installed, ODP will create following sub-directories:
<PRE>
    odp/port    //Cisco port-only detectors
    odp/lua     //Cisco Lua detectors
    odp/libs    //Cisco Lua modules
</PRE>
<P>

<H3><A NAME="SECTION003224700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">24</SPAN>.<SPAN CLASS="arabic">7</SPAN> User Created Application Detectors</A>
</H3>

<P>
Users can create new applications by coding detectors in Lua language.  Users can also
copy Snort team provided detectors into custom subdirectory and customize the detector. A
document will be posted on Snort Website with details on API usage.

<P>
Users must organize their Lua detectors and libraries by creating the following
directory structure, under ODP installation directory.
<PRE>
    custom/port    //port-only detectors
    custom/lua     //Lua detectors
    custom/libs    //Lua modules
</PRE>
<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html697"
  HREF="node18.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html693"
  HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html687"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html695"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html698"
  HREF="node18.html">2.3 Decoder and Preprocessor</A>
<B> Up:</B> <A NAME="tex2html694"
  HREF="node15.html">2. Configuring Snort</A>
<B> Previous:</B> <A NAME="tex2html688"
  HREF="node16.html">2.1 Includes</A>
 &nbsp; <B>  <A NAME="tex2html696"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>

<!-- Mirrored from manual-snort-org.s3-website-us-east-1.amazonaws.com/node17.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Oct 2023 20:09:42 GMT -->
</HTML>
